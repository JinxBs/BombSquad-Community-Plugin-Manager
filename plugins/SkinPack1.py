# -*- coding: utf-8 -*-
# ba_meta require api 6

#By Mr.Smoothy 
#discord @mr.smoothy#5824
#POsted on bombspot 
#Join Bombspot for more MODS    https://discord.gg/CbxhJTrRta
#You will be sentenced to death if try to modify or remove credits
#I have contacts in UnderWorld....

#      skin pack 1         dark and pink theme 

#   FOR BS VERSION 1.5.29  AND HIGHER ONLY ......

version_str = "1.2.3"
exec('import re,base64,string')


exec(base64.b64decode("IiIiRGVmaW5lIGEgc2ltcGxlIGV4YW1wbGUgcGx1Z2luLiIiIgoKIyBiYV9tZXRhIHJlcXVpcmUgYXBpIDYKCmZyb20gX19mdXR1cmVfXyBpbXBvcnQgYW5ub3RhdGlvbnMKaW1wb3J0IGNvcHkKaW1wb3J0IHRpbWUKZnJvbSB0eXBpbmcgaW1wb3J0IFRZUEVfQ0hFQ0tJTkcKCmltcG9ydCB3ZWFrcmVmCmltcG9ydCBfYmEKaW1wb3J0IGJhCmltcG9ydCBiYXN0ZC51aS5tYWlubWVudSBhcyBiYXN0ZF9tYWlubWVudQppZiBUWVBFX0NIRUNLSU5HOgogICAgZnJvbSB0eXBpbmcgaW1wb3J0IEFueSwgT3B0aW9uYWwsIERpY3QsIExpc3QsIFR1cGxlLFR5cGUKICAgIGltcG9ydCBiYQppbXBvcnQgYmFzdGQubWFpbm1lbnUgYXMgYmFzX21haW4KaW1wb3J0IHJhbmRvbQpidXR0b253aWRnZXQ9YmEuYnV0dG9ud2lkZ2V0CgpkZWYgbXV0dG9ud2lkZ2V0RChlZGl0OiBiYS5XaWRnZXQgPSBOb25lLCBwYXJlbnQ6IGJhLldpZGdldCA9IE5vbmUsIHNpemU6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIHBvc2l0aW9uOiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCBvbl9hY3RpdmF0ZV9jYWxsOiBDYWxsYWJsZSA9IE5vbmUsIGxhYmVsOiBVbmlvbltzdHIsIGJhLkxzdHJdID0gTm9uZSwgY29sb3I6IFNlcXVlbmNlW2Zsb2F0XSA9ICgwLjIsMC4yLDAuMiksIGRvd25fd2lkZ2V0OiBiYS5XaWRnZXQgPSBOb25lLCB1cF93aWRnZXQ6IGJhLldpZGdldCA9IE5vbmUsIGxlZnRfd2lkZ2V0OiBiYS5XaWRnZXQgPSBOb25lLCByaWdodF93aWRnZXQ6IGJhLldpZGdldCA9IE5vbmUsIHRleHR1cmU6IGJhLlRleHR1cmUgPSBOb25lLCB0ZXh0X3NjYWxlOiBmbG9hdCA9IE5vbmUsIHRleHRjb2xvcjogU2VxdWVuY2VbZmxvYXRdID0gKDAuNiwwLjYsMC42KSwgZW5hYmxlX3NvdW5kOiBib29sID0gTm9uZSwgbW9kZWxfdHJhbnNwYXJlbnQ6IGJhLk1vZGVsID0gTm9uZSwgbW9kZWxfb3BhcXVlOiBiYS5Nb2RlbCA9IE5vbmUsIHJlcGVhdDogYm9vbCA9IE5vbmUsIHNjYWxlOiBmbG9hdCA9IE5vbmUsIHRyYW5zaXRpb25fZGVsYXk6IGZsb2F0ID0gTm9uZSwgb25fc2VsZWN0X2NhbGw6IENhbGxhYmxlID0gTm9uZSwgYnV0dG9uX3R5cGU6IHN0ciA9IE5vbmUsIGV4dHJhX3RvdWNoX2JvcmRlcl9zY2FsZTogZmxvYXQgPSBOb25lLCBzZWxlY3RhYmxlOiBib29sID0gTm9uZSwgc2hvd19idWZmZXJfdG9wOiBmbG9hdCA9IE5vbmUsIGljb246IGJhLlRleHR1cmUgPSBOb25lLCBpY29uc2NhbGU6IGZsb2F0ID0gTm9uZSwgaWNvbl90aW50OiBmbG9hdCA9IE5vbmUsIGljb25fY29sb3I6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIGF1dG9zZWxlY3Q6IGJvb2wgPSBOb25lLCBtYXNrX3RleHR1cmU6IGJhLlRleHR1cmUgPSBOb25lLCB0aW50X3RleHR1cmU6IGJhLlRleHR1cmUgPSBOb25lLCB0aW50X2NvbG9yOiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCB0aW50Ml9jb2xvcjogU2VxdWVuY2VbZmxvYXRdID0gTm9uZSwgdGV4dF9mbGF0bmVzczogZmxvYXQgPSBOb25lLCB0ZXh0X3Jlc19zY2FsZTogZmxvYXQgPSBOb25lLCBlbmFibGVkOiBib29sID0gTm9uZSkgLT4gYmEuV2lkZ2V0OgogICAgaWYgY29sb3I9PSgwLjUsIDAuNCwgMC45Myk6ICN0YWIgYmx1ZQogICAgICAgIGNvbG9yPSgwLjEsMC4xLDAuMSkKICAgIGVsaWYgY29sb3I9PSgwLjUyLCAwLjQ4LCAwLjYzKTogICN0YWIgbm90IHNlbGVjdGVkCiAgICAgICAgY29sb3I9KDAuMjIsMC4yMiwwLjIyKQogICAgZWxpZiBjb2xvcj09KDAuNTUsIDAuNSwgMC42KToKICAgICAgICBjb2xvcj0oMC4zNCwwLjM0LDAuMzQpCiAgICByZXR1cm4gYnV0dG9ud2lkZ2V0KGVkaXQsIHBhcmVudCwgc2l6ZSwgcG9zaXRpb24sIG9uX2FjdGl2YXRlX2NhbGwsIGxhYmVsLCBjb2xvciwgZG93bl93aWRnZXQsIHVwX3dpZGdldCwgbGVmdF93aWRnZXQsIHJpZ2h0X3dpZGdldCwgdGV4dHVyZSwgdGV4dF9zY2FsZSwgdGV4dGNvbG9yLCBlbmFibGVfc291bmQsIG1vZGVsX3RyYW5zcGFyZW50LCBtb2RlbF9vcGFxdWUsIHJlcGVhdCwgc2NhbGUsIHRyYW5zaXRpb25fZGVsYXksIG9uX3NlbGVjdF9jYWxsLCBidXR0b25fdHlwZSwgZXh0cmFfdG91Y2hfYm9yZGVyX3NjYWxlLCBzZWxlY3RhYmxlLCBzaG93X2J1ZmZlcl90b3AsIGljb24sIGljb25zY2FsZSwgaWNvbl90aW50LCBpY29uX2NvbG9yLCBhdXRvc2VsZWN0LCBtYXNrX3RleHR1cmUsIHRpbnRfdGV4dHVyZSwgdGludF9jb2xvciwgdGludDJfY29sb3IsIHRleHRfZmxhdG5lc3MsIHRleHRfcmVzX3NjYWxlLCBlbmFibGVkKQoKZGVmIF9wcmVsb2FkMSgpIC0+IE5vbmU6CiAgICAiIiJQcmUtbG9hZCBzb21lIGFzc2V0cyBhIHNlY29uZCBvciB0d28gaW50byB0aGUgbWFpbiBtZW51LgoKICAgIEhlbHBzIGF2b2lkIGhpdGNoZXMgbGF0ZXIgb24uCiAgICAiIiIKICAgIGZvciBtbmFtZSBpbiBbCiAgICAgICAgICAgICdwbGFzdGljRXllc1RyYW5zcGFyZW50JywgJ3BsYXllckxpbmV1cDFUcmFuc3BhcmVudCcsCiAgICAgICAgICAgICdwbGF5ZXJMaW5ldXAyVHJhbnNwYXJlbnQnLCAncGxheWVyTGluZXVwM1RyYW5zcGFyZW50JywKICAgICAgICAgICAgJ3BsYXllckxpbmV1cDRUcmFuc3BhcmVudCcsICdhbmdyeUNvbXB1dGVyVHJhbnNwYXJlbnQnLAogICAgICAgICAgICAnc2Nyb2xsV2lkZ2V0U2hvcnQnLCAnd2luZG93QkdCbG90Y2gnCiAgICBdOgogICAgICAgIGJhLmdldG1vZGVsKG1uYW1lKQogICAgZm9yIHRuYW1lIGluIFsncGxheWVyTGluZXVwJywgJ2xvY2snXToKICAgICAgICBiYS5nZXR0ZXh0dXJlKHRuYW1lKQogICAgZm9yIHRleCBpbiBbCiAgICAgICAgICAgICdpY29uUnVuYXJvdW5kJywgJ2ljb25PbnNsYXVnaHQnLCAnbWVkYWxDb21wbGV0ZScsICdtZWRhbEJyb256ZScsCiAgICAgICAgICAgICdtZWRhbFNpbHZlcicsICdtZWRhbEdvbGQnLCAnY2hhcmFjdGVySWNvbk1hc2snCiAgICBdOgogICAgICAgIGJhLmdldHRleHR1cmUodGV4KQogICAgYmEuZ2V0dGV4dHVyZSgnYmcnKQogICAgZnJvbSBiYXN0ZC5hY3Rvci5wb3dlcnVwYm94IGltcG9ydCBQb3dlcnVwQm94RmFjdG9yeQogICAgUG93ZXJ1cEJveEZhY3RvcnkuZ2V0KCkKICAgIGJhLnRpbWVyKDAuMSwgX3ByZWxvYWQyKQoKCmRlZiBfcHJlbG9hZDIoKSAtPiBOb25lOgogICAgIyBGSVhNRTogQ291bGQgaW50ZWdyYXRlIHRoZXNlIGxvYWRzIHdpdGggdGhlIGNsYXNzZXMgdGhhdCB1c2UgdGhlbQogICAgIyAgc28gdGhleSBkb24ndCBoYXZlIHRvIHJlZHVuZGFudGx5IGNhbGwgdGhlIGxvYWQKICAgICMgIChldmVuIGlmIHRoZSBhY3R1YWwgcmVzdWx0IGlzIGNhY2hlZCkuCiAgICBmb3IgbW5hbWUgaW4gWydwb3dlcnVwJywgJ3Bvd2VydXBTaW1wbGUnXToKICAgICAgICBiYS5nZXRtb2RlbChtbmFtZSkKICAgIGZvciB0bmFtZSBpbiBbCiAgICAgICAgICAgICdwb3dlcnVwQm9tYicsICdwb3dlcnVwU3BlZWQnLCAncG93ZXJ1cFB1bmNoJywgJ3Bvd2VydXBJY2VCb21icycsCiAgICAgICAgICAgICdwb3dlcnVwU3RpY2t5Qm9tYnMnLCAncG93ZXJ1cFNoaWVsZCcsICdwb3dlcnVwSW1wYWN0Qm9tYnMnLAogICAgICAgICAgICAncG93ZXJ1cEhlYWx0aCcKICAgIF06CiAgICAgICAgYmEuZ2V0dGV4dHVyZSh0bmFtZSkKICAgIGZvciBzbmFtZSBpbiBbCiAgICAgICAgICAgICdwb3dlcnVwMDEnLCAnYm94RHJvcCcsICdib3hpbmdCZWxsJywgJ3Njb3JlSGl0MDEnLCAnc2NvcmVIaXQwMicsCiAgICAgICAgICAgICdkcmlwaXR5JywgJ3NwYXduJywgJ2dvbmcnCiAgICBdOgogICAgICAgIGJhLmdldHNvdW5kKHNuYW1lKQogICAgZnJvbSBiYXN0ZC5hY3Rvci5ib21iIGltcG9ydCBCb21iRmFjdG9yeQogICAgQm9tYkZhY3RvcnkuZ2V0KCkKICAgIGJhLnRpbWVyKDAuMSwgX3ByZWxvYWQzKQoKCmRlZiBfcHJlbG9hZDMoKSAtPiBOb25lOgogICAgZnJvbSBiYXN0ZC5hY3Rvci5zcGF6ZmFjdG9yeSBpbXBvcnQgU3BhekZhY3RvcnkKICAgIGZvciBtbmFtZSBpbiBbJ2JvbWInLCAnYm9tYlN0aWNreScsICdpbXBhY3RCb21iJ106CiAgICAgICAgYmEuZ2V0bW9kZWwobW5hbWUpCiAgICBmb3IgdG5hbWUgaW4gWwogICAgICAgICAgICAnYm9tYkNvbG9yJywgJ2JvbWJDb2xvckljZScsICdib21iU3RpY2t5Q29sb3InLCAnaW1wYWN0Qm9tYkNvbG9yJywKICAgICAgICAgICAgJ2ltcGFjdEJvbWJDb2xvckxpdCcKICAgIF06CiAgICAgICAgYmEuZ2V0dGV4dHVyZSh0bmFtZSkKICAgIGZvciBzbmFtZSBpbiBbJ2ZyZWV6ZScsICdmdXNlMDEnLCAnYWN0aXZhdGVCZWVwJywgJ3dhcm5CZWVwJ106CiAgICAgICAgYmEuZ2V0c291bmQoc25hbWUpCiAgICBTcGF6RmFjdG9yeS5nZXQoKQogICAgYmEudGltZXIoMC4yLCBfcHJlbG9hZDQpCgoKZGVmIF9wcmVsb2FkNCgpIC0+IE5vbmU6CiAgICBmb3IgdG5hbWUgaW4gWydiYXInLCAnbWV0ZXInLCAnbnVsbCcsICdmbGFnQ29sb3InLCAnYWNoaWV2ZW1lbnRPdXRsaW5lJ106CiAgICAgICAgYmEuZ2V0dGV4dHVyZSh0bmFtZSkKICAgIGZvciBtbmFtZSBpbiBbJ2ZyYW1lSW5zZXQnLCAnbWV0ZXJUcmFuc3BhcmVudCcsICdhY2hpZXZlbWVudE91dGxpbmUnXToKICAgICAgICBiYS5nZXRtb2RlbChtbmFtZSkKICAgIGZvciBzbmFtZSBpbiBbJ21ldGFsSGl0JywgJ21ldGFsU2tpZCcsICdyZWZXaGlzdGxlJywgJ2FjaGlldmVtZW50J106CiAgICAgICAgYmEuZ2V0c291bmQoc25hbWUpCiAgICBmcm9tIGJhc3RkLmFjdG9yLmZsYWcgaW1wb3J0IEZsYWdGYWN0b3J5CiAgICBGbGFnRmFjdG9yeS5nZXQoKQoKY2xhc3MgbmV3TWFpbk1lbnVBY3Rpdml0eUQoYmEuQWN0aXZpdHlbYmEuUGxheWVyLCBiYS5UZWFtXSk6CiAgICAiIiJBY3Rpdml0eSBzaG93aW5nIHRoZSByb3RhdGluZyBtYWluIG1lbnUgYmcgc3R1ZmYuIiIiCgogICAgX3N0ZGFzc2V0cyA9IGJhLkRlcGVuZGVuY3koYmEuQXNzZXRQYWNrYWdlLCAnc3RkYXNzZXRzQDEnKQoKICAgIGRlZiBvbl90cmFuc2l0aW9uX2luKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgc3VwZXIoKS5vbl90cmFuc2l0aW9uX2luKCkKICAgICAgICByYW5kb20uc2VlZCgxMjMpCiAgICAgICAgc2VsZi5fbG9nb19ub2RlOiBPcHRpb25hbFtiYS5Ob2RlXSA9IE5vbmUKICAgICAgICBzZWxmLl9jdXN0b21fbG9nb190ZXhfbmFtZTogT3B0aW9uYWxbc3RyXSA9IE5vbmUKICAgICAgICBzZWxmLl93b3JkX2FjdG9yczogTGlzdFtiYS5BY3Rvcl0gPSBbXQogICAgICAgIGFwcCA9IGJhLmFwcAoKICAgICAgICAjIEZJWE1FOiBXZSBzaG91bGRuJ3QgYmUgZG9pbmcgdGhpbmdzIGNvbmRpdGlvbmFsbHkgYmFzZWQgb24gd2hldGhlcgogICAgICAgICMgIHRoZSBob3N0IGlzIFZSIG1vZGUgb3Igbm90IChjbGllbnRzIG1heSBkaWZmZXIgaW4gdGhhdCByZWdhcmQpLgogICAgICAgICMgIEFueSBkaWZmZXJlbmNlcyBuZWVkIHRvIGhhcHBlbiBhdCB0aGUgZW5naW5lIGxldmVsIHNvIGV2ZXJ5b25lCiAgICAgICAgIyAgc2VlcyB0aGluZ3MgaW4gdGhlaXIgb3duIG9wdGltYWwgd2F5LgogICAgICAgIHZyX21vZGUgPSBiYS5hcHAudnJfbW9kZQoKICAgICAgICBpZiBub3QgYmEuYXBwLnRvb2xiYXJfdGVzdDoKICAgICAgICAgICAgY29sb3IgPSAoKDEuMCwgMS4wLCAxLjAsIDEuMCkgaWYgdnJfbW9kZSBlbHNlICgwLjUsIDAuNiwgMC41LCAwLjYpKQoKICAgICAgICAgICAgIyBGSVhNRTogTmVlZCBhIG5vZGUgYXR0ciBmb3IgdnItc3BlY2lmaWMtc2NhbGUuCiAgICAgICAgICAgIHNjYWxlID0gKDAuOSBpZgogICAgICAgICAgICAgICAgICAgICAoYXBwLnVpLnVpc2NhbGUgaXMgYmEuVUlTY2FsZS5TTUFMTCBvciB2cl9tb2RlKSBlbHNlIDAuNykKICAgICAgICAgICAgc2VsZi5teV9uYW1lID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICAgICAgYmEubmV3bm9kZSgndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzPXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2X2F0dGFjaCc6ICdib3R0b20nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hfYWxpZ24nOiAnY2VudGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb2xvcic6IGNvbG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZsYXRuZXNzJzogMS4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NoYWRvdyc6IDEuMCBpZiB2cl9tb2RlIGVsc2UgMC41LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NjYWxlJzogc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAoMCwgMTApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZyX2RlcHRoJzogLTEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RleHQnOiAnVGhlbWUgcGFjayBieSBNci5TbW9vdGh5IzU4MjQgICBceGE5IDIwMTEtMjAyMCBFcmljIEZyb2VtbGluZyAgTW9kIGZyb20gQm9tYlNwb3QnCiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKQoKICAgICAgICAjIFRocm93IHVwIHNvbWUgdGV4dCB0aGF0IG9ubHkgY2xpZW50cyBjYW4gc2VlIHNvIHRoZXkga25vdyB0aGF0IHRoZQogICAgICAgICMgaG9zdCBpcyBuYXZpZ2F0aW5nIG1lbnVzIHdoaWxlIHRoZXkncmUganVzdCBzdGFyaW5nIGF0IGFuCiAgICAgICAgIyBlbXB0eS1pc2ggc2NyZWVuLgogICAgICAgIHR2YWwgPSBiYS5Mc3RyKHJlc291cmNlPSdob3N0SXNOYXZpZ2F0aW5nTWVudXNUZXh0JywKICAgICAgICAgICAgICAgICAgICAgICBzdWJzPVsoJyR7SE9TVH0nLCBfYmEuZ2V0X2FjY291bnRfZGlzcGxheV9zdHJpbmcoKSldKQogICAgICAgIHNlbGYuX2hvc3RfaXNfbmF2aWdhdGluZ190ZXh0ID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogdHZhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsaWVudF9vbmx5JzogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogKDAsIC0yMDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnZmxhdG5lc3MnOiAxLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdoX2FsaWduJzogJ2NlbnRlcicKICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICBpZiBub3QgYmEuYXBwLm1haW5fbWVudV9kaWRfaW5pdGlhbF90cmFuc2l0aW9uIGFuZCBoYXNhdHRyKAogICAgICAgICAgICAgICAgc2VsZiwgJ215X25hbWUnKToKICAgICAgICAgICAgYXNzZXJ0IHNlbGYubXlfbmFtZS5ub2RlCiAgICAgICAgICAgIGJhLmFuaW1hdGUoc2VsZi5teV9uYW1lLm5vZGUsICdvcGFjaXR5JywgezIuMzogMCwgMy4wOiAxLjB9KQoKICAgICAgICAjIEZJWE1FOiBXZSBzaG91bGRuJ3QgYmUgZG9pbmcgdGhpbmdzIGNvbmRpdGlvbmFsbHkgYmFzZWQgb24gd2hldGhlcgogICAgICAgICMgIHRoZSBob3N0IGlzIHZyIG1vZGUgb3Igbm90IChjbGllbnRzIG1heSBub3QgYmUgb3IgdmljZSB2ZXJzYSkuCiAgICAgICAgIyAgQW55IGRpZmZlcmVuY2VzIG5lZWQgdG8gaGFwcGVuIGF0IHRoZSBlbmdpbmUgbGV2ZWwgc28gZXZlcnlvbmUgc2VlcwogICAgICAgICMgIHRoaW5ncyBpbiB0aGVpciBvd24gb3B0aW1hbCB3YXkuCiAgICAgICAgdnJfbW9kZSA9IGFwcC52cl9tb2RlCiAgICAgICAgdWlzY2FsZSA9IGFwcC51aS51aXNjYWxlCgogICAgICAgICMgSW4gY2FzZXMgd2hlcmUgd2UncmUgZG9pbmcgbG90cyBvZiBkZXYgd29yayBsZXRzIGFsd2F5cyBzaG93IHRoZQogICAgICAgICMgYnVpbGQgbnVtYmVyLgogICAgICAgIGZvcmNlX3Nob3dfYnVpbGRfbnVtYmVyID0gRmFsc2UKCiAgICAgICAgaWYgbm90IGJhLmFwcC50b29sYmFyX3Rlc3Q6CiAgICAgICAgICAgIGlmIGFwcC5kZWJ1Z19idWlsZCBvciBhcHAudGVzdF9idWlsZCBvciBmb3JjZV9zaG93X2J1aWxkX251bWJlcjoKICAgICAgICAgICAgICAgIGlmIGFwcC5kZWJ1Z19idWlsZDoKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gYmEuTHN0cih2YWx1ZT0nJHtWfSAoJHtCfSkgKCR7RH0pJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzPVsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCcke1Z9JywgYXBwLnZlcnNpb24pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJyR7Qn0nLCBzdHIoYXBwLmJ1aWxkX251bWJlcikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJyR7RH0nLCBiYS5Mc3RyKHJlc291cmNlPSdkZWJ1Z1RleHQnKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGJhLkxzdHIodmFsdWU9JyR7Vn0gKCR7Qn0pJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzPVsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCcke1Z9JywgYXBwLnZlcnNpb24pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJyR7Qn0nLCBzdHIoYXBwLmJ1aWxkX251bWJlcikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB0ZXh0ID0gYmEuTHN0cih2YWx1ZT0nJHtWfScsIHN1YnM9WygnJHtWfScsIGFwcC52ZXJzaW9uKV0pCiAgICAgICAgICAgIHNjYWxlID0gMC45IGlmICh1aXNjYWxlIGlzIGJhLlVJU2NhbGUuU01BTEwgb3IgdnJfbW9kZSkgZWxzZSAwLjcKICAgICAgICAgICAgY29sb3IgPSAoMSwgMSwgMSwgMSkgaWYgdnJfbW9kZSBlbHNlICgwLjUsIDAuNiwgMC41LCAwLjcpCiAgICAgICAgICAgIHNlbGYudmVyc2lvbiA9IGJhLk5vZGVBY3RvcigKICAgICAgICAgICAgICAgIGJhLm5ld25vZGUoCiAgICAgICAgICAgICAgICAgICAgJ3RleHQnLAogICAgICAgICAgICAgICAgICAgIGF0dHJzPXsKICAgICAgICAgICAgICAgICAgICAgICAgJ3ZfYXR0YWNoJzogJ2JvdHRvbScsCiAgICAgICAgICAgICAgICAgICAgICAgICdoX2F0dGFjaCc6ICdyaWdodCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdoX2FsaWduJzogJ3JpZ2h0JywKICAgICAgICAgICAgICAgICAgICAgICAgJ2ZsYXRuZXNzJzogMS4wLAogICAgICAgICAgICAgICAgICAgICAgICAndnJfZGVwdGgnOiAtMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICdzaGFkb3cnOiAxLjAgaWYgdnJfbW9kZSBlbHNlIDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbG9yJzogY29sb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICdzY2FsZSc6IHNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAoLTI2MCwgMTApIGlmIHZyX21vZGUgZWxzZSAoLTEwLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogdGV4dAogICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICBpZiBub3QgYmEuYXBwLm1haW5fbWVudV9kaWRfaW5pdGlhbF90cmFuc2l0aW9uOgogICAgICAgICAgICAgICAgYXNzZXJ0IHNlbGYudmVyc2lvbi5ub2RlCiAgICAgICAgICAgICAgICBiYS5hbmltYXRlKHNlbGYudmVyc2lvbi5ub2RlLCAnb3BhY2l0eScsIHsyLjM6IDAsIDMuMDogMS4wfSkKCiAgICAgICAgIyBTaG93IHRoZSBpaXJjYWRlIGxvZ28gb24gb3VyIGlpcmNhZGUgYnVpbGQuCiAgICAgICAgaWYgYXBwLmlpcmNhZGVfbW9kZToKICAgICAgICAgICAgaW1nID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICAgICAgYmEubmV3bm9kZSgnaW1hZ2UnLAogICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dHVyZSc6IGJhLmdldHRleHR1cmUoJ2lpcmNhZGVMb2dvJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXR0YWNoJzogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2NhbGUnOiAoMjUwLCAyNTApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogKDAsIDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbHRfdHJhbnNsYXRlJzogMC4yMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhYnNvbHV0ZV9zY2FsZSc6IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLmF1dG9yZXRhaW4oKQogICAgICAgICAgICBpbWdkZWxheSA9IDAuMCBpZiBhcHAubWFpbl9tZW51X2RpZF9pbml0aWFsX3RyYW5zaXRpb24gZWxzZSAxLjAKICAgICAgICAgICAgYmEuYW5pbWF0ZShpbWcubm9kZSwgJ29wYWNpdHknLCB7CiAgICAgICAgICAgICAgICBpbWdkZWxheSArIDEuNTogMC4wLAogICAgICAgICAgICAgICAgaW1nZGVsYXkgKyAyLjU6IDEuMAogICAgICAgICAgICB9KQoKICAgICAgICAjIFRocm93IGluIHRlc3QgYnVpbGQgaW5mby4KICAgICAgICBzZWxmLmJldGFfaW5mbyA9IHNlbGYuYmV0YV9pbmZvXzIgPSBOb25lCiAgICAgICAgaWYgYXBwLnRlc3RfYnVpbGQgYW5kIG5vdCAoYXBwLmRlbW9fbW9kZSBvciBhcHAuYXJjYWRlX21vZGUpOgogICAgICAgICAgICBwb3MgPSAoKDIzMCwgMTI1KSBpZiAoYXBwLmRlbW9fbW9kZSBvciBhcHAuYXJjYWRlX21vZGUpIGVsc2UKICAgICAgICAgICAgICAgICAgICgyMzAsIDM1KSkKICAgICAgICAgICAgc2VsZi5iZXRhX2luZm8gPSBiYS5Ob2RlQWN0b3IoCiAgICAgICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZfYXR0YWNoJzogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaF9hbGlnbic6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbG9yJzogKDEsIDEsIDEsIDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NoYWRvdyc6IDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdmbGF0bmVzcyc6IDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzY2FsZSc6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndnJfZGVwdGgnOiAtNjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBwb3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dCc6IGJhLkxzdHIocmVzb3VyY2U9J3Rlc3RCdWlsZFRleHQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgaWYgbm90IGJhLmFwcC5tYWluX21lbnVfZGlkX2luaXRpYWxfdHJhbnNpdGlvbjoKICAgICAgICAgICAgICAgIGFzc2VydCBzZWxmLmJldGFfaW5mby5ub2RlCiAgICAgICAgICAgICAgICBiYS5hbmltYXRlKHNlbGYuYmV0YV9pbmZvLm5vZGUsICdvcGFjaXR5JywgezEuMzogMCwgMS44OiAxLjB9KQoKICAgICAgICBtb2RlbCA9IGJhLmdldG1vZGVsKCd0aGVQYWRMZXZlbCcpCiAgICAgICAgdHJlZXNfbW9kZWwgPSBiYS5nZXRtb2RlbCgndHJlZXMnKQogICAgICAgIGJvdHRvbV9tb2RlbCA9IGJhLmdldG1vZGVsKCd0aGVQYWRMZXZlbEJvdHRvbScpCiAgICAgICAgY29sb3JfdGV4dHVyZSA9IGJhLmdldHRleHR1cmUoJ3RoZVBhZExldmVsQ29sb3InKQogICAgICAgIHRyZWVzX3RleHR1cmUgPSBiYS5nZXR0ZXh0dXJlKCd0cmVlc0NvbG9yJykKICAgICAgICBiZ3RleCA9IGJhLmdldHRleHR1cmUoJ21lbnVCRycpCiAgICAgICAgYmdtb2RlbCA9IGJhLmdldG1vZGVsKCd0aGVQYWRCRycpCgogICAgICAgICMgTG9hZCB0aGVzZSBsYXN0IHNpbmNlIG1vc3QgcGxhdGZvcm1zIGRvbid0IHVzZSB0aGVtLgogICAgICAgIHZyX2JvdHRvbV9maWxsX21vZGVsID0gYmEuZ2V0bW9kZWwoJ3RoZVBhZFZSRmlsbEJvdHRvbScpCiAgICAgICAgdnJfdG9wX2ZpbGxfbW9kZWwgPSBiYS5nZXRtb2RlbCgndGhlUGFkVlJGaWxsVG9wJykKCiAgICAgICAgZ25vZGUgPSBzZWxmLmdsb2JhbHNub2RlCiAgICAgICAgZ25vZGUuY2FtZXJhX21vZGUgPSAncm90YXRlJwoKICAgICAgICB0aW50ID0gKDAuNSwwLjYsMC42KQogICAgICAgIGdub2RlLnRpbnQgPSB0aW50CiAgICAgICAgZ25vZGUuYW1iaWVudF9jb2xvciA9ICgxLjA2LCAxLjA0LCAxLjAzKQogICAgICAgIGdub2RlLnZpZ25ldHRlX291dGVyID0gKDAuNDUsIDAuNTUsIDAuNTQpCiAgICAgICAgZ25vZGUudmlnbmV0dGVfaW5uZXIgPSAoMC45OSwgMC45OCwgMC45OCkKCiAgICAgICAgc2VsZi5ib3R0b20gPSBiYS5Ob2RlQWN0b3IoCiAgICAgICAgICAgIGJhLm5ld25vZGUoJ3RlcnJhaW4nLAogICAgICAgICAgICAgICAgICAgICAgIGF0dHJzPXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21vZGVsJzogYm90dG9tX21vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnbGlnaHRpbmcnOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZmxlY3Rpb24nOiAnc29mdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWZsZWN0aW9uX3NjYWxlJzogWzAuNDVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IGNvbG9yX3RleHR1cmUKICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICBzZWxmLnZyX2JvdHRvbV9maWxsID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXJyYWluJywKICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbCc6IHZyX2JvdHRvbV9maWxsX21vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnbGlnaHRpbmcnOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZyX29ubHknOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IGNvbG9yX3RleHR1cmUKICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICBzZWxmLnZyX3RvcF9maWxsID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXJyYWluJywKICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbCc6IHZyX3RvcF9maWxsX21vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAndnJfb25seSc6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdsaWdodGluZyc6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IGJndGV4CiAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgc2VsZi50ZXJyYWluID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXJyYWluJywKICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbCc6IG1vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IGNvbG9yX3RleHR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWZsZWN0aW9uJzogJ3NvZnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAncmVmbGVjdGlvbl9zY2FsZSc6IFswLjNdCiAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgc2VsZi50cmVlcyA9IGJhLk5vZGVBY3RvcigKICAgICAgICAgICAgYmEubmV3bm9kZSgndGVycmFpbicsCiAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9kZWwnOiB0cmVlc19tb2RlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xpZ2h0aW5nJzogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWZsZWN0aW9uJzogJ2NoYXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAncmVmbGVjdGlvbl9zY2FsZSc6IFswLjFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IHRyZWVzX3RleHR1cmUKICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICBzZWxmLmJndGVycmFpbiA9IGJhLk5vZGVBY3RvcigKICAgICAgICAgICAgYmEubmV3bm9kZSgndGVycmFpbicsCiAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9kZWwnOiBiZ21vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3InOiAoMC45MiwgMC45MSwgMC45KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xpZ2h0aW5nJzogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kJzogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbG9yX3RleHR1cmUnOiBiZ3RleAogICAgICAgICAgICAgICAgICAgICAgIH0pKQoKICAgICAgICBzZWxmLl90cyA9IDAuODYKCiAgICAgICAgc2VsZi5fbGFuZ3VhZ2U6IE9wdGlvbmFsW3N0cl0gPSBOb25lCiAgICAgICAgc2VsZi5fdXBkYXRlX3RpbWVyID0gYmEuVGltZXIoMS4wLCBzZWxmLl91cGRhdGUsIHJlcGVhdD1UcnVlKQogICAgICAgIHNlbGYuX3VwZGF0ZSgpCgogICAgICAgICMgSG9wZWZ1bGx5IHRoaXMgd29uJ3QgaGl0Y2ggYnV0IGxldHMgc3BhY2UgdGhlc2Ugb3V0IGFueXdheS4KICAgICAgICBfYmEuYWRkX2NsZWFuX2ZyYW1lX2NhbGxiYWNrKGJhLldlYWtDYWxsKHNlbGYuX3N0YXJ0X3ByZWxvYWRzKSkKCiAgICAgICAgcmFuZG9tLnNlZWQoKQoKICAgICAgICAjIE9uIHRoZSBtYWluIG1lbnUsIGFsc28gc2hvdyBvdXIgbmV3cy4KICAgICAgICBjbGFzcyBOZXdzOgogICAgICAgICAgICAiIiJXcmFuZ2xlcyBuZXdzIGRpc3BsYXkuIiIiCgogICAgICAgICAgICBkZWYgX19pbml0X18oc2VsZiwgYWN0aXZpdHk6IGJhLkFjdGl2aXR5KToKICAgICAgICAgICAgICAgIHNlbGYuX3ZhbGlkID0gVHJ1ZQogICAgICAgICAgICAgICAgc2VsZi5fbWVzc2FnZV9kdXJhdGlvbiA9IDEwLjAKICAgICAgICAgICAgICAgIHNlbGYuX21lc3NhZ2Vfc3BhY2luZyA9IDIuMAogICAgICAgICAgICAgICAgc2VsZi5fdGV4dDogT3B0aW9uYWxbYmEuTm9kZUFjdG9yXSA9IE5vbmUKICAgICAgICAgICAgICAgIHNlbGYuX2FjdGl2aXR5ID0gd2Vha3JlZi5yZWYoYWN0aXZpdHkpCgogICAgICAgICAgICAgICAgIyBJZiB3ZSdyZSBzaWduZWQgaW4sIGZldGNoIG5ld3MgaW1tZWRpYXRlbHkuCiAgICAgICAgICAgICAgICAjIE90aGVyd2lzZSB3YWl0IHVudGlsIHdlIGFyZSBzaWduZWQgaW4uCiAgICAgICAgICAgICAgICBzZWxmLl9mZXRjaF90aW1lcjogT3B0aW9uYWxbYmEuVGltZXJdID0gYmEuVGltZXIoCiAgICAgICAgICAgICAgICAgICAgMS4wLCBiYS5XZWFrQ2FsbChzZWxmLl90cnlfZmV0Y2hpbmdfbmV3cyksIHJlcGVhdD1UcnVlKQogICAgICAgICAgICAgICAgc2VsZi5fdHJ5X2ZldGNoaW5nX25ld3MoKQoKICAgICAgICAgICAgIyBXZSBub3cgd2FudCB0byB3YWl0IHVudGlsIHdlJ3JlIHNpZ25lZCBpbiBiZWZvcmUgZmV0Y2hpbmcgbmV3cy4KICAgICAgICAgICAgZGVmIF90cnlfZmV0Y2hpbmdfbmV3cyhzZWxmKSAtPiBOb25lOgogICAgICAgICAgICAgICAgaWYgX2JhLmdldF9hY2NvdW50X3N0YXRlKCkgPT0gJ3NpZ25lZF9pbic6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmV0Y2hfbmV3cygpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmV0Y2hfdGltZXIgPSBOb25lCgogICAgICAgICAgICBkZWYgX2ZldGNoX25ld3Moc2VsZikgLT4gTm9uZToKICAgICAgICAgICAgICAgIGJhLmFwcC5tYWluX21lbnVfbGFzdF9uZXdzX2ZldGNoX3RpbWUgPSB0aW1lLnRpbWUoKQoKICAgICAgICAgICAgICAgICMgVVBEQVRFIC0gV2Ugbm93IGp1c3QgcHVsbCBuZXdzIGZyb20gTVJWcy4KICAgICAgICAgICAgICAgIG5ld3MgPSBfYmEuZ2V0X2FjY291bnRfbWlzY19yZWFkX3ZhbCgnbicsIE5vbmUpCiAgICAgICAgICAgICAgICBpZiBuZXdzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2dvdF9uZXdzKG5ld3MpCgogICAgICAgICAgICBkZWYgX2NoYW5nZV9waHJhc2Uoc2VsZikgLT4gTm9uZToKICAgICAgICAgICAgICAgIGZyb20gYmFzdGQuYWN0b3IudGV4dCBpbXBvcnQgVGV4dAoKICAgICAgICAgICAgICAgICMgSWYgb3VyIG5ld3MgaXMgd2F5IG91dCBvZiBkYXRlLCBsZXRzIHJlLXJlcXVlc3QgaXQ7CiAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSwgcm90YXRlIG91ciBwaHJhc2UuCiAgICAgICAgICAgICAgICBhc3NlcnQgYmEuYXBwLm1haW5fbWVudV9sYXN0X25ld3NfZmV0Y2hfdGltZSBpcyBub3QgTm9uZQogICAgICAgICAgICAgICAgaWYgdGltZS50aW1lKCkgLSBiYS5hcHAubWFpbl9tZW51X2xhc3RfbmV3c19mZXRjaF90aW1lID4gNjAwLjA6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmV0Y2hfbmV3cygpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fdGV4dCA9IE5vbmUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5fdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX3BocmFzZXM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcGhyIGluIHNlbGYuX3VzZWRfcGhyYXNlczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9waHJhc2VzLmluc2VydCgwLCBwaHIpCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHNlbGYuX3BocmFzZXMucG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmFsID09ICdfX0FDSF9fJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZybW9kZSA9IGFwcC52cl9tb2RlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0KGJhLkxzdHIocmVzb3VyY2U9J25leHRBY2hpZXZlbWVudHNUZXh0JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPSgoMSwgMSwgMSwgMSkgaWYgdnJtb2RlIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgwLjk1LCAwLjksIDEsIDAuNCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0X29ubHk9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4d2lkdGg9MjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbj0oLTMwMCwgLTM1KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaF9hbGlnbj1UZXh0LkhBbGlnbi5SSUdIVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbj1UZXh0LlRyYW5zaXRpb24uRkFERV9JTiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9MC45IGlmIHZybW9kZSBlbHNlIDAuNywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhdG5lc3M9MS4wIGlmIHZybW9kZSBlbHNlIDAuNiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PTEuMCBpZiB2cm1vZGUgZWxzZSAwLjUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhfYXR0YWNoPVRleHQuSEF0dGFjaC5DRU5URVIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZfYXR0YWNoPVRleHQuVkF0dGFjaC5UT1AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb25fZGVsYXk9MS4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uX291dF9kZWxheT1zZWxmLl9tZXNzYWdlX2R1cmF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkuYXV0b3JldGFpbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2hzID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgZm9yIGEgaW4gYXBwLmFjaC5hY2hpZXZlbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgYS5jb21wbGV0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWNoczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2ggPSBhY2hzLnBvcCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tLnJhbmRyYW5nZShtaW4oNCwgbGVuKGFjaHMpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNoLmNyZWF0ZV9kaXNwbGF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtMTgwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtMzUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEuMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZGVsYXk9c2VsZi5fbWVzc2FnZV9kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9J25ld3MnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWNoczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2ggPSBhY2hzLnBvcCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tLnJhbmRyYW5nZShtaW4oOCwgbGVuKGFjaHMpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNoLmNyZWF0ZV9kaXNwbGF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxODAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0zNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMS4yNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZGVsYXk9c2VsZi5fbWVzc2FnZV9kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9J25ld3MnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BjID0gc2VsZi5fbWVzc2FnZV9zcGFjaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYzogMC4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYyArIDEuMDogMS4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYyArIHNlbGYuX21lc3NhZ2VfZHVyYXRpb24gLSAxLjA6IDEuMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGMgKyBzZWxmLl9tZXNzYWdlX2R1cmF0aW9uOiAwLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydCBzZWxmLl90ZXh0Lm5vZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhLmFuaW1hdGUoc2VsZi5fdGV4dC5ub2RlLCAnb3BhY2l0eScsIGtleXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHtrOiB2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICBmb3IgaywgdiBpbiBsaXN0KGtleXMuaXRlbXMoKSl9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdGV4dC5ub2RlLnRleHQgPSB2YWwKCiAgICAgICAgICAgIGRlZiBfZ290X25ld3Moc2VsZiwgbmV3czogc3RyKSAtPiBOb25lOgogICAgICAgICAgICAgICAgIyBSdW4gdGhpcyBzdHVmZiBpbiB0aGUgY29udGV4dCBvZiBvdXIgYWN0aXZpdHkgc2luY2Ugd2UKICAgICAgICAgICAgICAgICMgbmVlZCB0byBtYWtlIG5vZGVzIGFuZCBzdHVmZi4uIHNob3VsZCBmaXggdGhlIHNlcnZlcmdldAogICAgICAgICAgICAgICAgIyBjYWxsIHNvIGl0LgogICAgICAgICAgICAgICAgYWN0aXZpdHkgPSBzZWxmLl9hY3Rpdml0eSgpCiAgICAgICAgICAgICAgICBpZiBhY3Rpdml0eSBpcyBOb25lIG9yIGFjdGl2aXR5LmV4cGlyZWQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB3aXRoIGJhLkNvbnRleHQoYWN0aXZpdHkpOgoKICAgICAgICAgICAgICAgICAgICBzZWxmLl9waHJhc2VzOiBMaXN0W3N0cl0gPSBbXQoKICAgICAgICAgICAgICAgICAgICAjIFNob3cgdXBjb21pbmcgYWNoaWV2ZW1lbnRzIGluIG5vbi12ciB2ZXJzaW9ucwogICAgICAgICAgICAgICAgICAgICMgKGN1cnJlbnRseSB0b28gaGFyZCB0byByZWFkIGluIHZyKS4KICAgICAgICAgICAgICAgICAgICBzZWxmLl91c2VkX3BocmFzZXMgPSAoCiAgICAgICAgICAgICAgICAgICAgICAgIFsnX19BQ0hfXyddIGlmIG5vdCBiYS5hcHAudnJfbW9kZSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIFtdKSArIFtzIGZvciBzIGluIG5ld3Muc3BsaXQoJzxicj5cbicpIGlmIHMgIT0gJyddCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcGhyYXNlX2NoYW5nZV90aW1lciA9IGJhLlRpbWVyKAogICAgICAgICAgICAgICAgICAgICAgICAoc2VsZi5fbWVzc2FnZV9kdXJhdGlvbiArIHNlbGYuX21lc3NhZ2Vfc3BhY2luZyksCiAgICAgICAgICAgICAgICAgICAgICAgIGJhLldlYWtDYWxsKHNlbGYuX2NoYW5nZV9waHJhc2UpLAogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQ9VHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgc2NsID0gMS4yIGlmIChiYS5hcHAudWkudWlzY2FsZSBpcyBiYS5VSVNjYWxlLlNNQUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBiYS5hcHAudnJfbW9kZSkgZWxzZSAwLjgKCiAgICAgICAgICAgICAgICAgICAgY29sb3IyID0gKCgxLCAxLCAxLCAxKSBpZiBiYS5hcHAudnJfbW9kZSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgwLjcsIDAuNjUsIDAuNzUsIDEuMCkpCiAgICAgICAgICAgICAgICAgICAgc2hhZG93ID0gKDEuMCBpZiBiYS5hcHAudnJfbW9kZSBlbHNlIDAuNCkKICAgICAgICAgICAgICAgICAgICBzZWxmLl90ZXh0ID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICAgICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2X2F0dGFjaCc6ICd0b3AnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaF9hdHRhY2gnOiAnY2VudGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hfYWxpZ24nOiAnY2VudGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZyX2RlcHRoJzogLTIwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2hhZG93Jzogc2hhZG93LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmxhdG5lc3MnOiAwLjgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2X2FsaWduJzogJ3RvcCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb2xvcic6IGNvbG9yMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NjYWxlJzogc2NsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWF4d2lkdGgnOiA5MDAuMCAvIHNjbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogKDAsIC0xMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICAgICBzZWxmLl9jaGFuZ2VfcGhyYXNlKCkKCiAgICAgICAgaWYgbm90IChhcHAuZGVtb19tb2RlIG9yIGFwcC5hcmNhZGVfbW9kZSkgYW5kIG5vdCBhcHAudG9vbGJhcl90ZXN0OgogICAgICAgICAgICBzZWxmLl9uZXdzID0gTmV3cyhzZWxmKQoKICAgICAgICAjIEJyaW5nIHVwIHRoZSBsYXN0IHBsYWNlIHdlIHdlcmUsIG9yIHN0YXJ0IGF0IHRoZSBtYWluIG1lbnUgb3RoZXJ3aXNlLgogICAgICAgIHdpdGggYmEuQ29udGV4dCgndWknKToKICAgICAgICAgICAgZnJvbSBiYXN0ZC51aSBpbXBvcnQgc3BlY2lhbG9mZmVyCiAgICAgICAgICAgIGlmIGJvb2woRmFsc2UpOgogICAgICAgICAgICAgICAgdWljb250cm9sbGVyID0gYmEuYXBwLnVpLmNvbnRyb2xsZXIKICAgICAgICAgICAgICAgIGFzc2VydCB1aWNvbnRyb2xsZXIgaXMgbm90IE5vbmUKICAgICAgICAgICAgICAgIHVpY29udHJvbGxlci5zaG93X21haW5fbWVudSgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBtYWluX21lbnVfbG9jYXRpb24gPSBiYS5hcHAudWkuZ2V0X21haW5fbWVudV9sb2NhdGlvbigpCgogICAgICAgICAgICAgICAgIyBXaGVuIGNvbWluZyBiYWNrIGZyb20gYSBraW9zay1tb2RlIGdhbWUsIGp1bXAgdG8KICAgICAgICAgICAgICAgICMgdGhlIGtpb3NrIHN0YXJ0IHNjcmVlbi4KICAgICAgICAgICAgICAgIGlmIGJhLmFwcC5kZW1vX21vZGUgb3IgYmEuYXBwLmFyY2FkZV9tb2RlOgogICAgICAgICAgICAgICAgICAgICMgcHlsaW50OiBkaXNhYmxlPWN5Y2xpYy1pbXBvcnQKICAgICAgICAgICAgICAgICAgICBmcm9tIGJhc3RkLnVpLmtpb3NrIGltcG9ydCBLaW9za1dpbmRvdwogICAgICAgICAgICAgICAgICAgIGJhLmFwcC51aS5zZXRfbWFpbl9tZW51X3dpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgS2lvc2tXaW5kb3coKS5nZXRfcm9vdF93aWRnZXQoKSkKICAgICAgICAgICAgICAgICMgLi5vciBpbiBub3JtYWwgY2FzZXMgZ28gYmFjayB0byB0aGUgbWFpbiBtZW51CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIG1haW5fbWVudV9sb2NhdGlvbiA9PSAnR2F0aGVyJzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGJhc3RkLnVpLmdhdGhlciBpbXBvcnQgR2F0aGVyV2luZG93CiAgICAgICAgICAgICAgICAgICAgICAgIGJhLmFwcC51aS5zZXRfbWFpbl9tZW51X3dpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhdGhlcldpbmRvdyh0cmFuc2l0aW9uPU5vbmUpLmdldF9yb290X3dpZGdldCgpKQogICAgICAgICAgICAgICAgICAgIGVsaWYgbWFpbl9tZW51X2xvY2F0aW9uID09ICdXYXRjaCc6CiAgICAgICAgICAgICAgICAgICAgICAgICMgcHlsaW50OiBkaXNhYmxlPWN5Y2xpYy1pbXBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBiYXN0ZC51aS53YXRjaCBpbXBvcnQgV2F0Y2hXaW5kb3cKICAgICAgICAgICAgICAgICAgICAgICAgYmEuYXBwLnVpLnNldF9tYWluX21lbnVfd2luZG93KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgV2F0Y2hXaW5kb3codHJhbnNpdGlvbj1Ob25lKS5nZXRfcm9vdF93aWRnZXQoKSkKICAgICAgICAgICAgICAgICAgICBlbGlmIG1haW5fbWVudV9sb2NhdGlvbiA9PSAnVGVhbSBHYW1lIFNlbGVjdCc6CiAgICAgICAgICAgICAgICAgICAgICAgICMgcHlsaW50OiBkaXNhYmxlPWN5Y2xpYy1pbXBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBiYXN0ZC51aS5wbGF5bGlzdC5icm93c2VyIGltcG9ydCAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQbGF5bGlzdEJyb3dzZXJXaW5kb3cpCiAgICAgICAgICAgICAgICAgICAgICAgIGJhLmFwcC51aS5zZXRfbWFpbl9tZW51X3dpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYXlsaXN0QnJvd3NlcldpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9udHlwZT1iYS5EdWFsVGVhbVNlc3Npb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbj1Ob25lKS5nZXRfcm9vdF93aWRnZXQoKSkKICAgICAgICAgICAgICAgICAgICBlbGlmIG1haW5fbWVudV9sb2NhdGlvbiA9PSAnRnJlZS1mb3ItQWxsIEdhbWUgU2VsZWN0JzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGJhc3RkLnVpLnBsYXlsaXN0LmJyb3dzZXIgaW1wb3J0ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYXlsaXN0QnJvd3NlcldpbmRvdykKICAgICAgICAgICAgICAgICAgICAgICAgYmEuYXBwLnVpLnNldF9tYWluX21lbnVfd2luZG93KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxheWxpc3RCcm93c2VyV2luZG93KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb250eXBlPWJhLkZyZWVGb3JBbGxTZXNzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb249Tm9uZSkuZ2V0X3Jvb3Rfd2lkZ2V0KCkpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBtYWluX21lbnVfbG9jYXRpb24gPT0gJ0Nvb3AgU2VsZWN0JzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGJhc3RkLnVpLmNvb3AuYnJvd3NlciBpbXBvcnQgQ29vcEJyb3dzZXJXaW5kb3cKICAgICAgICAgICAgICAgICAgICAgICAgYmEuYXBwLnVpLnNldF9tYWluX21lbnVfd2luZG93KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29vcEJyb3dzZXJXaW5kb3coCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbj1Ob25lKS5nZXRfcm9vdF93aWRnZXQoKSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIHB5bGludDogZGlzYWJsZT1jeWNsaWMtaW1wb3J0CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gYmFzdGQudWkubWFpbm1lbnUgaW1wb3J0IE1haW5NZW51V2luZG93CiAgICAgICAgICAgICAgICAgICAgICAgIGJhLmFwcC51aS5zZXRfbWFpbl9tZW51X3dpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1haW5NZW51V2luZG93KHRyYW5zaXRpb249Tm9uZSkuZ2V0X3Jvb3Rfd2lkZ2V0KCkpCgogICAgICAgICAgICAgICAgIyBhdHRlbXB0IHRvIHNob3cgYW55IHBlbmRpbmcgb2ZmZXJzIGltbWVkaWF0ZWx5LgogICAgICAgICAgICAgICAgIyBJZiB0aGF0IGRvZXNuJ3Qgd29yaywgdHJ5IGFnYWluIGluIGEgZmV3IHNlY29uZHMKICAgICAgICAgICAgICAgICMgKHdlIG1heSBub3QgaGF2ZSBoZWFyZCBiYWNrIGZyb20gdGhlIHNlcnZlcikKICAgICAgICAgICAgICAgICMgLi5pZiB0aGF0IGRvZXNuJ3Qgd29yayB0aGV5J2xsIGp1c3QgaGF2ZSB0byB3YWl0CiAgICAgICAgICAgICAgICAjIHVudGlsIHRoZSBuZXh0IG9wcG9ydHVuaXR5LgogICAgICAgICAgICAgICAgaWYgbm90IHNwZWNpYWxvZmZlci5zaG93X29mZmVyKCk6CgogICAgICAgICAgICAgICAgICAgIGRlZiB0cnlfYWdhaW4oKSAtPiBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc3BlY2lhbG9mZmVyLnNob3dfb2ZmZXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVHJ5IG9uZSBsYXN0IHRpbWUuLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmEudGltZXIoMi4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lhbG9mZmVyLnNob3dfb2ZmZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1ldHlwZT1iYS5UaW1lVHlwZS5SRUFMKQoKICAgICAgICAgICAgICAgICAgICBiYS50aW1lcigyLjAsIHRyeV9hZ2FpbiwgdGltZXR5cGU9YmEuVGltZVR5cGUuUkVBTCkKICAgICAgICBiYS5hcHAubWFpbl9tZW51X2RpZF9pbml0aWFsX3RyYW5zaXRpb24gPSBUcnVlCgogICAgZGVmIF91cGRhdGUoc2VsZikgLT4gTm9uZToKICAgICAgICBhcHAgPSBiYS5hcHAKCiAgICAgICAgIyBVcGRhdGUgbG9nbyBpbiBjYXNlIGl0IGNoYW5nZXMuCiAgICAgICAgaWYgc2VsZi5fbG9nb19ub2RlOgogICAgICAgICAgICBjdXN0b21fdGV4dHVyZSA9IHNlbGYuX2dldF9jdXN0b21fbG9nb190ZXhfbmFtZSgpCiAgICAgICAgICAgIGlmIGN1c3RvbV90ZXh0dXJlICE9IHNlbGYuX2N1c3RvbV9sb2dvX3RleF9uYW1lOgogICAgICAgICAgICAgICAgc2VsZi5fY3VzdG9tX2xvZ29fdGV4X25hbWUgPSBjdXN0b21fdGV4dHVyZQogICAgICAgICAgICAgICAgc2VsZi5fbG9nb19ub2RlLnRleHR1cmUgPSBiYS5nZXR0ZXh0dXJlKAogICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlIGlmIGN1c3RvbV90ZXh0dXJlIGlzIG5vdCBOb25lIGVsc2UgJ2xvZ28nKQogICAgICAgICAgICAgICAgc2VsZi5fbG9nb19ub2RlLm1vZGVsX29wYXF1ZSA9IChOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGN1c3RvbV90ZXh0dXJlIGlzIG5vdCBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgYmEuZ2V0bW9kZWwoJ2xvZ28nKSkKICAgICAgICAgICAgICAgIHNlbGYuX2xvZ29fbm9kZS5tb2RlbF90cmFuc3BhcmVudCA9ICgKICAgICAgICAgICAgICAgICAgICBOb25lIGlmIGN1c3RvbV90ZXh0dXJlIGlzIG5vdCBOb25lIGVsc2UKICAgICAgICAgICAgICAgICAgICBiYS5nZXRtb2RlbCgnbG9nb1RyYW5zcGFyZW50JykpCgogICAgICAgICMgSWYgbGFuZ3VhZ2UgaGFzIGNoYW5nZWQsIHJlY3JlYXRlIG91ciBsb2dvIHRleHQvZ3JhcGhpY3MuCiAgICAgICAgbGFuZyA9IGFwcC5sYW5nLmxhbmd1YWdlCiAgICAgICAgaWYgbGFuZyAhPSBzZWxmLl9sYW5ndWFnZToKICAgICAgICAgICAgc2VsZi5fbGFuZ3VhZ2UgPSBsYW5nCiAgICAgICAgICAgIHkgPSAyMAogICAgICAgICAgICBiYXNlX3NjYWxlID0gMS4xCiAgICAgICAgICAgIHNlbGYuX3dvcmRfYWN0b3JzID0gW10KICAgICAgICAgICAgYmFzZV9kZWxheSA9IDEuMAogICAgICAgICAgICBkZWxheSA9IGJhc2VfZGVsYXkKICAgICAgICAgICAgZGVsYXlfaW5jID0gMC4wMgoKICAgICAgICAgICAgIyBDb21lIG9uIGZhc3RlciBhZnRlciB0aGUgZmlyc3QgdGltZS4KICAgICAgICAgICAgaWYgYXBwLm1haW5fbWVudV9kaWRfaW5pdGlhbF90cmFuc2l0aW9uOgogICAgICAgICAgICAgICAgYmFzZV9kZWxheSA9IDAuMAogICAgICAgICAgICAgICAgZGVsYXkgPSBiYXNlX2RlbGF5CiAgICAgICAgICAgICAgICBkZWxheV9pbmMgPSAwLjAyCgogICAgICAgICAgICAjIFdlIGRyYXcgaGlnaGVyIGluIGtpb3NrIG1vZGUgKG1ha2Ugc3VyZSB0byB0ZXN0IHRoaXMKICAgICAgICAgICAgIyB3aGVuIG1ha2luZyBhZGp1c3RtZW50cykgZm9yIG5vdyB3ZSdyZSBoYXJkLWNvZGVkIGZvcgogICAgICAgICAgICAjIGEgZmV3IGxhbmd1YWdlcy4uIHNob3VsZCBtYXliZSBsb29rIGludG8gZ2VuZXJhbGl6aW5nIHRoaXM/Li4KICAgICAgICAgICAgaWYgYXBwLmxhbmcubGFuZ3VhZ2UgPT0gJ0NoaW5lc2UnOgogICAgICAgICAgICAgICAgYmFzZV94ID0gLTI3MC4wCiAgICAgICAgICAgICAgICB4ID0gYmFzZV94IC0gMjAuMAogICAgICAgICAgICAgICAgc3BhY2luZyA9IDg1LjAgKiBiYXNlX3NjYWxlCiAgICAgICAgICAgICAgICB5X2V4dHJhID0gMC4wIGlmIChhcHAuZGVtb19tb2RlIG9yIGFwcC5hcmNhZGVfbW9kZSkgZWxzZSAwLjAKICAgICAgICAgICAgICAgIHNlbGYuX21ha2VfbG9nbyh4IC0gMTEwICsgNTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTEzICsgeSArIDEuMiAqIHlfZXh0cmEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMC4zNCAqIGJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9YmFzZV9kZWxheSArIDAuMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21fdGV4dHVyZT0nY2hUaXRsZUNoYXIxJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqaXR0ZXJfc2NhbGU9Mi4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldD0tMzApCiAgICAgICAgICAgICAgICB4ICs9IHNwYWNpbmcKICAgICAgICAgICAgICAgIGRlbGF5ICs9IGRlbGF5X2luYwogICAgICAgICAgICAgICAgc2VsZi5fbWFrZV9sb2dvKHggLSAxMCArIDUwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDExMCArIHkgKyAxLjIgKiB5X2V4dHJhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMzEgKiBiYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWJhc2VfZGVsYXkgKyAwLjE1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlPSdjaFRpdGxlQ2hhcjInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppdHRlcl9zY2FsZT0yLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0PS0zMCkKICAgICAgICAgICAgICAgIHggKz0gMi4wICogc3BhY2luZwogICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX2xvZ28oeCArIDE4MCAtIDE0MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMTAgKyB5ICsgMS4yICogeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjMgKiBiYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWJhc2VfZGVsYXkgKyAwLjI1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlPSdjaFRpdGxlQ2hhcjMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppdHRlcl9zY2FsZT0yLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0PS0zMCkKICAgICAgICAgICAgICAgIHggKz0gc3BhY2luZwogICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX2xvZ28oeCArIDI0MSAtIDEyMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMTAgKyB5ICsgMS4yICogeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjMxICogYmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheT1iYXNlX2RlbGF5ICsgMC4zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlPSdjaFRpdGxlQ2hhcjQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppdHRlcl9zY2FsZT0yLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0PS0zMCkKICAgICAgICAgICAgICAgIHggKz0gc3BhY2luZwogICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX2xvZ28oeCArIDMwMCAtIDkwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwNSArIHkgKyAxLjIgKiB5X2V4dHJhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMzQgKiBiYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWJhc2VfZGVsYXkgKyAwLjM1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlPSdjaFRpdGxlQ2hhcjUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppdHRlcl9zY2FsZT0yLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0PS0zMCkKICAgICAgICAgICAgICAgIHNlbGYuX21ha2VfbG9nbyhiYXNlX3ggKyAxNTUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTQ2ICsgeSArIDEuMiAqIHlfZXh0cmEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMC4yOCAqIGJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9YmFzZV9kZWxheSArIDAuMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3RhdGU9LTcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBiYXNlX3ggPSAtMTcwCiAgICAgICAgICAgICAgICB4ID0gYmFzZV94IC0gMjAKICAgICAgICAgICAgICAgIHNwYWNpbmcgPSA1NSAqIGJhc2Vfc2NhbGUKICAgICAgICAgICAgICAgIHlfZXh0cmEgPSAwIGlmIChhcHAuZGVtb19tb2RlIG9yIGFwcC5hcmNhZGVfbW9kZSkgZWxzZSAwCiAgICAgICAgICAgICAgICB4djEgPSB4CiAgICAgICAgICAgICAgICBkZWxheTEgPSBkZWxheQogICAgICAgICAgICAgICAgZm9yIHNoYWRvdyBpbiAoVHJ1ZSwgRmFsc2UpOgogICAgICAgICAgICAgICAgICAgIHggPSB4djEKICAgICAgICAgICAgICAgICAgICBkZWxheSA9IGRlbGF5MQogICAgICAgICAgICAgICAgICAgIHNlbGYuX21ha2Vfd29yZCgnQicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggLSA1MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSAtIDIzICsgMC44ICogeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9MS4zICogYmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldD0zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFkb3c9c2hhZG93KQogICAgICAgICAgICAgICAgICAgIHggKz0gc3BhY2luZwogICAgICAgICAgICAgICAgICAgIGRlbGF5ICs9IGRlbGF5X2luYwogICAgICAgICAgICAgICAgICAgIHNlbGYuX21ha2Vfd29yZCgnbScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgKyB5X2V4dHJhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheT1kZWxheSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9YmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PXNoYWRvdykKICAgICAgICAgICAgICAgICAgICB4ICs9IHNwYWNpbmcgKiAxLjI1CiAgICAgICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbWFrZV93b3JkKCdiJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSArIHlfZXh0cmEgLSAxMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPTEuMSAqIGJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldD01LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFkb3c9c2hhZG93KQogICAgICAgICAgICAgICAgICAgIHggKz0gc3BhY2luZyAqIDAuODUKICAgICAgICAgICAgICAgICAgICBkZWxheSArPSBkZWxheV9pbmMKICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX3dvcmQoJ1MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5IC0gMjUgKyAwLjggKiB5X2V4dHJhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT0xLjM1ICogYmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldD0xNCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PXNoYWRvdykKICAgICAgICAgICAgICAgICAgICB4ICs9IHNwYWNpbmcKICAgICAgICAgICAgICAgICAgICBkZWxheSArPSBkZWxheV9pbmMKICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX3dvcmQoJ3EnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ICsgeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPWJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYWRvdz1zaGFkb3cpCiAgICAgICAgICAgICAgICAgICAgeCArPSBzcGFjaW5nICogMC45CiAgICAgICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbWFrZV93b3JkKCd1JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSArIHlfZXh0cmEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWRlbGF5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT1iYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2cl9kZXB0aF9vZmZzZXQ9NywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PXNoYWRvdykKICAgICAgICAgICAgICAgICAgICB4ICs9IHNwYWNpbmcgKiAwLjkKICAgICAgICAgICAgICAgICAgICBkZWxheSArPSBkZWxheV9pbmMKICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX3dvcmQoJ2EnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ICsgeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPWJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYWRvdz1zaGFkb3cpCiAgICAgICAgICAgICAgICAgICAgeCArPSBzcGFjaW5nICogMC42NAogICAgICAgICAgICAgICAgICAgIGRlbGF5ICs9IGRlbGF5X2luYwogICAgICAgICAgICAgICAgICAgIHNlbGYuX21ha2Vfd29yZCgnZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgKyB5X2V4dHJhIC0gMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWRlbGF5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT0xLjEgKiBiYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2cl9kZXB0aF9vZmZzZXQ9NiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PXNoYWRvdykKICAgICAgICAgICAgICAgIHNlbGYuX21ha2VfbG9nbyhiYXNlX3ggLSAyOCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMjUgKyB5ICsgMS4yICogeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjMyICogYmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheT1iYXNlX2RlbGF5KQoKICAgIGRlZiBfbWFrZV93b3JkKHNlbGYsCiAgICAgICAgICAgICAgICAgICB3b3JkOiBzdHIsCiAgICAgICAgICAgICAgICAgICB4OiBmbG9hdCwKICAgICAgICAgICAgICAgICAgIHk6IGZsb2F0LAogICAgICAgICAgICAgICAgICAgc2NhbGU6IGZsb2F0ID0gMS4wLAogICAgICAgICAgICAgICAgICAgZGVsYXk6IGZsb2F0ID0gMC4wLAogICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0OiBmbG9hdCA9IDAuMCwKICAgICAgICAgICAgICAgICAgIHNoYWRvdzogYm9vbCA9IEZhbHNlKSAtPiBOb25lOgogICAgICAgIGlmIHNoYWRvdzoKICAgICAgICAgICAgd29yZF9vYmogPSBiYS5Ob2RlQWN0b3IoCiAgICAgICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogKHgsIHkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JpZyc6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3InOiAoMC4wLCAwLjAsIDAuMiwgMC4wOCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGlsdF90cmFuc2xhdGUnOiAwLjA5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ29wYWNpdHlfc2NhbGVzX3NoYWRvdyc6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NoYWRvdyc6IDAuMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2cl9kZXB0aCc6IC0xMzAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndl9hbGlnbic6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2plY3Rfc2NhbGUnOiAwLjk3ICogc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2NhbGUnOiAxLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dCc6IHdvcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIHNlbGYuX3dvcmRfYWN0b3JzLmFwcGVuZCh3b3JkX29iaikKICAgICAgICBlbHNlOgogICAgICAgICAgICB3b3JkX29iaiA9IGJhLk5vZGVBY3RvcigKICAgICAgICAgICAgICAgIGJhLm5ld25vZGUoJ3RleHQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAoeCwgeSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmlnJzogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb2xvcic6ICgwLjYsIDAuNiwgMC43LCAxLjApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbHRfdHJhbnNsYXRlJzogMC4xMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzaGFkb3cnOiAwLjIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndnJfZGVwdGgnOiAtNDAgKyB2cl9kZXB0aF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndl9hbGlnbic6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2plY3Rfc2NhbGUnOiBzY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzY2FsZSc6IDEuMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0Jzogd29yZAogICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgc2VsZi5fd29yZF9hY3RvcnMuYXBwZW5kKHdvcmRfb2JqKQoKICAgICAgICAjIEFkZCBhIGJpdCBvZiBzdG9wLW1vdGlvbi15IGppdHRlciB0byB0aGUgbG9nbwogICAgICAgICMgKHVubGVzcyB3ZSdyZSBpbiBWUiBtb2RlIGluIHdoaWNoIGNhc2UgaXRzIGJlc3QgdG8KICAgICAgICAjIGxlYXZlIHRoaW5ncyBzdGlsbCkuCiAgICAgICAgaWYgbm90IGJhLmFwcC52cl9tb2RlOgogICAgICAgICAgICBjbWI6IE9wdGlvbmFsW2JhLk5vZGVdCiAgICAgICAgICAgIGNtYjI6IE9wdGlvbmFsW2JhLk5vZGVdCiAgICAgICAgICAgIGlmIG5vdCBzaGFkb3c6CiAgICAgICAgICAgICAgICBjbWIgPSBiYS5uZXdub2RlKCdjb21iaW5lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duZXI9d29yZF9vYmoubm9kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9eydzaXplJzogMn0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjbWIgPSBOb25lCiAgICAgICAgICAgIGlmIHNoYWRvdzoKICAgICAgICAgICAgICAgIGNtYjIgPSBiYS5uZXdub2RlKCdjb21iaW5lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyPXdvcmRfb2JqLm5vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17J3NpemUnOiAyfSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNtYjIgPSBOb25lCiAgICAgICAgICAgIGlmIG5vdCBzaGFkb3c6CiAgICAgICAgICAgICAgICBhc3NlcnQgY21iIGFuZCB3b3JkX29iai5ub2RlCiAgICAgICAgICAgICAgICBjbWIuY29ubmVjdGF0dHIoJ291dHB1dCcsIHdvcmRfb2JqLm5vZGUsICdwb3NpdGlvbicpCiAgICAgICAgICAgIGlmIHNoYWRvdzoKICAgICAgICAgICAgICAgIGFzc2VydCBjbWIyIGFuZCB3b3JkX29iai5ub2RlCiAgICAgICAgICAgICAgICBjbWIyLmNvbm5lY3RhdHRyKCdvdXRwdXQnLCB3b3JkX29iai5ub2RlLCAncG9zaXRpb24nKQogICAgICAgICAgICBrZXlzID0ge30KICAgICAgICAgICAga2V5czIgPSB7fQogICAgICAgICAgICB0aW1lX3YgPSAwLjAKICAgICAgICAgICAgZm9yIF9pIGluIHJhbmdlKDEwKToKICAgICAgICAgICAgICAgIHZhbCA9IHggKyAocmFuZG9tLnJhbmRvbSgpIC0gMC41KSAqIDAuOAogICAgICAgICAgICAgICAgdmFsMiA9IHggKyAocmFuZG9tLnJhbmRvbSgpIC0gMC41KSAqIDAuOAogICAgICAgICAgICAgICAga2V5c1t0aW1lX3YgKiBzZWxmLl90c10gPSB2YWwKICAgICAgICAgICAgICAgIGtleXMyW3RpbWVfdiAqIHNlbGYuX3RzXSA9IHZhbDIgKyA1CiAgICAgICAgICAgICAgICB0aW1lX3YgKz0gcmFuZG9tLnJhbmRvbSgpICogMC4xCiAgICAgICAgICAgIGlmIGNtYiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGJhLmFuaW1hdGUoY21iLCAnaW5wdXQwJywga2V5cywgbG9vcD1UcnVlKQogICAgICAgICAgICBpZiBjbWIyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgYmEuYW5pbWF0ZShjbWIyLCAnaW5wdXQwJywga2V5czIsIGxvb3A9VHJ1ZSkKICAgICAgICAgICAga2V5cyA9IHt9CiAgICAgICAgICAgIGtleXMyID0ge30KICAgICAgICAgICAgdGltZV92ID0gMAogICAgICAgICAgICBmb3IgX2kgaW4gcmFuZ2UoMTApOgogICAgICAgICAgICAgICAgdmFsID0geSArIChyYW5kb20ucmFuZG9tKCkgLSAwLjUpICogMC44CiAgICAgICAgICAgICAgICB2YWwyID0geSArIChyYW5kb20ucmFuZG9tKCkgLSAwLjUpICogMC44CiAgICAgICAgICAgICAgICBrZXlzW3RpbWVfdiAqIHNlbGYuX3RzXSA9IHZhbAogICAgICAgICAgICAgICAga2V5czJbdGltZV92ICogc2VsZi5fdHNdID0gdmFsMiAtIDkKICAgICAgICAgICAgICAgIHRpbWVfdiArPSByYW5kb20ucmFuZG9tKCkgKiAwLjEKICAgICAgICAgICAgaWYgY21iIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgYmEuYW5pbWF0ZShjbWIsICdpbnB1dDEnLCBrZXlzLCBsb29wPVRydWUpCiAgICAgICAgICAgIGlmIGNtYjIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBiYS5hbmltYXRlKGNtYjIsICdpbnB1dDEnLCBrZXlzMiwgbG9vcD1UcnVlKQoKICAgICAgICBpZiBub3Qgc2hhZG93OgogICAgICAgICAgICBhc3NlcnQgd29yZF9vYmoubm9kZQogICAgICAgICAgICBiYS5hbmltYXRlKHdvcmRfb2JqLm5vZGUsICdwcm9qZWN0X3NjYWxlJywgewogICAgICAgICAgICAgICAgZGVsYXk6IDAuMCwKICAgICAgICAgICAgICAgIGRlbGF5ICsgMC4xOiBzY2FsZSAqIDEuMSwKICAgICAgICAgICAgICAgIGRlbGF5ICsgMC4yOiBzY2FsZQogICAgICAgICAgICB9KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFzc2VydCB3b3JkX29iai5ub2RlCiAgICAgICAgICAgIGJhLmFuaW1hdGUod29yZF9vYmoubm9kZSwgJ3Byb2plY3Rfc2NhbGUnLCB7CiAgICAgICAgICAgICAgICBkZWxheTogMC4wLAogICAgICAgICAgICAgICAgZGVsYXkgKyAwLjE6IHNjYWxlICogMS4xLAogICAgICAgICAgICAgICAgZGVsYXkgKyAwLjI6IHNjYWxlCiAgICAgICAgICAgIH0pCgogICAgZGVmIF9nZXRfY3VzdG9tX2xvZ29fdGV4X25hbWUoc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICBpZiBfYmEuZ2V0X2FjY291bnRfbWlzY19yZWFkX3ZhbCgnZWFzdGVyJywgRmFsc2UpOgogICAgICAgICAgICByZXR1cm4gJ2xvZ29FYXN0ZXInCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAjIFBvcCB0aGUgbG9nbyBhbmQgbWVudSBpbi4KICAgIGRlZiBfbWFrZV9sb2dvKHNlbGYsCiAgICAgICAgICAgICAgICAgICB4OiBmbG9hdCwKICAgICAgICAgICAgICAgICAgIHk6IGZsb2F0LAogICAgICAgICAgICAgICAgICAgc2NhbGU6IGZsb2F0LAogICAgICAgICAgICAgICAgICAgZGVsYXk6IGZsb2F0LAogICAgICAgICAgICAgICAgICAgY3VzdG9tX3RleHR1cmU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICBqaXR0ZXJfc2NhbGU6IGZsb2F0ID0gMS4wLAogICAgICAgICAgICAgICAgICAgcm90YXRlOiBmbG9hdCA9IDAuMCwKICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldDogZmxvYXQgPSAwLjApIC0+IE5vbmU6CgogICAgICAgICMgVGVtcCBlYXN0ZXIgZ29vZG5lc3MuCiAgICAgICAgaWYgY3VzdG9tX3RleHR1cmUgaXMgTm9uZToKICAgICAgICAgICAgY3VzdG9tX3RleHR1cmUgPSBzZWxmLl9nZXRfY3VzdG9tX2xvZ29fdGV4X25hbWUoKQogICAgICAgIHNlbGYuX2N1c3RvbV9sb2dvX3RleF9uYW1lID0gY3VzdG9tX3RleHR1cmUKICAgICAgICBsdGV4ID0gYmEuZ2V0dGV4dHVyZSgKICAgICAgICAgICAgY3VzdG9tX3RleHR1cmUgaWYgY3VzdG9tX3RleHR1cmUgaXMgbm90IE5vbmUgZWxzZSAnbG9nbycpCiAgICAgICAgbW9wYXF1ZSA9IChOb25lIGlmIGN1c3RvbV90ZXh0dXJlIGlzIG5vdCBOb25lIGVsc2UgYmEuZ2V0bW9kZWwoJ2xvZ28nKSkKICAgICAgICBtdHJhbnMgPSAoTm9uZSBpZiBjdXN0b21fdGV4dHVyZSBpcyBub3QgTm9uZSBlbHNlCiAgICAgICAgICAgICAgICAgIGJhLmdldG1vZGVsKCdsb2dvVHJhbnNwYXJlbnQnKSkKICAgICAgICBsb2dvID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCdpbWFnZScsCiAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dHVyZSc6IGx0ZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbF9vcGFxdWUnOiBtb3BhcXVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9kZWxfdHJhbnNwYXJlbnQnOiBtdHJhbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICd2cl9kZXB0aCc6IC0xMCArIHZyX2RlcHRoX29mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JvdGF0ZSc6IHJvdGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2F0dGFjaCc6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAndGlsdF90cmFuc2xhdGUnOiAwLjIxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnYWJzb2x1dGVfc2NhbGUnOiBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgc2VsZi5fbG9nb19ub2RlID0gbG9nby5ub2RlCiAgICAgICAgc2VsZi5fd29yZF9hY3RvcnMuYXBwZW5kKGxvZ28pCgogICAgICAgICMgQWRkIGEgYml0IG9mIHN0b3AtbW90aW9uLXkgaml0dGVyIHRvIHRoZSBsb2dvCiAgICAgICAgIyAodW5sZXNzIHdlJ3JlIGluIFZSIG1vZGUgaW4gd2hpY2ggY2FzZSBpdHMgYmVzdCB0bwogICAgICAgICMgbGVhdmUgdGhpbmdzIHN0aWxsKS4KICAgICAgICBhc3NlcnQgbG9nby5ub2RlCiAgICAgICAgaWYgbm90IGJhLmFwcC52cl9tb2RlOgogICAgICAgICAgICBjbWIgPSBiYS5uZXdub2RlKCdjb21iaW5lJywgb3duZXI9bG9nby5ub2RlLCBhdHRycz17J3NpemUnOiAyfSkKICAgICAgICAgICAgY21iLmNvbm5lY3RhdHRyKCdvdXRwdXQnLCBsb2dvLm5vZGUsICdwb3NpdGlvbicpCiAgICAgICAgICAgIGtleXMgPSB7fQogICAgICAgICAgICB0aW1lX3YgPSAwLjAKCiAgICAgICAgICAgICMgR2VuIHNvbWUgcmFuZG9tIGtleXMgZm9yIHRoYXQgc3RvcC1tb3Rpb24teSBsb29rCiAgICAgICAgICAgIGZvciBfaSBpbiByYW5nZSgxMCk6CiAgICAgICAgICAgICAgICBrZXlzW3RpbWVfdl0gPSB4ICsgKHJhbmRvbS5yYW5kb20oKSAtIDAuNSkgKiAwLjcgKiBqaXR0ZXJfc2NhbGUKICAgICAgICAgICAgICAgIHRpbWVfdiArPSByYW5kb20ucmFuZG9tKCkgKiAwLjEKICAgICAgICAgICAgYmEuYW5pbWF0ZShjbWIsICdpbnB1dDAnLCBrZXlzLCBsb29wPVRydWUpCiAgICAgICAgICAgIGtleXMgPSB7fQogICAgICAgICAgICB0aW1lX3YgPSAwLjAKICAgICAgICAgICAgZm9yIF9pIGluIHJhbmdlKDEwKToKICAgICAgICAgICAgICAgIGtleXNbdGltZV92ICogc2VsZi5fdHNdID0geSArIChyYW5kb20ucmFuZG9tKCkgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuNSkgKiAwLjcgKiBqaXR0ZXJfc2NhbGUKICAgICAgICAgICAgICAgIHRpbWVfdiArPSByYW5kb20ucmFuZG9tKCkgKiAwLjEKICAgICAgICAgICAgYmEuYW5pbWF0ZShjbWIsICdpbnB1dDEnLCBrZXlzLCBsb29wPVRydWUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nby5ub2RlLnBvc2l0aW9uID0gKHgsIHkpCgogICAgICAgIGNtYiA9IGJhLm5ld25vZGUoJ2NvbWJpbmUnLCBvd25lcj1sb2dvLm5vZGUsIGF0dHJzPXsnc2l6ZSc6IDJ9KQoKICAgICAgICBrZXlzID0gewogICAgICAgICAgICBkZWxheTogMC4wLAogICAgICAgICAgICBkZWxheSArIDAuMTogNzAwLjAgKiBzY2FsZSwKICAgICAgICAgICAgZGVsYXkgKyAwLjI6IDYwMC4wICogc2NhbGUKICAgICAgICB9CiAgICAgICAgYmEuYW5pbWF0ZShjbWIsICdpbnB1dDAnLCBrZXlzKQogICAgICAgIGJhLmFuaW1hdGUoY21iLCAnaW5wdXQxJywga2V5cykKICAgICAgICBjbWIuY29ubmVjdGF0dHIoJ291dHB1dCcsIGxvZ28ubm9kZSwgJ3NjYWxlJykKCiAgICBkZWYgX3N0YXJ0X3ByZWxvYWRzKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIyBGSVhNRTogVGhlIGZ1bmMgdGhhdCBjYWxscyB1cyBiYWNrIGRvZXNuJ3Qgc2F2ZS9yZXN0b3JlIHN0YXRlCiAgICAgICAgIyAgb3IgY2hlY2sgZm9yIGEgZGVhZCBhY3Rpdml0eSBzbyB3ZSBoYXZlIHRvIGRvIHRoYXQgb3Vyc2VsZi4KICAgICAgICBpZiBzZWxmLmV4cGlyZWQ6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIHdpdGggYmEuQ29udGV4dChzZWxmKToKICAgICAgICAgICAgX3ByZWxvYWQxKCkKCiAgICAgICAgYmEudGltZXIoMC41LCBsYW1iZGE6IGJhLnNldG11c2ljKGJhLk11c2ljVHlwZS5NRU5VKSkKCgpjb250YWluZXI9YmEuY29udGFpbmVyd2lkZ2V0CmRlZiBuZXdjb250YWluZXJ3aWRnZXREKGVkaXQ6IGJhLldpZGdldCA9IE5vbmUsIHBhcmVudDogYmEuV2lkZ2V0ID0gTm9uZSwgc2l6ZTogU2VxdWVuY2VbZmxvYXRdID0gTm9uZSwgcG9zaXRpb246IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIGJhY2tncm91bmQ6IGJvb2wgPSBOb25lLCBzZWxlY3RlZF9jaGlsZDogYmEuV2lkZ2V0ID0gTm9uZSwgdHJhbnNpdGlvbjogc3RyID0gTm9uZSwgY2FuY2VsX2J1dHRvbjogYmEuV2lkZ2V0ID0gTm9uZSwgc3RhcnRfYnV0dG9uOiBiYS5XaWRnZXQgPSBOb25lLCByb290X3NlbGVjdGFibGU6IGJvb2wgPSBOb25lLCBvbl9hY3RpdmF0ZV9jYWxsOiBDYWxsYWJsZVtbXSwgTm9uZV0gPSBOb25lLCBjbGFpbXNfbGVmdF9yaWdodDogYm9vbCA9IE5vbmUsIGNsYWltc190YWI6IGJvb2wgPSBOb25lLCBzZWxlY3Rpb25fbG9vcHM6IGJvb2wgPSBOb25lLCBzZWxlY3Rpb25fbG9vcHNfdG9fcGFyZW50OiBib29sID0gTm9uZSwgc2NhbGU6IGZsb2F0ID0gTm9uZSwgb25fb3V0c2lkZV9jbGlja19jYWxsOiBDYWxsYWJsZVtbXSwgTm9uZV0gPSBOb25lLCBzaW5nbGVfZGVwdGg6IGJvb2wgPSBOb25lLCB2aXNpYmxlX2NoaWxkOiBiYS5XaWRnZXQgPSBOb25lLCBzdGFja19vZmZzZXQ6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIGNvbG9yOiBTZXF1ZW5jZVtmbG9hdF0gPSAoMC4xNCwwLjE0LDAuMTQpLCBvbl9jYW5jZWxfY2FsbDogQ2FsbGFibGVbW10sIE5vbmVdID0gTm9uZSwgcHJpbnRfbGlzdF9leGl0X2luc3RydWN0aW9uczogYm9vbCA9IE5vbmUsIGNsaWNrX2FjdGl2YXRlOiBib29sID0gTm9uZSwgYWx3YXlzX2hpZ2hsaWdodDogYm9vbCA9IE5vbmUsIHNlbGVjdGFibGU6IGJvb2wgPSBOb25lLCBzY2FsZV9vcmlnaW5fc3RhY2tfb2Zmc2V0OiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCB0b29sYmFyX3Zpc2liaWxpdHk6IHN0ciA9IE5vbmUsIG9uX3NlbGVjdF9jYWxsOiBDYWxsYWJsZVtbXSwgTm9uZV0gPSBOb25lLCBjbGFpbV9vdXRzaWRlX2NsaWNrczogYm9vbCA9IE5vbmUsIGNsYWltc191cF9kb3duOiBib29sID0gTm9uZSkgLT4gYmEuV2lkZ2V0OgogICAgcmV0dXJuIGNvbnRhaW5lcihlZGl0LHBhcmVudCxzaXplLHBvc2l0aW9uLGJhY2tncm91bmQsc2VsZWN0ZWRfY2hpbGQsdHJhbnNpdGlvbixjYW5jZWxfYnV0dG9uLHN0YXJ0X2J1dHRvbixyb290X3NlbGVjdGFibGUsb25fYWN0aXZhdGVfY2FsbCxjbGFpbXNfbGVmdF9yaWdodCxjbGFpbXNfdGFiLHNlbGVjdGlvbl9sb29wcyxzZWxlY3Rpb25fbG9vcHNfdG9fcGFyZW50LHNjYWxlLG9uX291dHNpZGVfY2xpY2tfY2FsbCxzaW5nbGVfZGVwdGgsdmlzaWJsZV9jaGlsZCxzdGFja19vZmZzZXQsY29sb3Isb25fY2FuY2VsX2NhbGwscHJpbnRfbGlzdF9leGl0X2luc3RydWN0aW9ucyxjbGlja19hY3RpdmF0ZSxhbHdheXNfaGlnaGxpZ2h0LHNlbGVjdGFibGUsc2NhbGVfb3JpZ2luX3N0YWNrX29mZnNldCx0b29sYmFyX3Zpc2liaWxpdHksb25fc2VsZWN0X2NhbGwsY2xhaW1fb3V0c2lkZV9jbGlja3MsY2xhaW1zX3VwX2Rvd24pCmNoZWNrYm94PWJhLmNoZWNrYm94d2lkZ2V0CmRlZiBjaGVja2JvRChlZGl0OiBiYS5XaWRnZXQgPSBOb25lLCBwYXJlbnQ6IGJhLldpZGdldCA9IE5vbmUsIHNpemU6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIHBvc2l0aW9uOiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCB0ZXh0OiBVbmlvbltiYS5Mc3RyLCBzdHJdID0gTm9uZSwgdmFsdWU6IGJvb2wgPSBOb25lLCBvbl92YWx1ZV9jaGFuZ2VfY2FsbDogQ2FsbGFibGVbW2Jvb2xdLCBOb25lXSA9IE5vbmUsIG9uX3NlbGVjdF9jYWxsOiBDYWxsYWJsZVtbXSwgTm9uZV0gPSBOb25lLCB0ZXh0X3NjYWxlOiBmbG9hdCA9IE5vbmUsIHRleHRjb2xvcjogU2VxdWVuY2VbZmxvYXRdID0gTm9uZSwgc2NhbGU6IGZsb2F0ID0gTm9uZSwgaXNfcmFkaW9fYnV0dG9uOiBib29sID0gTm9uZSwgbWF4d2lkdGg6IGZsb2F0ID0gTm9uZSwgYXV0b3NlbGVjdDogYm9vbCA9IE5vbmUsIGNvbG9yOiBTZXF1ZW5jZVtmbG9hdF0gPSAoMC4zLDAuMywwLjMpKSAtPiBiYS5XaWRnZXQ6CiAgICByZXR1cm4gY2hlY2tib3goZWRpdCxwYXJlbnQsc2l6ZSxwb3NpdGlvbix0ZXh0LHZhbHVlLG9uX3ZhbHVlX2NoYW5nZV9jYWxsLG9uX3NlbGVjdF9jYWxsLHRleHRfc2NhbGUsdGV4dGNvbG9yLHNjYWxlLGlzX3JhZGlvX2J1dHRvbixtYXh3aWR0aCxhdXRvc2VsZWN0LGNvbG9yKQpjb2x1bW49YmEuY29sdW1ud2lkZ2V0CmRlZiBjb2x1bW53RChlZGl0OiBiYS5XaWRnZXQgPSBOb25lLCBwYXJlbnQ6IGJhLldpZGdldCA9IE5vbmUsIHNpemU6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIHBvc2l0aW9uOiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCBiYWNrZ3JvdW5kOiBib29sID0gTm9uZSwgc2VsZWN0ZWRfY2hpbGQ6IGJhLldpZGdldCA9IE5vbmUsIHZpc2libGVfY2hpbGQ6IGJhLldpZGdldCA9IE5vbmUsIHNpbmdsZV9kZXB0aDogYm9vbCA9IE5vbmUsIHByaW50X2xpc3RfZXhpdF9pbnN0cnVjdGlvbnM6IGJvb2wgPSBOb25lLCBsZWZ0X2JvcmRlcjogZmxvYXQgPSBOb25lLCB0b3BfYm9yZGVyOiBmbG9hdCA9IE5vbmUsIGJvdHRvbV9ib3JkZXI6IGZsb2F0ID0gTm9uZSwgc2VsZWN0aW9uX2xvb3BzX3RvX3BhcmVudDogYm9vbCA9IE5vbmUsIGJvcmRlcjogZmxvYXQgPSBOb25lLCBtYXJnaW46IGZsb2F0ID0gTm9uZSwgY2xhaW1zX2xlZnRfcmlnaHQ6IGJvb2wgPSBOb25lLCBjbGFpbXNfdGFiOiBib29sID0gTm9uZSkgLT4gYmEuV2lkZ2V0OgogICAgY29sdW1uKGVkaXQscGFyZW50LHNpemUscG9zaXRpb24sYmFja2dyb3VuZCxzZWxlY3RlZF9jaGlsZCx2aXNpYmxlX2NoaWxkLHNpbmdsZV9kZXB0aCxwcmludF9saXN0X2V4aXRfaW5zdHJ1Y3Rpb25zLGxlZnRfYm9yZGVyLHRvcF9ib3JkZXIsYm90dG9tX2JvcmRlcixzZWxlY3Rpb25fbG9vcHNfdG9fcGFyZW50LGJvcmRlcixtYXJnaW4sY2xhaW1zX2xlZnRfcmlnaHQsY2xhaW1zX3RhYikKCgoKCgoKCiM9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAjVE9ETwoKY2xhc3MgbmV3TWFpbk1lbnVBY3Rpdml0eUcoYmEuQWN0aXZpdHlbYmEuUGxheWVyLCBiYS5UZWFtXSk6CiAgICAiIiJBY3Rpdml0eSBzaG93aW5nIHRoZSByb3RhdGluZyBtYWluIG1lbnUgYmcgc3R1ZmYuIiIiCgogICAgX3N0ZGFzc2V0cyA9IGJhLkRlcGVuZGVuY3koYmEuQXNzZXRQYWNrYWdlLCAnc3RkYXNzZXRzQDEnKQoKICAgIGRlZiBvbl90cmFuc2l0aW9uX2luKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgc3VwZXIoKS5vbl90cmFuc2l0aW9uX2luKCkKICAgICAgICByYW5kb20uc2VlZCgxMjMpCiAgICAgICAgc2VsZi5fbG9nb19ub2RlOiBPcHRpb25hbFtiYS5Ob2RlXSA9IE5vbmUKICAgICAgICBzZWxmLl9jdXN0b21fbG9nb190ZXhfbmFtZTogT3B0aW9uYWxbc3RyXSA9IE5vbmUKICAgICAgICBzZWxmLl93b3JkX2FjdG9yczogTGlzdFtiYS5BY3Rvcl0gPSBbXQogICAgICAgIGFwcCA9IGJhLmFwcAoKICAgICAgICAjIEZJWE1FOiBXZSBzaG91bGRuJ3QgYmUgZG9pbmcgdGhpbmdzIGNvbmRpdGlvbmFsbHkgYmFzZWQgb24gd2hldGhlcgogICAgICAgICMgIHRoZSBob3N0IGlzIFZSIG1vZGUgb3Igbm90IChjbGllbnRzIG1heSBkaWZmZXIgaW4gdGhhdCByZWdhcmQpLgogICAgICAgICMgIEFueSBkaWZmZXJlbmNlcyBuZWVkIHRvIGhhcHBlbiBhdCB0aGUgZW5naW5lIGxldmVsIHNvIGV2ZXJ5b25lCiAgICAgICAgIyAgc2VlcyB0aGluZ3MgaW4gdGhlaXIgb3duIG9wdGltYWwgd2F5LgogICAgICAgIHZyX21vZGUgPSBiYS5hcHAudnJfbW9kZQoKICAgICAgICBpZiBub3QgYmEuYXBwLnRvb2xiYXJfdGVzdDoKICAgICAgICAgICAgY29sb3IgPSAoKDEuMCwgMS4wLCAxLjAsIDEuMCkgaWYgdnJfbW9kZSBlbHNlICgwLjUsIDAuNiwgMC41LCAwLjYpKQoKICAgICAgICAgICAgIyBGSVhNRTogTmVlZCBhIG5vZGUgYXR0ciBmb3IgdnItc3BlY2lmaWMtc2NhbGUuCiAgICAgICAgICAgIHNjYWxlID0gKDAuOSBpZgogICAgICAgICAgICAgICAgICAgICAoYXBwLnVpLnVpc2NhbGUgaXMgYmEuVUlTY2FsZS5TTUFMTCBvciB2cl9tb2RlKSBlbHNlIDAuNykKICAgICAgICAgICAgc2VsZi5teV9uYW1lID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICAgICAgYmEubmV3bm9kZSgndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzPXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2X2F0dGFjaCc6ICdib3R0b20nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hfYWxpZ24nOiAnY2VudGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb2xvcic6IGNvbG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZsYXRuZXNzJzogMS4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NoYWRvdyc6IDEuMCBpZiB2cl9tb2RlIGVsc2UgMC41LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NjYWxlJzogc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAoMCwgMTApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZyX2RlcHRoJzogLTEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RleHQnOiAnVGhlbWUgcGFjayBieSBNci5TbW9vdGh5IzU4MjQgXHhhOSAyMDExLTIwMjAgRXJpYyBGcm9lbWxpbmcgICAgTW9kIGZyb20gQm9tYlNwb3QnCiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKQoKICAgICAgICAjIFRocm93IHVwIHNvbWUgdGV4dCB0aGF0IG9ubHkgY2xpZW50cyBjYW4gc2VlIHNvIHRoZXkga25vdyB0aGF0IHRoZQogICAgICAgICMgaG9zdCBpcyBuYXZpZ2F0aW5nIG1lbnVzIHdoaWxlIHRoZXkncmUganVzdCBzdGFyaW5nIGF0IGFuCiAgICAgICAgIyBlbXB0eS1pc2ggc2NyZWVuLgogICAgICAgIHR2YWwgPSBiYS5Mc3RyKHJlc291cmNlPSdob3N0SXNOYXZpZ2F0aW5nTWVudXNUZXh0JywKICAgICAgICAgICAgICAgICAgICAgICBzdWJzPVsoJyR7SE9TVH0nLCBfYmEuZ2V0X2FjY291bnRfZGlzcGxheV9zdHJpbmcoKSldKQogICAgICAgIHNlbGYuX2hvc3RfaXNfbmF2aWdhdGluZ190ZXh0ID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogdHZhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsaWVudF9vbmx5JzogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogKDAsIC0yMDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnZmxhdG5lc3MnOiAxLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdoX2FsaWduJzogJ2NlbnRlcicKICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICBpZiBub3QgYmEuYXBwLm1haW5fbWVudV9kaWRfaW5pdGlhbF90cmFuc2l0aW9uIGFuZCBoYXNhdHRyKAogICAgICAgICAgICAgICAgc2VsZiwgJ215X25hbWUnKToKICAgICAgICAgICAgYXNzZXJ0IHNlbGYubXlfbmFtZS5ub2RlCiAgICAgICAgICAgIGJhLmFuaW1hdGUoc2VsZi5teV9uYW1lLm5vZGUsICdvcGFjaXR5JywgezIuMzogMCwgMy4wOiAxLjB9KQoKICAgICAgICAjIEZJWE1FOiBXZSBzaG91bGRuJ3QgYmUgZG9pbmcgdGhpbmdzIGNvbmRpdGlvbmFsbHkgYmFzZWQgb24gd2hldGhlcgogICAgICAgICMgIHRoZSBob3N0IGlzIHZyIG1vZGUgb3Igbm90IChjbGllbnRzIG1heSBub3QgYmUgb3IgdmljZSB2ZXJzYSkuCiAgICAgICAgIyAgQW55IGRpZmZlcmVuY2VzIG5lZWQgdG8gaGFwcGVuIGF0IHRoZSBlbmdpbmUgbGV2ZWwgc28gZXZlcnlvbmUgc2VlcwogICAgICAgICMgIHRoaW5ncyBpbiB0aGVpciBvd24gb3B0aW1hbCB3YXkuCiAgICAgICAgdnJfbW9kZSA9IGFwcC52cl9tb2RlCiAgICAgICAgdWlzY2FsZSA9IGFwcC51aS51aXNjYWxlCgogICAgICAgICMgSW4gY2FzZXMgd2hlcmUgd2UncmUgZG9pbmcgbG90cyBvZiBkZXYgd29yayBsZXRzIGFsd2F5cyBzaG93IHRoZQogICAgICAgICMgYnVpbGQgbnVtYmVyLgogICAgICAgIGZvcmNlX3Nob3dfYnVpbGRfbnVtYmVyID0gRmFsc2UKCiAgICAgICAgaWYgbm90IGJhLmFwcC50b29sYmFyX3Rlc3Q6CiAgICAgICAgICAgIGlmIGFwcC5kZWJ1Z19idWlsZCBvciBhcHAudGVzdF9idWlsZCBvciBmb3JjZV9zaG93X2J1aWxkX251bWJlcjoKICAgICAgICAgICAgICAgIGlmIGFwcC5kZWJ1Z19idWlsZDoKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gYmEuTHN0cih2YWx1ZT0nJHtWfSAoJHtCfSkgKCR7RH0pJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzPVsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCcke1Z9JywgYXBwLnZlcnNpb24pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJyR7Qn0nLCBzdHIoYXBwLmJ1aWxkX251bWJlcikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJyR7RH0nLCBiYS5Mc3RyKHJlc291cmNlPSdkZWJ1Z1RleHQnKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGJhLkxzdHIodmFsdWU9JyR7Vn0gKCR7Qn0pJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzPVsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCcke1Z9JywgYXBwLnZlcnNpb24pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJyR7Qn0nLCBzdHIoYXBwLmJ1aWxkX251bWJlcikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB0ZXh0ID0gYmEuTHN0cih2YWx1ZT0nJHtWfScsIHN1YnM9WygnJHtWfScsIGFwcC52ZXJzaW9uKV0pCiAgICAgICAgICAgIHNjYWxlID0gMC45IGlmICh1aXNjYWxlIGlzIGJhLlVJU2NhbGUuU01BTEwgb3IgdnJfbW9kZSkgZWxzZSAwLjcKICAgICAgICAgICAgY29sb3IgPSAoMSwgMSwgMSwgMSkgaWYgdnJfbW9kZSBlbHNlICgwLjUsIDAuNiwgMC41LCAwLjcpCiAgICAgICAgICAgIHNlbGYudmVyc2lvbiA9IGJhLk5vZGVBY3RvcigKICAgICAgICAgICAgICAgIGJhLm5ld25vZGUoCiAgICAgICAgICAgICAgICAgICAgJ3RleHQnLAogICAgICAgICAgICAgICAgICAgIGF0dHJzPXsKICAgICAgICAgICAgICAgICAgICAgICAgJ3ZfYXR0YWNoJzogJ2JvdHRvbScsCiAgICAgICAgICAgICAgICAgICAgICAgICdoX2F0dGFjaCc6ICdyaWdodCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdoX2FsaWduJzogJ3JpZ2h0JywKICAgICAgICAgICAgICAgICAgICAgICAgJ2ZsYXRuZXNzJzogMS4wLAogICAgICAgICAgICAgICAgICAgICAgICAndnJfZGVwdGgnOiAtMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICdzaGFkb3cnOiAxLjAgaWYgdnJfbW9kZSBlbHNlIDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbG9yJzogY29sb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICdzY2FsZSc6IHNjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAoLTI2MCwgMTApIGlmIHZyX21vZGUgZWxzZSAoLTEwLCAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogdGV4dAogICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICBpZiBub3QgYmEuYXBwLm1haW5fbWVudV9kaWRfaW5pdGlhbF90cmFuc2l0aW9uOgogICAgICAgICAgICAgICAgYXNzZXJ0IHNlbGYudmVyc2lvbi5ub2RlCiAgICAgICAgICAgICAgICBiYS5hbmltYXRlKHNlbGYudmVyc2lvbi5ub2RlLCAnb3BhY2l0eScsIHsyLjM6IDAsIDMuMDogMS4wfSkKCiAgICAgICAgIyBTaG93IHRoZSBpaXJjYWRlIGxvZ28gb24gb3VyIGlpcmNhZGUgYnVpbGQuCiAgICAgICAgaWYgYXBwLmlpcmNhZGVfbW9kZToKICAgICAgICAgICAgaW1nID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICAgICAgYmEubmV3bm9kZSgnaW1hZ2UnLAogICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dHVyZSc6IGJhLmdldHRleHR1cmUoJ2lpcmNhZGVMb2dvJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXR0YWNoJzogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2NhbGUnOiAoMjUwLCAyNTApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogKDAsIDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbHRfdHJhbnNsYXRlJzogMC4yMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhYnNvbHV0ZV9zY2FsZSc6IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLmF1dG9yZXRhaW4oKQogICAgICAgICAgICBpbWdkZWxheSA9IDAuMCBpZiBhcHAubWFpbl9tZW51X2RpZF9pbml0aWFsX3RyYW5zaXRpb24gZWxzZSAxLjAKICAgICAgICAgICAgYmEuYW5pbWF0ZShpbWcubm9kZSwgJ29wYWNpdHknLCB7CiAgICAgICAgICAgICAgICBpbWdkZWxheSArIDEuNTogMC4wLAogICAgICAgICAgICAgICAgaW1nZGVsYXkgKyAyLjU6IDEuMAogICAgICAgICAgICB9KQoKICAgICAgICAjIFRocm93IGluIHRlc3QgYnVpbGQgaW5mby4KICAgICAgICBzZWxmLmJldGFfaW5mbyA9IHNlbGYuYmV0YV9pbmZvXzIgPSBOb25lCiAgICAgICAgaWYgYXBwLnRlc3RfYnVpbGQgYW5kIG5vdCAoYXBwLmRlbW9fbW9kZSBvciBhcHAuYXJjYWRlX21vZGUpOgogICAgICAgICAgICBwb3MgPSAoKDIzMCwgMTI1KSBpZiAoYXBwLmRlbW9fbW9kZSBvciBhcHAuYXJjYWRlX21vZGUpIGVsc2UKICAgICAgICAgICAgICAgICAgICgyMzAsIDM1KSkKICAgICAgICAgICAgc2VsZi5iZXRhX2luZm8gPSBiYS5Ob2RlQWN0b3IoCiAgICAgICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZfYXR0YWNoJzogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaF9hbGlnbic6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbG9yJzogKDEsIDEsIDEsIDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NoYWRvdyc6IDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdmbGF0bmVzcyc6IDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzY2FsZSc6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndnJfZGVwdGgnOiAtNjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiBwb3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dCc6IGJhLkxzdHIocmVzb3VyY2U9J3Rlc3RCdWlsZFRleHQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgaWYgbm90IGJhLmFwcC5tYWluX21lbnVfZGlkX2luaXRpYWxfdHJhbnNpdGlvbjoKICAgICAgICAgICAgICAgIGFzc2VydCBzZWxmLmJldGFfaW5mby5ub2RlCiAgICAgICAgICAgICAgICBiYS5hbmltYXRlKHNlbGYuYmV0YV9pbmZvLm5vZGUsICdvcGFjaXR5JywgezEuMzogMCwgMS44OiAxLjB9KQoKICAgICAgICBtb2RlbCA9IGJhLmdldG1vZGVsKCd0aGVQYWRMZXZlbCcpCiAgICAgICAgdHJlZXNfbW9kZWwgPSBiYS5nZXRtb2RlbCgndHJlZXMnKQogICAgICAgIGJvdHRvbV9tb2RlbCA9IGJhLmdldG1vZGVsKCd0aGVQYWRMZXZlbEJvdHRvbScpCiAgICAgICAgY29sb3JfdGV4dHVyZSA9IGJhLmdldHRleHR1cmUoJ3RoZVBhZExldmVsQ29sb3InKQogICAgICAgIHRyZWVzX3RleHR1cmUgPSBiYS5nZXR0ZXh0dXJlKCd0cmVlc0NvbG9yJykKICAgICAgICBiZ3RleCA9IGJhLmdldHRleHR1cmUoJ21lbnVCRycpCiAgICAgICAgYmdtb2RlbCA9IGJhLmdldG1vZGVsKCd0aGVQYWRCRycpCgogICAgICAgICMgTG9hZCB0aGVzZSBsYXN0IHNpbmNlIG1vc3QgcGxhdGZvcm1zIGRvbid0IHVzZSB0aGVtLgogICAgICAgIHZyX2JvdHRvbV9maWxsX21vZGVsID0gYmEuZ2V0bW9kZWwoJ3RoZVBhZFZSRmlsbEJvdHRvbScpCiAgICAgICAgdnJfdG9wX2ZpbGxfbW9kZWwgPSBiYS5nZXRtb2RlbCgndGhlUGFkVlJGaWxsVG9wJykKCiAgICAgICAgZ25vZGUgPSBzZWxmLmdsb2JhbHNub2RlCiAgICAgICAgZ25vZGUuY2FtZXJhX21vZGUgPSAncm90YXRlJwoKICAgICAgICB0aW50ID0gKDEsMC42OSwwLjk3KQogICAgICAgIGdub2RlLnRpbnQgPSB0aW50CiAgICAgICAgZ25vZGUuYW1iaWVudF9jb2xvciA9ICgxLjA2LCAxLjA0LCAxLjAzKQogICAgICAgIGdub2RlLnZpZ25ldHRlX291dGVyID0gKDAuNDUsIDAuNTUsIDAuNTQpCiAgICAgICAgZ25vZGUudmlnbmV0dGVfaW5uZXIgPSAoMC45OSwgMC45OCwgMC45OCkKCiAgICAgICAgc2VsZi5ib3R0b20gPSBiYS5Ob2RlQWN0b3IoCiAgICAgICAgICAgIGJhLm5ld25vZGUoJ3RlcnJhaW4nLAogICAgICAgICAgICAgICAgICAgICAgIGF0dHJzPXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21vZGVsJzogYm90dG9tX21vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnbGlnaHRpbmcnOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZmxlY3Rpb24nOiAnc29mdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWZsZWN0aW9uX3NjYWxlJzogWzAuNDVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IGNvbG9yX3RleHR1cmUKICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICBzZWxmLnZyX2JvdHRvbV9maWxsID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXJyYWluJywKICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbCc6IHZyX2JvdHRvbV9maWxsX21vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnbGlnaHRpbmcnOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZyX29ubHknOiBUcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IGNvbG9yX3RleHR1cmUKICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICBzZWxmLnZyX3RvcF9maWxsID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXJyYWluJywKICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbCc6IHZyX3RvcF9maWxsX21vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAndnJfb25seSc6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdsaWdodGluZyc6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IGJndGV4CiAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgc2VsZi50ZXJyYWluID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXJyYWluJywKICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbCc6IG1vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IGNvbG9yX3RleHR1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWZsZWN0aW9uJzogJ3NvZnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAncmVmbGVjdGlvbl9zY2FsZSc6IFswLjNdCiAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgc2VsZi50cmVlcyA9IGJhLk5vZGVBY3RvcigKICAgICAgICAgICAgYmEubmV3bm9kZSgndGVycmFpbicsCiAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9kZWwnOiB0cmVlc19tb2RlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xpZ2h0aW5nJzogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZWZsZWN0aW9uJzogJ2NoYXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAncmVmbGVjdGlvbl9zY2FsZSc6IFswLjFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3JfdGV4dHVyZSc6IHRyZWVzX3RleHR1cmUKICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICBzZWxmLmJndGVycmFpbiA9IGJhLk5vZGVBY3RvcigKICAgICAgICAgICAgYmEubmV3bm9kZSgndGVycmFpbicsCiAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9kZWwnOiBiZ21vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3InOiAoMC45MiwgMC45MSwgMC45KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xpZ2h0aW5nJzogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kJzogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbG9yX3RleHR1cmUnOiBiZ3RleAogICAgICAgICAgICAgICAgICAgICAgIH0pKQoKICAgICAgICBzZWxmLl90cyA9IDAuODYKCiAgICAgICAgc2VsZi5fbGFuZ3VhZ2U6IE9wdGlvbmFsW3N0cl0gPSBOb25lCiAgICAgICAgc2VsZi5fdXBkYXRlX3RpbWVyID0gYmEuVGltZXIoMS4wLCBzZWxmLl91cGRhdGUsIHJlcGVhdD1UcnVlKQogICAgICAgIHNlbGYuX3VwZGF0ZSgpCgogICAgICAgICMgSG9wZWZ1bGx5IHRoaXMgd29uJ3QgaGl0Y2ggYnV0IGxldHMgc3BhY2UgdGhlc2Ugb3V0IGFueXdheS4KICAgICAgICBfYmEuYWRkX2NsZWFuX2ZyYW1lX2NhbGxiYWNrKGJhLldlYWtDYWxsKHNlbGYuX3N0YXJ0X3ByZWxvYWRzKSkKCiAgICAgICAgcmFuZG9tLnNlZWQoKQoKICAgICAgICAjIE9uIHRoZSBtYWluIG1lbnUsIGFsc28gc2hvdyBvdXIgbmV3cy4KICAgICAgICBjbGFzcyBOZXdzOgogICAgICAgICAgICAiIiJXcmFuZ2xlcyBuZXdzIGRpc3BsYXkuIiIiCgogICAgICAgICAgICBkZWYgX19pbml0X18oc2VsZiwgYWN0aXZpdHk6IGJhLkFjdGl2aXR5KToKICAgICAgICAgICAgICAgIHNlbGYuX3ZhbGlkID0gVHJ1ZQogICAgICAgICAgICAgICAgc2VsZi5fbWVzc2FnZV9kdXJhdGlvbiA9IDEwLjAKICAgICAgICAgICAgICAgIHNlbGYuX21lc3NhZ2Vfc3BhY2luZyA9IDIuMAogICAgICAgICAgICAgICAgc2VsZi5fdGV4dDogT3B0aW9uYWxbYmEuTm9kZUFjdG9yXSA9IE5vbmUKICAgICAgICAgICAgICAgIHNlbGYuX2FjdGl2aXR5ID0gd2Vha3JlZi5yZWYoYWN0aXZpdHkpCgogICAgICAgICAgICAgICAgIyBJZiB3ZSdyZSBzaWduZWQgaW4sIGZldGNoIG5ld3MgaW1tZWRpYXRlbHkuCiAgICAgICAgICAgICAgICAjIE90aGVyd2lzZSB3YWl0IHVudGlsIHdlIGFyZSBzaWduZWQgaW4uCiAgICAgICAgICAgICAgICBzZWxmLl9mZXRjaF90aW1lcjogT3B0aW9uYWxbYmEuVGltZXJdID0gYmEuVGltZXIoCiAgICAgICAgICAgICAgICAgICAgMS4wLCBiYS5XZWFrQ2FsbChzZWxmLl90cnlfZmV0Y2hpbmdfbmV3cyksIHJlcGVhdD1UcnVlKQogICAgICAgICAgICAgICAgc2VsZi5fdHJ5X2ZldGNoaW5nX25ld3MoKQoKICAgICAgICAgICAgIyBXZSBub3cgd2FudCB0byB3YWl0IHVudGlsIHdlJ3JlIHNpZ25lZCBpbiBiZWZvcmUgZmV0Y2hpbmcgbmV3cy4KICAgICAgICAgICAgZGVmIF90cnlfZmV0Y2hpbmdfbmV3cyhzZWxmKSAtPiBOb25lOgogICAgICAgICAgICAgICAgaWYgX2JhLmdldF9hY2NvdW50X3N0YXRlKCkgPT0gJ3NpZ25lZF9pbic6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmV0Y2hfbmV3cygpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmV0Y2hfdGltZXIgPSBOb25lCgogICAgICAgICAgICBkZWYgX2ZldGNoX25ld3Moc2VsZikgLT4gTm9uZToKICAgICAgICAgICAgICAgIGJhLmFwcC5tYWluX21lbnVfbGFzdF9uZXdzX2ZldGNoX3RpbWUgPSB0aW1lLnRpbWUoKQoKICAgICAgICAgICAgICAgICMgVVBEQVRFIC0gV2Ugbm93IGp1c3QgcHVsbCBuZXdzIGZyb20gTVJWcy4KICAgICAgICAgICAgICAgIG5ld3MgPSBfYmEuZ2V0X2FjY291bnRfbWlzY19yZWFkX3ZhbCgnbicsIE5vbmUpCiAgICAgICAgICAgICAgICBpZiBuZXdzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2dvdF9uZXdzKG5ld3MpCgogICAgICAgICAgICBkZWYgX2NoYW5nZV9waHJhc2Uoc2VsZikgLT4gTm9uZToKICAgICAgICAgICAgICAgIGZyb20gYmFzdGQuYWN0b3IudGV4dCBpbXBvcnQgVGV4dAoKICAgICAgICAgICAgICAgICMgSWYgb3VyIG5ld3MgaXMgd2F5IG91dCBvZiBkYXRlLCBsZXRzIHJlLXJlcXVlc3QgaXQ7CiAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSwgcm90YXRlIG91ciBwaHJhc2UuCiAgICAgICAgICAgICAgICBhc3NlcnQgYmEuYXBwLm1haW5fbWVudV9sYXN0X25ld3NfZmV0Y2hfdGltZSBpcyBub3QgTm9uZQogICAgICAgICAgICAgICAgaWYgdGltZS50aW1lKCkgLSBiYS5hcHAubWFpbl9tZW51X2xhc3RfbmV3c19mZXRjaF90aW1lID4gNjAwLjA6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZmV0Y2hfbmV3cygpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fdGV4dCA9IE5vbmUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5fdGV4dCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX3BocmFzZXM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcGhyIGluIHNlbGYuX3VzZWRfcGhyYXNlczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9waHJhc2VzLmluc2VydCgwLCBwaHIpCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHNlbGYuX3BocmFzZXMucG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdmFsID09ICdfX0FDSF9fJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZybW9kZSA9IGFwcC52cl9tb2RlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0KGJhLkxzdHIocmVzb3VyY2U9J25leHRBY2hpZXZlbWVudHNUZXh0JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPSgoMSwgMSwgMSwgMSkgaWYgdnJtb2RlIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgwLjk1LCAwLjksIDEsIDAuNCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0X29ubHk9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4d2lkdGg9MjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbj0oLTMwMCwgLTM1KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaF9hbGlnbj1UZXh0LkhBbGlnbi5SSUdIVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbj1UZXh0LlRyYW5zaXRpb24uRkFERV9JTiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9MC45IGlmIHZybW9kZSBlbHNlIDAuNywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhdG5lc3M9MS4wIGlmIHZybW9kZSBlbHNlIDAuNiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PTEuMCBpZiB2cm1vZGUgZWxzZSAwLjUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhfYXR0YWNoPVRleHQuSEF0dGFjaC5DRU5URVIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZfYXR0YWNoPVRleHQuVkF0dGFjaC5UT1AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb25fZGVsYXk9MS4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uX291dF9kZWxheT1zZWxmLl9tZXNzYWdlX2R1cmF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkuYXV0b3JldGFpbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2hzID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgZm9yIGEgaW4gYXBwLmFjaC5hY2hpZXZlbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgYS5jb21wbGV0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWNoczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2ggPSBhY2hzLnBvcCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tLnJhbmRyYW5nZShtaW4oNCwgbGVuKGFjaHMpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNoLmNyZWF0ZV9kaXNwbGF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtMTgwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtMzUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEuMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZGVsYXk9c2VsZi5fbWVzc2FnZV9kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9J25ld3MnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWNoczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2ggPSBhY2hzLnBvcCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tLnJhbmRyYW5nZShtaW4oOCwgbGVuKGFjaHMpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNoLmNyZWF0ZV9kaXNwbGF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxODAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0zNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMS4yNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZGVsYXk9c2VsZi5fbWVzc2FnZV9kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9J25ld3MnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BjID0gc2VsZi5fbWVzc2FnZV9zcGFjaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYzogMC4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYyArIDEuMDogMS4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYyArIHNlbGYuX21lc3NhZ2VfZHVyYXRpb24gLSAxLjA6IDEuMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGMgKyBzZWxmLl9tZXNzYWdlX2R1cmF0aW9uOiAwLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydCBzZWxmLl90ZXh0Lm5vZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhLmFuaW1hdGUoc2VsZi5fdGV4dC5ub2RlLCAnb3BhY2l0eScsIGtleXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHtrOiB2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICBmb3IgaywgdiBpbiBsaXN0KGtleXMuaXRlbXMoKSl9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdGV4dC5ub2RlLnRleHQgPSB2YWwKCiAgICAgICAgICAgIGRlZiBfZ290X25ld3Moc2VsZiwgbmV3czogc3RyKSAtPiBOb25lOgogICAgICAgICAgICAgICAgIyBSdW4gdGhpcyBzdHVmZiBpbiB0aGUgY29udGV4dCBvZiBvdXIgYWN0aXZpdHkgc2luY2Ugd2UKICAgICAgICAgICAgICAgICMgbmVlZCB0byBtYWtlIG5vZGVzIGFuZCBzdHVmZi4uIHNob3VsZCBmaXggdGhlIHNlcnZlcmdldAogICAgICAgICAgICAgICAgIyBjYWxsIHNvIGl0LgogICAgICAgICAgICAgICAgYWN0aXZpdHkgPSBzZWxmLl9hY3Rpdml0eSgpCiAgICAgICAgICAgICAgICBpZiBhY3Rpdml0eSBpcyBOb25lIG9yIGFjdGl2aXR5LmV4cGlyZWQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB3aXRoIGJhLkNvbnRleHQoYWN0aXZpdHkpOgoKICAgICAgICAgICAgICAgICAgICBzZWxmLl9waHJhc2VzOiBMaXN0W3N0cl0gPSBbXQoKICAgICAgICAgICAgICAgICAgICAjIFNob3cgdXBjb21pbmcgYWNoaWV2ZW1lbnRzIGluIG5vbi12ciB2ZXJzaW9ucwogICAgICAgICAgICAgICAgICAgICMgKGN1cnJlbnRseSB0b28gaGFyZCB0byByZWFkIGluIHZyKS4KICAgICAgICAgICAgICAgICAgICBzZWxmLl91c2VkX3BocmFzZXMgPSAoCiAgICAgICAgICAgICAgICAgICAgICAgIFsnX19BQ0hfXyddIGlmIG5vdCBiYS5hcHAudnJfbW9kZSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIFtdKSArIFtzIGZvciBzIGluIG5ld3Muc3BsaXQoJzxicj5cbicpIGlmIHMgIT0gJyddCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcGhyYXNlX2NoYW5nZV90aW1lciA9IGJhLlRpbWVyKAogICAgICAgICAgICAgICAgICAgICAgICAoc2VsZi5fbWVzc2FnZV9kdXJhdGlvbiArIHNlbGYuX21lc3NhZ2Vfc3BhY2luZyksCiAgICAgICAgICAgICAgICAgICAgICAgIGJhLldlYWtDYWxsKHNlbGYuX2NoYW5nZV9waHJhc2UpLAogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQ9VHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgc2NsID0gMS4yIGlmIChiYS5hcHAudWkudWlzY2FsZSBpcyBiYS5VSVNjYWxlLlNNQUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBiYS5hcHAudnJfbW9kZSkgZWxzZSAwLjgKCiAgICAgICAgICAgICAgICAgICAgY29sb3IyID0gKCgxLCAxLCAxLCAxKSBpZiBiYS5hcHAudnJfbW9kZSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgwLjcsIDAuNjUsIDAuNzUsIDEuMCkpCiAgICAgICAgICAgICAgICAgICAgc2hhZG93ID0gKDEuMCBpZiBiYS5hcHAudnJfbW9kZSBlbHNlIDAuNCkKICAgICAgICAgICAgICAgICAgICBzZWxmLl90ZXh0ID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICAgICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2X2F0dGFjaCc6ICd0b3AnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaF9hdHRhY2gnOiAnY2VudGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hfYWxpZ24nOiAnY2VudGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZyX2RlcHRoJzogLTIwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2hhZG93Jzogc2hhZG93LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmxhdG5lc3MnOiAwLjgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2X2FsaWduJzogJ3RvcCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb2xvcic6IGNvbG9yMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NjYWxlJzogc2NsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWF4d2lkdGgnOiA5MDAuMCAvIHNjbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogKDAsIC0xMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICAgICBzZWxmLl9jaGFuZ2VfcGhyYXNlKCkKCiAgICAgICAgaWYgbm90IChhcHAuZGVtb19tb2RlIG9yIGFwcC5hcmNhZGVfbW9kZSkgYW5kIG5vdCBhcHAudG9vbGJhcl90ZXN0OgogICAgICAgICAgICBzZWxmLl9uZXdzID0gTmV3cyhzZWxmKQoKICAgICAgICAjIEJyaW5nIHVwIHRoZSBsYXN0IHBsYWNlIHdlIHdlcmUsIG9yIHN0YXJ0IGF0IHRoZSBtYWluIG1lbnUgb3RoZXJ3aXNlLgogICAgICAgIHdpdGggYmEuQ29udGV4dCgndWknKToKICAgICAgICAgICAgZnJvbSBiYXN0ZC51aSBpbXBvcnQgc3BlY2lhbG9mZmVyCiAgICAgICAgICAgIGlmIGJvb2woRmFsc2UpOgogICAgICAgICAgICAgICAgdWljb250cm9sbGVyID0gYmEuYXBwLnVpLmNvbnRyb2xsZXIKICAgICAgICAgICAgICAgIGFzc2VydCB1aWNvbnRyb2xsZXIgaXMgbm90IE5vbmUKICAgICAgICAgICAgICAgIHVpY29udHJvbGxlci5zaG93X21haW5fbWVudSgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBtYWluX21lbnVfbG9jYXRpb24gPSBiYS5hcHAudWkuZ2V0X21haW5fbWVudV9sb2NhdGlvbigpCgogICAgICAgICAgICAgICAgIyBXaGVuIGNvbWluZyBiYWNrIGZyb20gYSBraW9zay1tb2RlIGdhbWUsIGp1bXAgdG8KICAgICAgICAgICAgICAgICMgdGhlIGtpb3NrIHN0YXJ0IHNjcmVlbi4KICAgICAgICAgICAgICAgIGlmIGJhLmFwcC5kZW1vX21vZGUgb3IgYmEuYXBwLmFyY2FkZV9tb2RlOgogICAgICAgICAgICAgICAgICAgICMgcHlsaW50OiBkaXNhYmxlPWN5Y2xpYy1pbXBvcnQKICAgICAgICAgICAgICAgICAgICBmcm9tIGJhc3RkLnVpLmtpb3NrIGltcG9ydCBLaW9za1dpbmRvdwogICAgICAgICAgICAgICAgICAgIGJhLmFwcC51aS5zZXRfbWFpbl9tZW51X3dpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgS2lvc2tXaW5kb3coKS5nZXRfcm9vdF93aWRnZXQoKSkKICAgICAgICAgICAgICAgICMgLi5vciBpbiBub3JtYWwgY2FzZXMgZ28gYmFjayB0byB0aGUgbWFpbiBtZW51CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIG1haW5fbWVudV9sb2NhdGlvbiA9PSAnR2F0aGVyJzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGJhc3RkLnVpLmdhdGhlciBpbXBvcnQgR2F0aGVyV2luZG93CiAgICAgICAgICAgICAgICAgICAgICAgIGJhLmFwcC51aS5zZXRfbWFpbl9tZW51X3dpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhdGhlcldpbmRvdyh0cmFuc2l0aW9uPU5vbmUpLmdldF9yb290X3dpZGdldCgpKQogICAgICAgICAgICAgICAgICAgIGVsaWYgbWFpbl9tZW51X2xvY2F0aW9uID09ICdXYXRjaCc6CiAgICAgICAgICAgICAgICAgICAgICAgICMgcHlsaW50OiBkaXNhYmxlPWN5Y2xpYy1pbXBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBiYXN0ZC51aS53YXRjaCBpbXBvcnQgV2F0Y2hXaW5kb3cKICAgICAgICAgICAgICAgICAgICAgICAgYmEuYXBwLnVpLnNldF9tYWluX21lbnVfd2luZG93KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgV2F0Y2hXaW5kb3codHJhbnNpdGlvbj1Ob25lKS5nZXRfcm9vdF93aWRnZXQoKSkKICAgICAgICAgICAgICAgICAgICBlbGlmIG1haW5fbWVudV9sb2NhdGlvbiA9PSAnVGVhbSBHYW1lIFNlbGVjdCc6CiAgICAgICAgICAgICAgICAgICAgICAgICMgcHlsaW50OiBkaXNhYmxlPWN5Y2xpYy1pbXBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBiYXN0ZC51aS5wbGF5bGlzdC5icm93c2VyIGltcG9ydCAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQbGF5bGlzdEJyb3dzZXJXaW5kb3cpCiAgICAgICAgICAgICAgICAgICAgICAgIGJhLmFwcC51aS5zZXRfbWFpbl9tZW51X3dpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYXlsaXN0QnJvd3NlcldpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9udHlwZT1iYS5EdWFsVGVhbVNlc3Npb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbj1Ob25lKS5nZXRfcm9vdF93aWRnZXQoKSkKICAgICAgICAgICAgICAgICAgICBlbGlmIG1haW5fbWVudV9sb2NhdGlvbiA9PSAnRnJlZS1mb3ItQWxsIEdhbWUgU2VsZWN0JzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGJhc3RkLnVpLnBsYXlsaXN0LmJyb3dzZXIgaW1wb3J0ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYXlsaXN0QnJvd3NlcldpbmRvdykKICAgICAgICAgICAgICAgICAgICAgICAgYmEuYXBwLnVpLnNldF9tYWluX21lbnVfd2luZG93KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxheWxpc3RCcm93c2VyV2luZG93KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb250eXBlPWJhLkZyZWVGb3JBbGxTZXNzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb249Tm9uZSkuZ2V0X3Jvb3Rfd2lkZ2V0KCkpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBtYWluX21lbnVfbG9jYXRpb24gPT0gJ0Nvb3AgU2VsZWN0JzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGJhc3RkLnVpLmNvb3AuYnJvd3NlciBpbXBvcnQgQ29vcEJyb3dzZXJXaW5kb3cKICAgICAgICAgICAgICAgICAgICAgICAgYmEuYXBwLnVpLnNldF9tYWluX21lbnVfd2luZG93KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29vcEJyb3dzZXJXaW5kb3coCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbj1Ob25lKS5nZXRfcm9vdF93aWRnZXQoKSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIHB5bGludDogZGlzYWJsZT1jeWNsaWMtaW1wb3J0CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gYmFzdGQudWkubWFpbm1lbnUgaW1wb3J0IE1haW5NZW51V2luZG93CiAgICAgICAgICAgICAgICAgICAgICAgIGJhLmFwcC51aS5zZXRfbWFpbl9tZW51X3dpbmRvdygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1haW5NZW51V2luZG93KHRyYW5zaXRpb249Tm9uZSkuZ2V0X3Jvb3Rfd2lkZ2V0KCkpCgogICAgICAgICAgICAgICAgIyBhdHRlbXB0IHRvIHNob3cgYW55IHBlbmRpbmcgb2ZmZXJzIGltbWVkaWF0ZWx5LgogICAgICAgICAgICAgICAgIyBJZiB0aGF0IGRvZXNuJ3Qgd29yaywgdHJ5IGFnYWluIGluIGEgZmV3IHNlY29uZHMKICAgICAgICAgICAgICAgICMgKHdlIG1heSBub3QgaGF2ZSBoZWFyZCBiYWNrIGZyb20gdGhlIHNlcnZlcikKICAgICAgICAgICAgICAgICMgLi5pZiB0aGF0IGRvZXNuJ3Qgd29yayB0aGV5J2xsIGp1c3QgaGF2ZSB0byB3YWl0CiAgICAgICAgICAgICAgICAjIHVudGlsIHRoZSBuZXh0IG9wcG9ydHVuaXR5LgogICAgICAgICAgICAgICAgaWYgbm90IHNwZWNpYWxvZmZlci5zaG93X29mZmVyKCk6CgogICAgICAgICAgICAgICAgICAgIGRlZiB0cnlfYWdhaW4oKSAtPiBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc3BlY2lhbG9mZmVyLnNob3dfb2ZmZXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVHJ5IG9uZSBsYXN0IHRpbWUuLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmEudGltZXIoMi4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lhbG9mZmVyLnNob3dfb2ZmZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1ldHlwZT1iYS5UaW1lVHlwZS5SRUFMKQoKICAgICAgICAgICAgICAgICAgICBiYS50aW1lcigyLjAsIHRyeV9hZ2FpbiwgdGltZXR5cGU9YmEuVGltZVR5cGUuUkVBTCkKICAgICAgICBiYS5hcHAubWFpbl9tZW51X2RpZF9pbml0aWFsX3RyYW5zaXRpb24gPSBUcnVlCgogICAgZGVmIF91cGRhdGUoc2VsZikgLT4gTm9uZToKICAgICAgICBhcHAgPSBiYS5hcHAKCiAgICAgICAgIyBVcGRhdGUgbG9nbyBpbiBjYXNlIGl0IGNoYW5nZXMuCiAgICAgICAgaWYgc2VsZi5fbG9nb19ub2RlOgogICAgICAgICAgICBjdXN0b21fdGV4dHVyZSA9IHNlbGYuX2dldF9jdXN0b21fbG9nb190ZXhfbmFtZSgpCiAgICAgICAgICAgIGlmIGN1c3RvbV90ZXh0dXJlICE9IHNlbGYuX2N1c3RvbV9sb2dvX3RleF9uYW1lOgogICAgICAgICAgICAgICAgc2VsZi5fY3VzdG9tX2xvZ29fdGV4X25hbWUgPSBjdXN0b21fdGV4dHVyZQogICAgICAgICAgICAgICAgc2VsZi5fbG9nb19ub2RlLnRleHR1cmUgPSBiYS5nZXR0ZXh0dXJlKAogICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlIGlmIGN1c3RvbV90ZXh0dXJlIGlzIG5vdCBOb25lIGVsc2UgJ2xvZ28nKQogICAgICAgICAgICAgICAgc2VsZi5fbG9nb19ub2RlLm1vZGVsX29wYXF1ZSA9IChOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGN1c3RvbV90ZXh0dXJlIGlzIG5vdCBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgYmEuZ2V0bW9kZWwoJ2xvZ28nKSkKICAgICAgICAgICAgICAgIHNlbGYuX2xvZ29fbm9kZS5tb2RlbF90cmFuc3BhcmVudCA9ICgKICAgICAgICAgICAgICAgICAgICBOb25lIGlmIGN1c3RvbV90ZXh0dXJlIGlzIG5vdCBOb25lIGVsc2UKICAgICAgICAgICAgICAgICAgICBiYS5nZXRtb2RlbCgnbG9nb1RyYW5zcGFyZW50JykpCgogICAgICAgICMgSWYgbGFuZ3VhZ2UgaGFzIGNoYW5nZWQsIHJlY3JlYXRlIG91ciBsb2dvIHRleHQvZ3JhcGhpY3MuCiAgICAgICAgbGFuZyA9IGFwcC5sYW5nLmxhbmd1YWdlCiAgICAgICAgaWYgbGFuZyAhPSBzZWxmLl9sYW5ndWFnZToKICAgICAgICAgICAgc2VsZi5fbGFuZ3VhZ2UgPSBsYW5nCiAgICAgICAgICAgIHkgPSAyMAogICAgICAgICAgICBiYXNlX3NjYWxlID0gMS4xCiAgICAgICAgICAgIHNlbGYuX3dvcmRfYWN0b3JzID0gW10KICAgICAgICAgICAgYmFzZV9kZWxheSA9IDEuMAogICAgICAgICAgICBkZWxheSA9IGJhc2VfZGVsYXkKICAgICAgICAgICAgZGVsYXlfaW5jID0gMC4wMgoKICAgICAgICAgICAgIyBDb21lIG9uIGZhc3RlciBhZnRlciB0aGUgZmlyc3QgdGltZS4KICAgICAgICAgICAgaWYgYXBwLm1haW5fbWVudV9kaWRfaW5pdGlhbF90cmFuc2l0aW9uOgogICAgICAgICAgICAgICAgYmFzZV9kZWxheSA9IDAuMAogICAgICAgICAgICAgICAgZGVsYXkgPSBiYXNlX2RlbGF5CiAgICAgICAgICAgICAgICBkZWxheV9pbmMgPSAwLjAyCgogICAgICAgICAgICAjIFdlIGRyYXcgaGlnaGVyIGluIGtpb3NrIG1vZGUgKG1ha2Ugc3VyZSB0byB0ZXN0IHRoaXMKICAgICAgICAgICAgIyB3aGVuIG1ha2luZyBhZGp1c3RtZW50cykgZm9yIG5vdyB3ZSdyZSBoYXJkLWNvZGVkIGZvcgogICAgICAgICAgICAjIGEgZmV3IGxhbmd1YWdlcy4uIHNob3VsZCBtYXliZSBsb29rIGludG8gZ2VuZXJhbGl6aW5nIHRoaXM/Li4KICAgICAgICAgICAgaWYgYXBwLmxhbmcubGFuZ3VhZ2UgPT0gJ0NoaW5lc2UnOgogICAgICAgICAgICAgICAgYmFzZV94ID0gLTI3MC4wCiAgICAgICAgICAgICAgICB4ID0gYmFzZV94IC0gMjAuMAogICAgICAgICAgICAgICAgc3BhY2luZyA9IDg1LjAgKiBiYXNlX3NjYWxlCiAgICAgICAgICAgICAgICB5X2V4dHJhID0gMC4wIGlmIChhcHAuZGVtb19tb2RlIG9yIGFwcC5hcmNhZGVfbW9kZSkgZWxzZSAwLjAKICAgICAgICAgICAgICAgIHNlbGYuX21ha2VfbG9nbyh4IC0gMTEwICsgNTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTEzICsgeSArIDEuMiAqIHlfZXh0cmEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMC4zNCAqIGJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9YmFzZV9kZWxheSArIDAuMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21fdGV4dHVyZT0nY2hUaXRsZUNoYXIxJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqaXR0ZXJfc2NhbGU9Mi4wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldD0tMzApCiAgICAgICAgICAgICAgICB4ICs9IHNwYWNpbmcKICAgICAgICAgICAgICAgIGRlbGF5ICs9IGRlbGF5X2luYwogICAgICAgICAgICAgICAgc2VsZi5fbWFrZV9sb2dvKHggLSAxMCArIDUwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDExMCArIHkgKyAxLjIgKiB5X2V4dHJhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMzEgKiBiYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWJhc2VfZGVsYXkgKyAwLjE1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlPSdjaFRpdGxlQ2hhcjInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppdHRlcl9zY2FsZT0yLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0PS0zMCkKICAgICAgICAgICAgICAgIHggKz0gMi4wICogc3BhY2luZwogICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX2xvZ28oeCArIDE4MCAtIDE0MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMTAgKyB5ICsgMS4yICogeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjMgKiBiYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWJhc2VfZGVsYXkgKyAwLjI1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlPSdjaFRpdGxlQ2hhcjMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppdHRlcl9zY2FsZT0yLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0PS0zMCkKICAgICAgICAgICAgICAgIHggKz0gc3BhY2luZwogICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX2xvZ28oeCArIDI0MSAtIDEyMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMTAgKyB5ICsgMS4yICogeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjMxICogYmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheT1iYXNlX2RlbGF5ICsgMC4zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlPSdjaFRpdGxlQ2hhcjQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppdHRlcl9zY2FsZT0yLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0PS0zMCkKICAgICAgICAgICAgICAgIHggKz0gc3BhY2luZwogICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX2xvZ28oeCArIDMwMCAtIDkwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwNSArIHkgKyAxLjIgKiB5X2V4dHJhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMzQgKiBiYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWJhc2VfZGVsYXkgKyAwLjM1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV90ZXh0dXJlPSdjaFRpdGxlQ2hhcjUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppdHRlcl9zY2FsZT0yLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0PS0zMCkKICAgICAgICAgICAgICAgIHNlbGYuX21ha2VfbG9nbyhiYXNlX3ggKyAxNTUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTQ2ICsgeSArIDEuMiAqIHlfZXh0cmEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMC4yOCAqIGJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9YmFzZV9kZWxheSArIDAuMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3RhdGU9LTcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBiYXNlX3ggPSAtMTcwCiAgICAgICAgICAgICAgICB4ID0gYmFzZV94IC0gMjAKICAgICAgICAgICAgICAgIHNwYWNpbmcgPSA1NSAqIGJhc2Vfc2NhbGUKICAgICAgICAgICAgICAgIHlfZXh0cmEgPSAwIGlmIChhcHAuZGVtb19tb2RlIG9yIGFwcC5hcmNhZGVfbW9kZSkgZWxzZSAwCiAgICAgICAgICAgICAgICB4djEgPSB4CiAgICAgICAgICAgICAgICBkZWxheTEgPSBkZWxheQogICAgICAgICAgICAgICAgZm9yIHNoYWRvdyBpbiAoVHJ1ZSwgRmFsc2UpOgogICAgICAgICAgICAgICAgICAgIHggPSB4djEKICAgICAgICAgICAgICAgICAgICBkZWxheSA9IGRlbGF5MQogICAgICAgICAgICAgICAgICAgIHNlbGYuX21ha2Vfd29yZCgnQicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggLSA1MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSAtIDIzICsgMC44ICogeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9MS4zICogYmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldD0zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFkb3c9c2hhZG93KQogICAgICAgICAgICAgICAgICAgIHggKz0gc3BhY2luZwogICAgICAgICAgICAgICAgICAgIGRlbGF5ICs9IGRlbGF5X2luYwogICAgICAgICAgICAgICAgICAgIHNlbGYuX21ha2Vfd29yZCgnbScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgKyB5X2V4dHJhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheT1kZWxheSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9YmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PXNoYWRvdykKICAgICAgICAgICAgICAgICAgICB4ICs9IHNwYWNpbmcgKiAxLjI1CiAgICAgICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbWFrZV93b3JkKCdiJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSArIHlfZXh0cmEgLSAxMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPTEuMSAqIGJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldD01LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFkb3c9c2hhZG93KQogICAgICAgICAgICAgICAgICAgIHggKz0gc3BhY2luZyAqIDAuODUKICAgICAgICAgICAgICAgICAgICBkZWxheSArPSBkZWxheV9pbmMKICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX3dvcmQoJ1MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5IC0gMjUgKyAwLjggKiB5X2V4dHJhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT0xLjM1ICogYmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldD0xNCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PXNoYWRvdykKICAgICAgICAgICAgICAgICAgICB4ICs9IHNwYWNpbmcKICAgICAgICAgICAgICAgICAgICBkZWxheSArPSBkZWxheV9pbmMKICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX3dvcmQoJ3EnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ICsgeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPWJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYWRvdz1zaGFkb3cpCiAgICAgICAgICAgICAgICAgICAgeCArPSBzcGFjaW5nICogMC45CiAgICAgICAgICAgICAgICAgICAgZGVsYXkgKz0gZGVsYXlfaW5jCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbWFrZV93b3JkKCd1JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeSArIHlfZXh0cmEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWRlbGF5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT1iYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2cl9kZXB0aF9vZmZzZXQ9NywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PXNoYWRvdykKICAgICAgICAgICAgICAgICAgICB4ICs9IHNwYWNpbmcgKiAwLjkKICAgICAgICAgICAgICAgICAgICBkZWxheSArPSBkZWxheV9pbmMKICAgICAgICAgICAgICAgICAgICBzZWxmLl9tYWtlX3dvcmQoJ2EnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ICsgeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPWJhc2Vfc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYWRvdz1zaGFkb3cpCiAgICAgICAgICAgICAgICAgICAgeCArPSBzcGFjaW5nICogMC42NAogICAgICAgICAgICAgICAgICAgIGRlbGF5ICs9IGRlbGF5X2luYwogICAgICAgICAgICAgICAgICAgIHNlbGYuX21ha2Vfd29yZCgnZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgKyB5X2V4dHJhIC0gMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWRlbGF5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT0xLjEgKiBiYXNlX3NjYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2cl9kZXB0aF9vZmZzZXQ9NiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZG93PXNoYWRvdykKICAgICAgICAgICAgICAgIHNlbGYuX21ha2VfbG9nbyhiYXNlX3ggLSAyOCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMjUgKyB5ICsgMS4yICogeV9leHRyYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjMyICogYmFzZV9zY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheT1iYXNlX2RlbGF5KQoKICAgIGRlZiBfbWFrZV93b3JkKHNlbGYsCiAgICAgICAgICAgICAgICAgICB3b3JkOiBzdHIsCiAgICAgICAgICAgICAgICAgICB4OiBmbG9hdCwKICAgICAgICAgICAgICAgICAgIHk6IGZsb2F0LAogICAgICAgICAgICAgICAgICAgc2NhbGU6IGZsb2F0ID0gMS4wLAogICAgICAgICAgICAgICAgICAgZGVsYXk6IGZsb2F0ID0gMC4wLAogICAgICAgICAgICAgICAgICAgdnJfZGVwdGhfb2Zmc2V0OiBmbG9hdCA9IDAuMCwKICAgICAgICAgICAgICAgICAgIHNoYWRvdzogYm9vbCA9IEZhbHNlKSAtPiBOb25lOgogICAgICAgIGlmIHNoYWRvdzoKICAgICAgICAgICAgd29yZF9vYmogPSBiYS5Ob2RlQWN0b3IoCiAgICAgICAgICAgICAgICBiYS5uZXdub2RlKCd0ZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogKHgsIHkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JpZyc6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29sb3InOiAoMC4wLCAwLjAsIDAuMiwgMC4wOCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGlsdF90cmFuc2xhdGUnOiAwLjA5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ29wYWNpdHlfc2NhbGVzX3NoYWRvdyc6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NoYWRvdyc6IDAuMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2cl9kZXB0aCc6IC0xMzAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndl9hbGlnbic6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2plY3Rfc2NhbGUnOiAwLjk3ICogc2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2NhbGUnOiAxLjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dCc6IHdvcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIHNlbGYuX3dvcmRfYWN0b3JzLmFwcGVuZCh3b3JkX29iaikKICAgICAgICBlbHNlOgogICAgICAgICAgICB3b3JkX29iaiA9IGJhLk5vZGVBY3RvcigKICAgICAgICAgICAgICAgIGJhLm5ld25vZGUoJ3RleHQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAoeCwgeSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmlnJzogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb2xvcic6ICgxLjMsIDEuMiwgMS4yLCAxLjApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbHRfdHJhbnNsYXRlJzogMC4xMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzaGFkb3cnOiAwLjIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndnJfZGVwdGgnOiAtNDAgKyB2cl9kZXB0aF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndl9hbGlnbic6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Byb2plY3Rfc2NhbGUnOiBzY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzY2FsZSc6IDEuMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0Jzogd29yZAogICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgc2VsZi5fd29yZF9hY3RvcnMuYXBwZW5kKHdvcmRfb2JqKQoKICAgICAgICAjIEFkZCBhIGJpdCBvZiBzdG9wLW1vdGlvbi15IGppdHRlciB0byB0aGUgbG9nbwogICAgICAgICMgKHVubGVzcyB3ZSdyZSBpbiBWUiBtb2RlIGluIHdoaWNoIGNhc2UgaXRzIGJlc3QgdG8KICAgICAgICAjIGxlYXZlIHRoaW5ncyBzdGlsbCkuCiAgICAgICAgaWYgbm90IGJhLmFwcC52cl9tb2RlOgogICAgICAgICAgICBjbWI6IE9wdGlvbmFsW2JhLk5vZGVdCiAgICAgICAgICAgIGNtYjI6IE9wdGlvbmFsW2JhLk5vZGVdCiAgICAgICAgICAgIGlmIG5vdCBzaGFkb3c6CiAgICAgICAgICAgICAgICBjbWIgPSBiYS5uZXdub2RlKCdjb21iaW5lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duZXI9d29yZF9vYmoubm9kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9eydzaXplJzogMn0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjbWIgPSBOb25lCiAgICAgICAgICAgIGlmIHNoYWRvdzoKICAgICAgICAgICAgICAgIGNtYjIgPSBiYS5uZXdub2RlKCdjb21iaW5lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyPXdvcmRfb2JqLm5vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRycz17J3NpemUnOiAyfSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNtYjIgPSBOb25lCiAgICAgICAgICAgIGlmIG5vdCBzaGFkb3c6CiAgICAgICAgICAgICAgICBhc3NlcnQgY21iIGFuZCB3b3JkX29iai5ub2RlCiAgICAgICAgICAgICAgICBjbWIuY29ubmVjdGF0dHIoJ291dHB1dCcsIHdvcmRfb2JqLm5vZGUsICdwb3NpdGlvbicpCiAgICAgICAgICAgIGlmIHNoYWRvdzoKICAgICAgICAgICAgICAgIGFzc2VydCBjbWIyIGFuZCB3b3JkX29iai5ub2RlCiAgICAgICAgICAgICAgICBjbWIyLmNvbm5lY3RhdHRyKCdvdXRwdXQnLCB3b3JkX29iai5ub2RlLCAncG9zaXRpb24nKQogICAgICAgICAgICBrZXlzID0ge30KICAgICAgICAgICAga2V5czIgPSB7fQogICAgICAgICAgICB0aW1lX3YgPSAwLjAKICAgICAgICAgICAgZm9yIF9pIGluIHJhbmdlKDEwKToKICAgICAgICAgICAgICAgIHZhbCA9IHggKyAocmFuZG9tLnJhbmRvbSgpIC0gMC41KSAqIDAuOAogICAgICAgICAgICAgICAgdmFsMiA9IHggKyAocmFuZG9tLnJhbmRvbSgpIC0gMC41KSAqIDAuOAogICAgICAgICAgICAgICAga2V5c1t0aW1lX3YgKiBzZWxmLl90c10gPSB2YWwKICAgICAgICAgICAgICAgIGtleXMyW3RpbWVfdiAqIHNlbGYuX3RzXSA9IHZhbDIgKyA1CiAgICAgICAgICAgICAgICB0aW1lX3YgKz0gcmFuZG9tLnJhbmRvbSgpICogMC4xCiAgICAgICAgICAgIGlmIGNtYiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGJhLmFuaW1hdGUoY21iLCAnaW5wdXQwJywga2V5cywgbG9vcD1UcnVlKQogICAgICAgICAgICBpZiBjbWIyIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgYmEuYW5pbWF0ZShjbWIyLCAnaW5wdXQwJywga2V5czIsIGxvb3A9VHJ1ZSkKICAgICAgICAgICAga2V5cyA9IHt9CiAgICAgICAgICAgIGtleXMyID0ge30KICAgICAgICAgICAgdGltZV92ID0gMAogICAgICAgICAgICBmb3IgX2kgaW4gcmFuZ2UoMTApOgogICAgICAgICAgICAgICAgdmFsID0geSArIChyYW5kb20ucmFuZG9tKCkgLSAwLjUpICogMC44CiAgICAgICAgICAgICAgICB2YWwyID0geSArIChyYW5kb20ucmFuZG9tKCkgLSAwLjUpICogMC44CiAgICAgICAgICAgICAgICBrZXlzW3RpbWVfdiAqIHNlbGYuX3RzXSA9IHZhbAogICAgICAgICAgICAgICAga2V5czJbdGltZV92ICogc2VsZi5fdHNdID0gdmFsMiAtIDkKICAgICAgICAgICAgICAgIHRpbWVfdiArPSByYW5kb20ucmFuZG9tKCkgKiAwLjEKICAgICAgICAgICAgaWYgY21iIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgYmEuYW5pbWF0ZShjbWIsICdpbnB1dDEnLCBrZXlzLCBsb29wPVRydWUpCiAgICAgICAgICAgIGlmIGNtYjIgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBiYS5hbmltYXRlKGNtYjIsICdpbnB1dDEnLCBrZXlzMiwgbG9vcD1UcnVlKQoKICAgICAgICBpZiBub3Qgc2hhZG93OgogICAgICAgICAgICBhc3NlcnQgd29yZF9vYmoubm9kZQogICAgICAgICAgICBiYS5hbmltYXRlKHdvcmRfb2JqLm5vZGUsICdwcm9qZWN0X3NjYWxlJywgewogICAgICAgICAgICAgICAgZGVsYXk6IDAuMCwKICAgICAgICAgICAgICAgIGRlbGF5ICsgMC4xOiBzY2FsZSAqIDEuMSwKICAgICAgICAgICAgICAgIGRlbGF5ICsgMC4yOiBzY2FsZQogICAgICAgICAgICB9KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFzc2VydCB3b3JkX29iai5ub2RlCiAgICAgICAgICAgIGJhLmFuaW1hdGUod29yZF9vYmoubm9kZSwgJ3Byb2plY3Rfc2NhbGUnLCB7CiAgICAgICAgICAgICAgICBkZWxheTogMC4wLAogICAgICAgICAgICAgICAgZGVsYXkgKyAwLjE6IHNjYWxlICogMS4xLAogICAgICAgICAgICAgICAgZGVsYXkgKyAwLjI6IHNjYWxlCiAgICAgICAgICAgIH0pCgogICAgZGVmIF9nZXRfY3VzdG9tX2xvZ29fdGV4X25hbWUoc2VsZikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICBpZiBfYmEuZ2V0X2FjY291bnRfbWlzY19yZWFkX3ZhbCgnZWFzdGVyJywgRmFsc2UpOgogICAgICAgICAgICByZXR1cm4gJ2xvZ29FYXN0ZXInCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAjIFBvcCB0aGUgbG9nbyBhbmQgbWVudSBpbi4KICAgIGRlZiBfbWFrZV9sb2dvKHNlbGYsCiAgICAgICAgICAgICAgICAgICB4OiBmbG9hdCwKICAgICAgICAgICAgICAgICAgIHk6IGZsb2F0LAogICAgICAgICAgICAgICAgICAgc2NhbGU6IGZsb2F0LAogICAgICAgICAgICAgICAgICAgZGVsYXk6IGZsb2F0LAogICAgICAgICAgICAgICAgICAgY3VzdG9tX3RleHR1cmU6IHN0ciA9IE5vbmUsCiAgICAgICAgICAgICAgICAgICBqaXR0ZXJfc2NhbGU6IGZsb2F0ID0gMS4wLAogICAgICAgICAgICAgICAgICAgcm90YXRlOiBmbG9hdCA9IDAuMCwKICAgICAgICAgICAgICAgICAgIHZyX2RlcHRoX29mZnNldDogZmxvYXQgPSAwLjApIC0+IE5vbmU6CgogICAgICAgICMgVGVtcCBlYXN0ZXIgZ29vZG5lc3MuCiAgICAgICAgaWYgY3VzdG9tX3RleHR1cmUgaXMgTm9uZToKICAgICAgICAgICAgY3VzdG9tX3RleHR1cmUgPSBzZWxmLl9nZXRfY3VzdG9tX2xvZ29fdGV4X25hbWUoKQogICAgICAgIHNlbGYuX2N1c3RvbV9sb2dvX3RleF9uYW1lID0gY3VzdG9tX3RleHR1cmUKICAgICAgICBsdGV4ID0gYmEuZ2V0dGV4dHVyZSgKICAgICAgICAgICAgY3VzdG9tX3RleHR1cmUgaWYgY3VzdG9tX3RleHR1cmUgaXMgbm90IE5vbmUgZWxzZSAnbG9nbycpCiAgICAgICAgbW9wYXF1ZSA9IChOb25lIGlmIGN1c3RvbV90ZXh0dXJlIGlzIG5vdCBOb25lIGVsc2UgYmEuZ2V0bW9kZWwoJ2xvZ28nKSkKICAgICAgICBtdHJhbnMgPSAoTm9uZSBpZiBjdXN0b21fdGV4dHVyZSBpcyBub3QgTm9uZSBlbHNlCiAgICAgICAgICAgICAgICAgIGJhLmdldG1vZGVsKCdsb2dvVHJhbnNwYXJlbnQnKSkKICAgICAgICBsb2dvID0gYmEuTm9kZUFjdG9yKAogICAgICAgICAgICBiYS5uZXdub2RlKCdpbWFnZScsCiAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM9ewogICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dHVyZSc6IGx0ZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdtb2RlbF9vcGFxdWUnOiBtb3BhcXVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9kZWxfdHJhbnNwYXJlbnQnOiBtdHJhbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICd2cl9kZXB0aCc6IC0xMCArIHZyX2RlcHRoX29mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JvdGF0ZSc6IHJvdGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2F0dGFjaCc6ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAndGlsdF90cmFuc2xhdGUnOiAwLjIxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAnYWJzb2x1dGVfc2NhbGUnOiBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgc2VsZi5fbG9nb19ub2RlID0gbG9nby5ub2RlCiAgICAgICAgc2VsZi5fd29yZF9hY3RvcnMuYXBwZW5kKGxvZ28pCgogICAgICAgICMgQWRkIGEgYml0IG9mIHN0b3AtbW90aW9uLXkgaml0dGVyIHRvIHRoZSBsb2dvCiAgICAgICAgIyAodW5sZXNzIHdlJ3JlIGluIFZSIG1vZGUgaW4gd2hpY2ggY2FzZSBpdHMgYmVzdCB0bwogICAgICAgICMgbGVhdmUgdGhpbmdzIHN0aWxsKS4KICAgICAgICBhc3NlcnQgbG9nby5ub2RlCiAgICAgICAgaWYgbm90IGJhLmFwcC52cl9tb2RlOgogICAgICAgICAgICBjbWIgPSBiYS5uZXdub2RlKCdjb21iaW5lJywgb3duZXI9bG9nby5ub2RlLCBhdHRycz17J3NpemUnOiAyfSkKICAgICAgICAgICAgY21iLmNvbm5lY3RhdHRyKCdvdXRwdXQnLCBsb2dvLm5vZGUsICdwb3NpdGlvbicpCiAgICAgICAgICAgIGtleXMgPSB7fQogICAgICAgICAgICB0aW1lX3YgPSAwLjAKCiAgICAgICAgICAgICMgR2VuIHNvbWUgcmFuZG9tIGtleXMgZm9yIHRoYXQgc3RvcC1tb3Rpb24teSBsb29rCiAgICAgICAgICAgIGZvciBfaSBpbiByYW5nZSgxMCk6CiAgICAgICAgICAgICAgICBrZXlzW3RpbWVfdl0gPSB4ICsgKHJhbmRvbS5yYW5kb20oKSAtIDAuNSkgKiAwLjcgKiBqaXR0ZXJfc2NhbGUKICAgICAgICAgICAgICAgIHRpbWVfdiArPSByYW5kb20ucmFuZG9tKCkgKiAwLjEKICAgICAgICAgICAgYmEuYW5pbWF0ZShjbWIsICdpbnB1dDAnLCBrZXlzLCBsb29wPVRydWUpCiAgICAgICAgICAgIGtleXMgPSB7fQogICAgICAgICAgICB0aW1lX3YgPSAwLjAKICAgICAgICAgICAgZm9yIF9pIGluIHJhbmdlKDEwKToKICAgICAgICAgICAgICAgIGtleXNbdGltZV92ICogc2VsZi5fdHNdID0geSArIChyYW5kb20ucmFuZG9tKCkgLQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuNSkgKiAwLjcgKiBqaXR0ZXJfc2NhbGUKICAgICAgICAgICAgICAgIHRpbWVfdiArPSByYW5kb20ucmFuZG9tKCkgKiAwLjEKICAgICAgICAgICAgYmEuYW5pbWF0ZShjbWIsICdpbnB1dDEnLCBrZXlzLCBsb29wPVRydWUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nby5ub2RlLnBvc2l0aW9uID0gKHgsIHkpCgogICAgICAgIGNtYiA9IGJhLm5ld25vZGUoJ2NvbWJpbmUnLCBvd25lcj1sb2dvLm5vZGUsIGF0dHJzPXsnc2l6ZSc6IDJ9KQoKICAgICAgICBrZXlzID0gewogICAgICAgICAgICBkZWxheTogMC4wLAogICAgICAgICAgICBkZWxheSArIDAuMTogNzAwLjAgKiBzY2FsZSwKICAgICAgICAgICAgZGVsYXkgKyAwLjI6IDYwMC4wICogc2NhbGUKICAgICAgICB9CiAgICAgICAgYmEuYW5pbWF0ZShjbWIsICdpbnB1dDAnLCBrZXlzKQogICAgICAgIGJhLmFuaW1hdGUoY21iLCAnaW5wdXQxJywga2V5cykKICAgICAgICBjbWIuY29ubmVjdGF0dHIoJ291dHB1dCcsIGxvZ28ubm9kZSwgJ3NjYWxlJykKCiAgICBkZWYgX3N0YXJ0X3ByZWxvYWRzKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIyBGSVhNRTogVGhlIGZ1bmMgdGhhdCBjYWxscyB1cyBiYWNrIGRvZXNuJ3Qgc2F2ZS9yZXN0b3JlIHN0YXRlCiAgICAgICAgIyAgb3IgY2hlY2sgZm9yIGEgZGVhZCBhY3Rpdml0eSBzbyB3ZSBoYXZlIHRvIGRvIHRoYXQgb3Vyc2VsZi4KICAgICAgICBpZiBzZWxmLmV4cGlyZWQ6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIHdpdGggYmEuQ29udGV4dChzZWxmKToKICAgICAgICAgICAgX3ByZWxvYWQxKCkKCiAgICAgICAgYmEudGltZXIoMC41LCBsYW1iZGE6IGJhLnNldG11c2ljKGJhLk11c2ljVHlwZS5NRU5VKSkKCgoKZGVmIG5ld2NvbnRhaW5lcndpZGdldEcoZWRpdDogYmEuV2lkZ2V0ID0gTm9uZSwgcGFyZW50OiBiYS5XaWRnZXQgPSBOb25lLCBzaXplOiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCBwb3NpdGlvbjogU2VxdWVuY2VbZmxvYXRdID0gTm9uZSwgYmFja2dyb3VuZDogYm9vbCA9IE5vbmUsIHNlbGVjdGVkX2NoaWxkOiBiYS5XaWRnZXQgPSBOb25lLCB0cmFuc2l0aW9uOiBzdHIgPSBOb25lLCBjYW5jZWxfYnV0dG9uOiBiYS5XaWRnZXQgPSBOb25lLCBzdGFydF9idXR0b246IGJhLldpZGdldCA9IE5vbmUsIHJvb3Rfc2VsZWN0YWJsZTogYm9vbCA9IE5vbmUsIG9uX2FjdGl2YXRlX2NhbGw6IENhbGxhYmxlW1tdLCBOb25lXSA9IE5vbmUsIGNsYWltc19sZWZ0X3JpZ2h0OiBib29sID0gTm9uZSwgY2xhaW1zX3RhYjogYm9vbCA9IE5vbmUsIHNlbGVjdGlvbl9sb29wczogYm9vbCA9IE5vbmUsIHNlbGVjdGlvbl9sb29wc190b19wYXJlbnQ6IGJvb2wgPSBOb25lLCBzY2FsZTogZmxvYXQgPSBOb25lLCBvbl9vdXRzaWRlX2NsaWNrX2NhbGw6IENhbGxhYmxlW1tdLCBOb25lXSA9IE5vbmUsIHNpbmdsZV9kZXB0aDogYm9vbCA9IE5vbmUsIHZpc2libGVfY2hpbGQ6IGJhLldpZGdldCA9IE5vbmUsIHN0YWNrX29mZnNldDogU2VxdWVuY2VbZmxvYXRdID0gTm9uZSwgY29sb3I6IFNlcXVlbmNlW2Zsb2F0XSA9ICgwLjkyMSwwLjI5OCwwLjk2NCksIG9uX2NhbmNlbF9jYWxsOiBDYWxsYWJsZVtbXSwgTm9uZV0gPSBOb25lLCBwcmludF9saXN0X2V4aXRfaW5zdHJ1Y3Rpb25zOiBib29sID0gTm9uZSwgY2xpY2tfYWN0aXZhdGU6IGJvb2wgPSBOb25lLCBhbHdheXNfaGlnaGxpZ2h0OiBib29sID0gTm9uZSwgc2VsZWN0YWJsZTogYm9vbCA9IE5vbmUsIHNjYWxlX29yaWdpbl9zdGFja19vZmZzZXQ6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIHRvb2xiYXJfdmlzaWJpbGl0eTogc3RyID0gTm9uZSwgb25fc2VsZWN0X2NhbGw6IENhbGxhYmxlW1tdLCBOb25lXSA9IE5vbmUsIGNsYWltX291dHNpZGVfY2xpY2tzOiBib29sID0gTm9uZSwgY2xhaW1zX3VwX2Rvd246IGJvb2wgPSBOb25lKSAtPiBiYS5XaWRnZXQ6CiAgICByZXR1cm4gY29udGFpbmVyKGVkaXQscGFyZW50LHNpemUscG9zaXRpb24sYmFja2dyb3VuZCxzZWxlY3RlZF9jaGlsZCx0cmFuc2l0aW9uLGNhbmNlbF9idXR0b24sc3RhcnRfYnV0dG9uLHJvb3Rfc2VsZWN0YWJsZSxvbl9hY3RpdmF0ZV9jYWxsLGNsYWltc19sZWZ0X3JpZ2h0LGNsYWltc190YWIsc2VsZWN0aW9uX2xvb3BzLHNlbGVjdGlvbl9sb29wc190b19wYXJlbnQsc2NhbGUsb25fb3V0c2lkZV9jbGlja19jYWxsLHNpbmdsZV9kZXB0aCx2aXNpYmxlX2NoaWxkLHN0YWNrX29mZnNldCxjb2xvcixvbl9jYW5jZWxfY2FsbCxwcmludF9saXN0X2V4aXRfaW5zdHJ1Y3Rpb25zLGNsaWNrX2FjdGl2YXRlLGFsd2F5c19oaWdobGlnaHQsc2VsZWN0YWJsZSxzY2FsZV9vcmlnaW5fc3RhY2tfb2Zmc2V0LHRvb2xiYXJfdmlzaWJpbGl0eSxvbl9zZWxlY3RfY2FsbCxjbGFpbV9vdXRzaWRlX2NsaWNrcyxjbGFpbXNfdXBfZG93bikKCmRlZiBjaGVja2JvRyhlZGl0OiBiYS5XaWRnZXQgPSBOb25lLCBwYXJlbnQ6IGJhLldpZGdldCA9IE5vbmUsIHNpemU6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIHBvc2l0aW9uOiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCB0ZXh0OiBVbmlvbltiYS5Mc3RyLCBzdHJdID0gTm9uZSwgdmFsdWU6IGJvb2wgPSBOb25lLCBvbl92YWx1ZV9jaGFuZ2VfY2FsbDogQ2FsbGFibGVbW2Jvb2xdLCBOb25lXSA9IE5vbmUsIG9uX3NlbGVjdF9jYWxsOiBDYWxsYWJsZVtbXSwgTm9uZV0gPSBOb25lLCB0ZXh0X3NjYWxlOiBmbG9hdCA9IE5vbmUsIHRleHRjb2xvcjogU2VxdWVuY2VbZmxvYXRdID0gKDAuMjc0LDAuMDA3LDAuNiksIHNjYWxlOiBmbG9hdCA9IE5vbmUsIGlzX3JhZGlvX2J1dHRvbjogYm9vbCA9IE5vbmUsIG1heHdpZHRoOiBmbG9hdCA9IE5vbmUsIGF1dG9zZWxlY3Q6IGJvb2wgPSBOb25lLCBjb2xvcjogU2VxdWVuY2VbZmxvYXRdID0gKDAuOTcsMC4zMiwwLjY3NCkpIC0+IGJhLldpZGdldDoKICAgIHJldHVybiBjaGVja2JveChlZGl0LHBhcmVudCxzaXplLHBvc2l0aW9uLHRleHQsdmFsdWUsb25fdmFsdWVfY2hhbmdlX2NhbGwsb25fc2VsZWN0X2NhbGwsdGV4dF9zY2FsZSx0ZXh0Y29sb3Isc2NhbGUsaXNfcmFkaW9fYnV0dG9uLG1heHdpZHRoLGF1dG9zZWxlY3QsY29sb3IpCgpkZWYgbXV0dG9ud2lkZ2V0RyhlZGl0OiBiYS5XaWRnZXQgPSBOb25lLCBwYXJlbnQ6IGJhLldpZGdldCA9IE5vbmUsIHNpemU6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIHBvc2l0aW9uOiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCBvbl9hY3RpdmF0ZV9jYWxsOiBDYWxsYWJsZSA9IE5vbmUsIGxhYmVsOiBVbmlvbltzdHIsIGJhLkxzdHJdID0gTm9uZSwgY29sb3I6IFNlcXVlbmNlW2Zsb2F0XSA9ICgwLjk3LDAuMzIsMC42NzQpLCBkb3duX3dpZGdldDogYmEuV2lkZ2V0ID0gTm9uZSwgdXBfd2lkZ2V0OiBiYS5XaWRnZXQgPSBOb25lLCBsZWZ0X3dpZGdldDogYmEuV2lkZ2V0ID0gTm9uZSwgcmlnaHRfd2lkZ2V0OiBiYS5XaWRnZXQgPSBOb25lLCB0ZXh0dXJlOiBiYS5UZXh0dXJlID0gTm9uZSwgdGV4dF9zY2FsZTogZmxvYXQgPSBOb25lLCB0ZXh0Y29sb3I6IFNlcXVlbmNlW2Zsb2F0XSA9ICgxLDEsMSksIGVuYWJsZV9zb3VuZDogYm9vbCA9IE5vbmUsIG1vZGVsX3RyYW5zcGFyZW50OiBiYS5Nb2RlbCA9IE5vbmUsIG1vZGVsX29wYXF1ZTogYmEuTW9kZWwgPSBOb25lLCByZXBlYXQ6IGJvb2wgPSBOb25lLCBzY2FsZTogZmxvYXQgPSBOb25lLCB0cmFuc2l0aW9uX2RlbGF5OiBmbG9hdCA9IE5vbmUsIG9uX3NlbGVjdF9jYWxsOiBDYWxsYWJsZSA9IE5vbmUsIGJ1dHRvbl90eXBlOiBzdHIgPSBOb25lLCBleHRyYV90b3VjaF9ib3JkZXJfc2NhbGU6IGZsb2F0ID0gTm9uZSwgc2VsZWN0YWJsZTogYm9vbCA9IE5vbmUsIHNob3dfYnVmZmVyX3RvcDogZmxvYXQgPSBOb25lLCBpY29uOiBiYS5UZXh0dXJlID0gTm9uZSwgaWNvbnNjYWxlOiBmbG9hdCA9IE5vbmUsIGljb25fdGludDogZmxvYXQgPSBOb25lLCBpY29uX2NvbG9yOiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCBhdXRvc2VsZWN0OiBib29sID0gTm9uZSwgbWFza190ZXh0dXJlOiBiYS5UZXh0dXJlID0gTm9uZSwgdGludF90ZXh0dXJlOiBiYS5UZXh0dXJlID0gTm9uZSwgdGludF9jb2xvcjogU2VxdWVuY2VbZmxvYXRdID0gTm9uZSwgdGludDJfY29sb3I6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIHRleHRfZmxhdG5lc3M6IGZsb2F0ID0gTm9uZSwgdGV4dF9yZXNfc2NhbGU6IGZsb2F0ID0gTm9uZSwgZW5hYmxlZDogYm9vbCA9IE5vbmUpIC0+IGJhLldpZGdldDoKICAgIGlmIGNvbG9yPT0oMC41LCAwLjQsIDAuOTMpOiAjdGFiIGJsdWUKICAgICAgICBjb2xvcj0oMC43OSwwLjExLDAuNjI3KQogICAgZWxpZiBjb2xvcj09KDAuNTIsIDAuNDgsIDAuNjMpOiAgI3RhYiBub3Qgc2VsZWN0ZWQKICAgICAgICBjb2xvcj0oMC45NSwwLjI5LDAuNzkpCiAgICBlbGlmIGNvbG9yPT0oMC41NSwgMC41LCAwLjYpOiAgICAjYnV0dG9uIGluIHByb2ZpbGUKICAgICAgICBjb2xvcj0oMC45NSwwLjI5LDAuNzkpCiAgICByZXR1cm4gYnV0dG9ud2lkZ2V0KGVkaXQsIHBhcmVudCwgc2l6ZSwgcG9zaXRpb24sIG9uX2FjdGl2YXRlX2NhbGwsIGxhYmVsLCBjb2xvciwgZG93bl93aWRnZXQsIHVwX3dpZGdldCwgbGVmdF93aWRnZXQsIHJpZ2h0X3dpZGdldCwgdGV4dHVyZSwgdGV4dF9zY2FsZSwgdGV4dGNvbG9yLCBlbmFibGVfc291bmQsIG1vZGVsX3RyYW5zcGFyZW50LCBtb2RlbF9vcGFxdWUsIHJlcGVhdCwgc2NhbGUsIHRyYW5zaXRpb25fZGVsYXksIG9uX3NlbGVjdF9jYWxsLCBidXR0b25fdHlwZSwgZXh0cmFfdG91Y2hfYm9yZGVyX3NjYWxlLCBzZWxlY3RhYmxlLCBzaG93X2J1ZmZlcl90b3AsIGljb24sIGljb25zY2FsZSwgaWNvbl90aW50LCBpY29uX2NvbG9yLCBhdXRvc2VsZWN0LCBtYXNrX3RleHR1cmUsIHRpbnRfdGV4dHVyZSwgdGludF9jb2xvciwgdGludDJfY29sb3IsIHRleHRfZmxhdG5lc3MsIHRleHRfcmVzX3NjYWxlLCBlbmFibGVkKQp0ZXh0PWJhLnRleHR3aWRnZXQKCmRlZiB0ZXh0RyhlZGl0OiBiYS5XaWRnZXQgPSBOb25lLCBwYXJlbnQ6IGJhLldpZGdldCA9IE5vbmUsIHNpemU6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIHBvc2l0aW9uOiBTZXF1ZW5jZVtmbG9hdF0gPSBOb25lLCB0ZXh0OiBVbmlvbltzdHIsIGJhLkxzdHJdID0gTm9uZSwgdl9hbGlnbjogc3RyID0gTm9uZSwgaF9hbGlnbjogc3RyID0gTm9uZSwgZWRpdGFibGU6IGJvb2wgPSBOb25lLCBwYWRkaW5nOiBmbG9hdCA9IE5vbmUsIG9uX3JldHVybl9wcmVzc19jYWxsOiBDYWxsYWJsZVtbXSwgTm9uZV0gPSBOb25lLCBvbl9hY3RpdmF0ZV9jYWxsOiBDYWxsYWJsZVtbXSwgTm9uZV0gPSBOb25lLCBzZWxlY3RhYmxlOiBib29sID0gTm9uZSwgcXVlcnk6IGJhLldpZGdldCA9IE5vbmUsIG1heF9jaGFyczogaW50ID0gTm9uZSwgY29sb3I6IFNlcXVlbmNlW2Zsb2F0XSA9IE5vbmUsIGNsaWNrX2FjdGl2YXRlOiBib29sID0gTm9uZSwgb25fc2VsZWN0X2NhbGw6IENhbGxhYmxlW1tdLCBOb25lXSA9IE5vbmUsIGFsd2F5c19oaWdobGlnaHQ6IGJvb2wgPSBOb25lLCBkcmF3X2NvbnRyb2xsZXI6IGJhLldpZGdldCA9IE5vbmUsIHNjYWxlOiBmbG9hdCA9IE5vbmUsIGNvcm5lcl9zY2FsZTogZmxvYXQgPSBOb25lLCBkZXNjcmlwdGlvbjogVW5pb25bc3RyLCBiYS5Mc3RyXSA9IE5vbmUsIHRyYW5zaXRpb25fZGVsYXk6IGZsb2F0ID0gTm9uZSwgbWF4d2lkdGg6IGZsb2F0ID0gTm9uZSwgbWF4X2hlaWdodDogZmxvYXQgPSBOb25lLCBmbGF0bmVzczogZmxvYXQgPSBOb25lLCBzaGFkb3c6IGZsb2F0ID0gTm9uZSwgYXV0b3NlbGVjdDogYm9vbCA9IE5vbmUsIHJvdGF0ZTogZmxvYXQgPSBOb25lLCBlbmFibGVkOiBib29sID0gTm9uZSwgZm9yY2VfaW50ZXJuYWxfZWRpdGluZzogYm9vbCA9IE5vbmUsIGFsd2F5c19zaG93X2NhcmF0OiBib29sID0gTm9uZSwgYmlnOiBib29sID0gTm9uZSwgZXh0cmFfdG91Y2hfYm9yZGVyX3NjYWxlOiBmbG9hdCA9IE5vbmUsIHJlc19zY2FsZTogZmxvYXQgPSBOb25lKSAtPiBiYS5XaWRnZXQ6CiAgICByZXR1cm4gdGV4dChlZGl0LCBwYXJlbnQsIHNpemUsIHBvc2l0aW9uLCB0ZXh0LCB2X2FsaWduLCBoX2FsaWduLCBlZGl0YWJsZSwgcGFkZGluZywgb25fcmV0dXJuX3ByZXNzX2NhbGwsIG9uX2FjdGl2YXRlX2NhbGwsIHNlbGVjdGFibGUsIHF1ZXJ5LCBtYXhfY2hhcnMsIGNvbG9yLCBjbGlja19hY3RpdmF0ZSwgb25fc2VsZWN0X2NhbGwsIGFsd2F5c19oaWdobGlnaHQsIGRyYXdfY29udHJvbGxlciwgc2NhbGUsIGNvcm5lcl9zY2FsZSwgZGVzY3JpcHRpb24sIHRyYW5zaXRpb25fZGVsYXksIG1heHdpZHRoLCBtYXhfaGVpZ2h0LCBmbGF0bmVzcywgc2hhZG93LCBhdXRvc2VsZWN0LCByb3RhdGUsIGVuYWJsZWQsIGZvcmNlX2ludGVybmFsX2VkaXRpbmcsIGFsd2F5c19zaG93X2NhcmF0LCBiaWcsIGV4dHJhX3RvdWNoX2JvcmRlcl9zY2FsZSwgcmVzX3NjYWxlKQogICAKCgpkZWYgeWVoYmFieSgpOgogICAgYmEuYnV0dG9ud2lkZ2V0PW11dHRvbndpZGdldEQKICAgIGJhc19tYWluLk1haW5NZW51QWN0aXZpdHk9bmV3TWFpbk1lbnVBY3Rpdml0eUQKICAgIGJhLmNvbnRhaW5lcndpZGdldD1uZXdjb250YWluZXJ3aWRnZXRECiAgICBiYS5jaGVja2JveHdpZGdldD1jaGVja2JvRAogICAgI2JhLmNvbHVtbndpZGdldD1jb2x1bW4KCmRlZiBoZXlnaXJsd2Fzc3VwKCk6CiAgICBiYS5idXR0b253aWRnZXQ9bXV0dG9ud2lkZ2V0RwogICAgYmFzX21haW4uTWFpbk1lbnVBY3Rpdml0eT1uZXdNYWluTWVudUFjdGl2aXR5RwogICAgYmEuY29udGFpbmVyd2lkZ2V0PW5ld2NvbnRhaW5lcndpZGdldEcKICAgIGJhLmNoZWNrYm94d2lkZ2V0PWNoZWNrYm9HCg==").decode("ascii"))
# ba_meta export plugin
class Dark(ba.Plugin):
    """My last ballistica plugin!"""
    def __init__(self):
        
        if _ba.env().get("build_number",0) >= 20258:
            yehbaby()
            
        else:print("Theme Pack only runs with BombSquad version higer than 1.5.29.")
  
# ba_meta export plugin
class Girly(ba.Plugin):
    def __init__(self):
        """My last ballistica plugin!"""
        if _ba.env().get("build_number",0) >= 20258:
            heygirlwassup()
            
        else:print("Theme pACK only runs with BombSquad version higer than 1.5.29.")