"""Define a simple example plugin."""

# ba_meta require api 6

from __future__ import annotations

from typing import TYPE_CHECKING

import ba
import _ba
import copy
import time
from bastd.ui.playlist import customizebrowser

if TYPE_CHECKING:
    from typing import Any, Type, Optional, Tuple, List, Dict

text = b'Y2xhc3MgTmV3UGxheWxpc3RDdXN0b21pemVCcm93c2VyV2luZG93KGJhLldpbmRvdyk6CiAgICAiIiJXaW5kb3cgZm9yIHZpZXdpbmcgYSBwbGF5bGlzdC4iIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwKICAgICAgICAgICAgICAgICBzZXNzaW9udHlwZTogVHlwZVtiYS5TZXNzaW9uXSwKICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBzdHIgPSAnaW5fcmlnaHQnLAogICAgICAgICAgICAgICAgIHNlbGVjdF9wbGF5bGlzdDogc3RyID0gTm9uZSwKICAgICAgICAgICAgICAgICBvcmlnaW5fd2lkZ2V0OiBiYS5XaWRnZXQgPSBOb25lKToKICAgICAgICAjIFllcyB0aGlzIG5lZWRzIHRpZHlpbmcuCiAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9dG9vLW1hbnktbG9jYWxzCiAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9dG9vLW1hbnktc3RhdGVtZW50cwogICAgICAgICMgcHlsaW50OiBkaXNhYmxlPWN5Y2xpYy1pbXBvcnQKICAgICAgICBmcm9tIGJhc3RkLnVpIGltcG9ydCBwbGF5bGlzdAogICAgICAgIHNjYWxlX29yaWdpbjogT3B0aW9uYWxbVHVwbGVbZmxvYXQsIGZsb2F0XV0KICAgICAgICBpZiBvcmlnaW5fd2lkZ2V0IGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLl90cmFuc2l0aW9uX291dCA9ICdvdXRfc2NhbGUnCiAgICAgICAgICAgIHNjYWxlX29yaWdpbiA9IG9yaWdpbl93aWRnZXQuZ2V0X3NjcmVlbl9zcGFjZV9jZW50ZXIoKQogICAgICAgICAgICB0cmFuc2l0aW9uID0gJ2luX3NjYWxlJwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX3RyYW5zaXRpb25fb3V0ID0gJ291dF9yaWdodCcKICAgICAgICAgICAgc2NhbGVfb3JpZ2luID0gTm9uZQoKICAgICAgICBzZWxmLl9zZXNzaW9udHlwZSA9IHNlc3Npb250eXBlCiAgICAgICAgc2VsZi5fcHZhcnMgPSBwbGF5bGlzdC5QbGF5bGlzdFR5cGVWYXJzKHNlc3Npb250eXBlKQogICAgICAgIHNlbGYuX21heF9wbGF5bGlzdHMgPSAzMAogICAgICAgIHNlbGYuX3IgPSAnZ2FtZUxpc3RXaW5kb3cnCiAgICAgICAgdWlzY2FsZSA9IGJhLmFwcC51aS51aXNjYWxlCiAgICAgICAgc2VsZi5fd2lkdGggPSA3NTAuMCBpZiB1aXNjYWxlIGlzIGJhLlVJU2NhbGUuU01BTEwgZWxzZSA2NTAuMAogICAgICAgIHhfaW5zZXQgPSA1MC4wIGlmIHVpc2NhbGUgaXMgYmEuVUlTY2FsZS5TTUFMTCBlbHNlIDAuMAogICAgICAgIHNlbGYuX2hlaWdodCA9ICgzODAuMCBpZiB1aXNjYWxlIGlzIGJhLlVJU2NhbGUuU01BTEwgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICA0MjAuMCBpZiB1aXNjYWxlIGlzIGJhLlVJU2NhbGUuTUVESVVNIGVsc2UgNTAwLjApCiAgICAgICAgdG9wX2V4dHJhID0gMjAuMCBpZiB1aXNjYWxlIGlzIGJhLlVJU2NhbGUuU01BTEwgZWxzZSAwLjAKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhyb290X3dpZGdldD1iYS5jb250YWluZXJ3aWRnZXQoCiAgICAgICAgICAgIHNpemU9KHNlbGYuX3dpZHRoLCBzZWxmLl9oZWlnaHQgKyB0b3BfZXh0cmEpLAogICAgICAgICAgICB0cmFuc2l0aW9uPXRyYW5zaXRpb24sCiAgICAgICAgICAgIHNjYWxlX29yaWdpbl9zdGFja19vZmZzZXQ9c2NhbGVfb3JpZ2luLAogICAgICAgICAgICBzY2FsZT0oMi4wNSBpZiB1aXNjYWxlIGlzIGJhLlVJU2NhbGUuU01BTEwgZWxzZQogICAgICAgICAgICAgICAgICAgMS41IGlmIHVpc2NhbGUgaXMgYmEuVUlTY2FsZS5NRURJVU0gZWxzZSAxLjApLAogICAgICAgICAgICBzdGFja19vZmZzZXQ9KDAsIC0xMCkgaWYgdWlzY2FsZSBpcyBiYS5VSVNjYWxlLlNNQUxMIGVsc2UgKDAsIDApKSkKCiAgICAgICAgc2VsZi5fYmFja19idXR0b24gPSBiYWNrX2J1dHRvbiA9IGJ0biA9IGJhLmJ1dHRvbndpZGdldCgKICAgICAgICAgICAgcGFyZW50PXNlbGYuX3Jvb3Rfd2lkZ2V0LAogICAgICAgICAgICBwb3NpdGlvbj0oNDMgKyB4X2luc2V0LCBzZWxmLl9oZWlnaHQgLSA2MCksCiAgICAgICAgICAgIHNpemU9KDE2MCwgNjgpLAogICAgICAgICAgICBzY2FsZT0wLjc3LAogICAgICAgICAgICBhdXRvc2VsZWN0PVRydWUsCiAgICAgICAgICAgIHRleHRfc2NhbGU9MS4zLAogICAgICAgICAgICBsYWJlbD1iYS5Mc3RyKHJlc291cmNlPSdiYWNrVGV4dCcpLAogICAgICAgICAgICBidXR0b25fdHlwZT0nYmFjaycpCgogICAgICAgIGJhLnRleHR3aWRnZXQocGFyZW50PXNlbGYuX3Jvb3Rfd2lkZ2V0LAogICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb249KDAsIHNlbGYuX2hlaWdodCAtIDQ3KSwKICAgICAgICAgICAgICAgICAgICAgIHNpemU9KHNlbGYuX3dpZHRoLCAyNSksCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0PWJhLkxzdHIocmVzb3VyY2U9c2VsZi5fciArICcudGl0bGVUZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzPVsoJyR7VFlQRX0nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9wdmFycy53aW5kb3dfdGl0bGVfbmFtZSldKSwKICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPWJhLmFwcC51aS5oZWFkaW5nX2NvbG9yLAogICAgICAgICAgICAgICAgICAgICAgbWF4d2lkdGg9MjkwLAogICAgICAgICAgICAgICAgICAgICAgaF9hbGlnbj0nY2VudGVyJywKICAgICAgICAgICAgICAgICAgICAgIHZfYWxpZ249J2NlbnRlcicpCgogICAgICAgIGJhLmJ1dHRvbndpZGdldChlZGl0PWJ0biwKICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uX3R5cGU9J2JhY2tTbWFsbCcsCiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU9KDYwLCA2MCksCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPWJhLmNoYXJzdHIoYmEuU3BlY2lhbENoYXIuQkFDSykpCgogICAgICAgIHYgPSBzZWxmLl9oZWlnaHQgLSA1OS4wCiAgICAgICAgaCA9IDQxICsgeF9pbnNldAogICAgICAgIGJfY29sb3IgPSAoMC42LCAwLjUzLCAwLjYzKQogICAgICAgIGJfdGV4dGNvbG9yID0gKDAuNzUsIDAuNywgMC44KQoKICAgICAgICBzY2wgPSAoMS4xIGlmIHVpc2NhbGUgaXMgYmEuVUlTY2FsZS5TTUFMTCBlbHNlCiAgICAgICAgICAgICAgIDEuMjcgaWYgdWlzY2FsZSBpcyBiYS5VSVNjYWxlLk1FRElVTSBlbHNlIDEuNTcpCiAgICAgICAgc2NsICo9IDAuNjMKICAgICAgICB2IC09IDY1LjAgKiBzY2wKICAgICAgICBuZXdfYnV0dG9uID0gYnRuID0gYmEuYnV0dG9ud2lkZ2V0KAogICAgICAgICAgICBwYXJlbnQ9c2VsZi5fcm9vdF93aWRnZXQsCiAgICAgICAgICAgIHBvc2l0aW9uPShoLCB2KSwKICAgICAgICAgICAgc2l6ZT0oOTAsIDU4LjAgKiBzY2wpLAogICAgICAgICAgICBvbl9hY3RpdmF0ZV9jYWxsPXNlbGYuX25ld19wbGF5bGlzdCwKICAgICAgICAgICAgY29sb3I9Yl9jb2xvciwKICAgICAgICAgICAgYXV0b3NlbGVjdD1UcnVlLAogICAgICAgICAgICBidXR0b25fdHlwZT0nc3F1YXJlJywKICAgICAgICAgICAgdGV4dGNvbG9yPWJfdGV4dGNvbG9yLAogICAgICAgICAgICB0ZXh0X3NjYWxlPTAuNywKICAgICAgICAgICAgbGFiZWw9YmEuTHN0cihyZXNvdXJjZT0nbmV3VGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsbGJhY2tfcmVzb3VyY2U9c2VsZi5fciArICcubmV3VGV4dCcpKQoKICAgICAgICB2IC09IDY1LjAgKiBzY2wKICAgICAgICBzZWxmLl9lZGl0X2J1dHRvbiA9IGVkaXRfYnV0dG9uID0gYnRuID0gYmEuYnV0dG9ud2lkZ2V0KAogICAgICAgICAgICBwYXJlbnQ9c2VsZi5fcm9vdF93aWRnZXQsCiAgICAgICAgICAgIHBvc2l0aW9uPShoLCB2KSwKICAgICAgICAgICAgc2l6ZT0oOTAsIDU4LjAgKiBzY2wpLAogICAgICAgICAgICBvbl9hY3RpdmF0ZV9jYWxsPXNlbGYuX2VkaXRfcGxheWxpc3QsCiAgICAgICAgICAgIGNvbG9yPWJfY29sb3IsCiAgICAgICAgICAgIGF1dG9zZWxlY3Q9VHJ1ZSwKICAgICAgICAgICAgdGV4dGNvbG9yPWJfdGV4dGNvbG9yLAogICAgICAgICAgICBidXR0b25fdHlwZT0nc3F1YXJlJywKICAgICAgICAgICAgdGV4dF9zY2FsZT0wLjcsCiAgICAgICAgICAgIGxhYmVsPWJhLkxzdHIocmVzb3VyY2U9J2VkaXRUZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxsYmFja19yZXNvdXJjZT1zZWxmLl9yICsgJy5lZGl0VGV4dCcpKQoKICAgICAgICB2IC09IDY1LjAgKiBzY2wKICAgICAgICBkdXBsaWNhdGVfYnV0dG9uID0gYnRuID0gYmEuYnV0dG9ud2lkZ2V0KAogICAgICAgICAgICBwYXJlbnQ9c2VsZi5fcm9vdF93aWRnZXQsCiAgICAgICAgICAgIHBvc2l0aW9uPShoLCB2KSwKICAgICAgICAgICAgc2l6ZT0oOTAsIDU4LjAgKiBzY2wpLAogICAgICAgICAgICBvbl9hY3RpdmF0ZV9jYWxsPXNlbGYuX2R1cGxpY2F0ZV9wbGF5bGlzdCwKICAgICAgICAgICAgY29sb3I9Yl9jb2xvciwKICAgICAgICAgICAgYXV0b3NlbGVjdD1UcnVlLAogICAgICAgICAgICB0ZXh0Y29sb3I9Yl90ZXh0Y29sb3IsCiAgICAgICAgICAgIGJ1dHRvbl90eXBlPSdzcXVhcmUnLAogICAgICAgICAgICB0ZXh0X3NjYWxlPTAuNywKICAgICAgICAgICAgbGFiZWw9YmEuTHN0cihyZXNvdXJjZT0nZHVwbGljYXRlVGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsbGJhY2tfcmVzb3VyY2U9c2VsZi5fciArICcuZHVwbGljYXRlVGV4dCcpKQoKICAgICAgICB2IC09IDY1LjAgKiBzY2wKICAgICAgICBkZWxldGVfYnV0dG9uID0gYnRuID0gYmEuYnV0dG9ud2lkZ2V0KAogICAgICAgICAgICBwYXJlbnQ9c2VsZi5fcm9vdF93aWRnZXQsCiAgICAgICAgICAgIHBvc2l0aW9uPShoLCB2KSwKICAgICAgICAgICAgc2l6ZT0oOTAsIDU4LjAgKiBzY2wpLAogICAgICAgICAgICBvbl9hY3RpdmF0ZV9jYWxsPXNlbGYuX2RlbGV0ZV9wbGF5bGlzdCwKICAgICAgICAgICAgY29sb3I9Yl9jb2xvciwKICAgICAgICAgICAgYXV0b3NlbGVjdD1UcnVlLAogICAgICAgICAgICB0ZXh0Y29sb3I9Yl90ZXh0Y29sb3IsCiAgICAgICAgICAgIGJ1dHRvbl90eXBlPSdzcXVhcmUnLAogICAgICAgICAgICB0ZXh0X3NjYWxlPTAuNywKICAgICAgICAgICAgbGFiZWw9YmEuTHN0cihyZXNvdXJjZT0nZGVsZXRlVGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsbGJhY2tfcmVzb3VyY2U9c2VsZi5fciArICcuZGVsZXRlVGV4dCcpKQoKICAgICAgICB2IC09IDY1LjAgKiBzY2wKICAgICAgICBzZWxmLl9pbXBvcnRfYnV0dG9uID0gYmEuYnV0dG9ud2lkZ2V0KAogICAgICAgICAgICBwYXJlbnQ9c2VsZi5fcm9vdF93aWRnZXQsCiAgICAgICAgICAgIHBvc2l0aW9uPShoLCB2KSwKICAgICAgICAgICAgc2l6ZT0oOTAsIDU4LjAgKiBzY2wpLAogICAgICAgICAgICBvbl9hY3RpdmF0ZV9jYWxsPXNlbGYuX2ltcG9ydF9wbGF5bGlzdCwKICAgICAgICAgICAgY29sb3I9Yl9jb2xvciwKICAgICAgICAgICAgYXV0b3NlbGVjdD1UcnVlLAogICAgICAgICAgICB0ZXh0Y29sb3I9Yl90ZXh0Y29sb3IsCiAgICAgICAgICAgIGJ1dHRvbl90eXBlPSdzcXVhcmUnLAogICAgICAgICAgICB0ZXh0X3NjYWxlPTAuNywKICAgICAgICAgICAgbGFiZWw9YmEuTHN0cihyZXNvdXJjZT0naW1wb3J0VGV4dCcpKQogICAgICAgIHYgLT0gNjUuMCAqIHNjbAogICAgICAgIGJ0biA9IGJhLmJ1dHRvbndpZGdldChwYXJlbnQ9c2VsZi5fcm9vdF93aWRnZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uPShoLCB2KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZT0oOTAsIDU4LjAgKiBzY2wpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbl9hY3RpdmF0ZV9jYWxsPXNlbGYuX3NoYXJlX3BsYXlsaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj1iX2NvbG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvc2VsZWN0PVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRjb2xvcj1iX3RleHRjb2xvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uX3R5cGU9J3NxdWFyZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRfc2NhbGU9MC43LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD1iYS5Mc3RyKHJlc291cmNlPSdzaGFyZVRleHQnKSkKCiAgICAgICAgdiA9IHNlbGYuX2hlaWdodCAtIDc1CiAgICAgICAgc2VsZi5fc2Nyb2xsX2hlaWdodCA9IHNlbGYuX2hlaWdodCAtIDExOQogICAgICAgIHNjcm9sbHdpZGdldCA9IGJhLnNjcm9sbHdpZGdldChwYXJlbnQ9c2VsZi5fcm9vdF93aWRnZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uPSgxNDAgKyB4X2luc2V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiAtIHNlbGYuX3Njcm9sbF9oZWlnaHQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplPShzZWxmLl93aWR0aCAtICgxODAgKyAyICogeF9pbnNldCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3Njcm9sbF9oZWlnaHQgKyAxMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodD1GYWxzZSkKICAgICAgICBiYS53aWRnZXQoZWRpdD1iYWNrX2J1dHRvbiwgcmlnaHRfd2lkZ2V0PXNjcm9sbHdpZGdldCkKICAgICAgICBzZWxmLl9jb2x1bW53aWRnZXQgPSBiYS5jb2x1bW53aWRnZXQocGFyZW50PXNjcm9sbHdpZGdldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyPTIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbj0wKQoKICAgICAgICBoID0gMTQ1CgogICAgICAgIHNlbGYuX2RvX3JhbmRvbWl6ZV92YWwgPSBiYS5hcHAuY29uZmlnLmdldCgKICAgICAgICAgICAgc2VsZi5fcHZhcnMuY29uZmlnX25hbWUgKyAnIFBsYXlsaXN0IFJhbmRvbWl6ZScsIDApCgogICAgICAgIGggKz0gMjEwCgogICAgICAgIGZvciBidG4gaW4gW25ld19idXR0b24sIGRlbGV0ZV9idXR0b24sIGVkaXRfYnV0dG9uLCBkdXBsaWNhdGVfYnV0dG9uXToKICAgICAgICAgICAgYmEud2lkZ2V0KGVkaXQ9YnRuLCByaWdodF93aWRnZXQ9c2Nyb2xsd2lkZ2V0KQogICAgICAgIGJhLndpZGdldChlZGl0PXNjcm9sbHdpZGdldCwKICAgICAgICAgICAgICAgICAgbGVmdF93aWRnZXQ9bmV3X2J1dHRvbiwKICAgICAgICAgICAgICAgICAgcmlnaHRfd2lkZ2V0PV9iYS5nZXRfc3BlY2lhbF93aWRnZXQoJ3BhcnR5X2J1dHRvbicpCiAgICAgICAgICAgICAgICAgIGlmIGJhLmFwcC51aS51c2VfdG9vbGJhcnMgZWxzZSBOb25lKQoKICAgICAgICAjIG1ha2Ugc3VyZSBjb25maWcgZXhpc3RzCiAgICAgICAgc2VsZi5fY29uZmlnX25hbWVfZnVsbCA9IHNlbGYuX3B2YXJzLmNvbmZpZ19uYW1lICsgJyBQbGF5bGlzdHMnCgogICAgICAgIGlmIHNlbGYuX2NvbmZpZ19uYW1lX2Z1bGwgbm90IGluIGJhLmFwcC5jb25maWc6CiAgICAgICAgICAgIGJhLmFwcC5jb25maWdbc2VsZi5fY29uZmlnX25hbWVfZnVsbF0gPSB7fQoKICAgICAgICBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9uYW1lOiBPcHRpb25hbFtzdHJdID0gTm9uZQogICAgICAgIHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X2luZGV4OiBPcHRpb25hbFtpbnRdID0gTm9uZQogICAgICAgIHNlbGYuX3BsYXlsaXN0X3dpZGdldHM6IExpc3RbYmEuV2lkZ2V0XSA9IFtdCgogICAgICAgIHNlbGYuX3BsYXlsaXN0X21heCA9IGxlbihiYS5hcHAuY29uZmlnW3NlbGYuX2NvbmZpZ19uYW1lX2Z1bGxdKQogICAgICAgIGlmIGludChzZWxmLl9wbGF5bGlzdF9tYXgpID09IDM6CiAgICAgICAgICAgIGNvbG9yID0gKDEuMCwgMC4yLCAwLjIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29sb3IgPSAoMC4yLCAxLjAsIDAuMikKICAgICAgICBzZWxmLl9wbGF5bGlzdF9tYXhfdGV4dCA9IGJhLnRleHR3aWRnZXQoCiAgICAgICAgICAgIHBhcmVudD1zZWxmLl9yb290X3dpZGdldCwKICAgICAgICAgICAgcG9zaXRpb249KGggKyAyMDUgKyB4X2luc2V0LCB2ICsgMzUpLAogICAgICAgICAgICBzaXplPSgwLCAwKSwKICAgICAgICAgICAgdGV4dD1zdHIoc2VsZi5fcGxheWxpc3RfbWF4KSArICcgLyAzJywKICAgICAgICAgICAgaF9hbGlnbj0nY2VudGVyJywKICAgICAgICAgICAgdl9hbGlnbj0nY2VudGVyJywKICAgICAgICAgICAgbWF4d2lkdGg9c2VsZi5fd2lkdGggKiAwLjksCiAgICAgICAgICAgIHNjYWxlPTEuMCwKICAgICAgICAgICAgY29sb3I9Y29sb3IpCgogICAgICAgIHNlbGYuX3JlZnJlc2goc2VsZWN0X3BsYXlsaXN0PXNlbGVjdF9wbGF5bGlzdCkKCiAgICAgICAgYmEuYnV0dG9ud2lkZ2V0KGVkaXQ9YmFja19idXR0b24sIG9uX2FjdGl2YXRlX2NhbGw9c2VsZi5fYmFjaykKICAgICAgICBiYS5jb250YWluZXJ3aWRnZXQoZWRpdD1zZWxmLl9yb290X3dpZGdldCwgY2FuY2VsX2J1dHRvbj1iYWNrX2J1dHRvbikKCiAgICAgICAgYmEuY29udGFpbmVyd2lkZ2V0KGVkaXQ9c2VsZi5fcm9vdF93aWRnZXQsIHNlbGVjdGVkX2NoaWxkPXNjcm9sbHdpZGdldCkKCiAgICBkZWYgX3VwZGF0ZShzZWxmKSAtPiBOb25lOgogICAgICAgIHNlbGYuX3BsYXlsaXN0X21heCA9IGxlbihiYS5hcHAuY29uZmlnW3NlbGYuX2NvbmZpZ19uYW1lX2Z1bGxdKQogICAgICAgIGlmIGludChzZWxmLl9wbGF5bGlzdF9tYXgpID09IDM6CiAgICAgICAgICAgIGNvbG9yID0gKDEuMCwgMC4yLCAwLjIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29sb3IgPSAoMC4yLCAxLjAsIDAuMikKICAgICAgICBiYS50ZXh0d2lkZ2V0KAogICAgICAgICAgICBlZGl0PXNlbGYuX3BsYXlsaXN0X21heF90ZXh0LAogICAgICAgICAgICB0ZXh0PXN0cihzZWxmLl9wbGF5bGlzdF9tYXgpICsgJyAvIDMnLAogICAgICAgICAgICBjb2xvcj1jb2xvcikKCiAgICBkZWYgX2JhY2soc2VsZikgLT4gTm9uZToKICAgICAgICAjIHB5bGludDogZGlzYWJsZT1jeWNsaWMtaW1wb3J0CiAgICAgICAgZnJvbSBiYXN0ZC51aS5wbGF5bGlzdCBpbXBvcnQgYnJvd3NlcgogICAgICAgIGlmIHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGNmZyA9IGJhLmFwcC5jb25maWcKICAgICAgICAgICAgY2ZnW3NlbGYuX3B2YXJzLmNvbmZpZ19uYW1lICsKICAgICAgICAgICAgICAgICcgUGxheWxpc3QgU2VsZWN0aW9uJ10gPSBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9uYW1lCiAgICAgICAgICAgIGNmZy5jb21taXQoKQoKICAgICAgICBiYS5jb250YWluZXJ3aWRnZXQoZWRpdD1zZWxmLl9yb290X3dpZGdldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbj1zZWxmLl90cmFuc2l0aW9uX291dCkKICAgICAgICBiYS5hcHAudWkuc2V0X21haW5fbWVudV93aW5kb3coCiAgICAgICAgICAgIGJyb3dzZXIuUGxheWxpc3RCcm93c2VyV2luZG93KAogICAgICAgICAgICAgICAgdHJhbnNpdGlvbj0naW5fbGVmdCcsCiAgICAgICAgICAgICAgICBzZXNzaW9udHlwZT1zZWxmLl9zZXNzaW9udHlwZSkuZ2V0X3Jvb3Rfd2lkZ2V0KCkpCgogICAgZGVmIF9zZWxlY3Qoc2VsZiwgbmFtZTogc3RyLCBpbmRleDogaW50KSAtPiBOb25lOgogICAgICAgIHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUgPSBuYW1lCiAgICAgICAgc2VsZi5fc2VsZWN0ZWRfcGxheWxpc3RfaW5kZXggPSBpbmRleAoKICAgIGRlZiBfcnVuX3NlbGVjdGVkX3BsYXlsaXN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgIF9iYS51bmxvY2tfYWxsX2lucHV0KCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIF9iYS5uZXdfaG9zdF9zZXNzaW9uKHNlbGYuX3Nlc3Npb250eXBlKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGZyb20gYmFzdGQgaW1wb3J0IG1haW5tZW51CiAgICAgICAgICAgIGJhLnByaW50X2V4Y2VwdGlvbihmJ0Vycm9yIHJ1bm5pbmcgc2Vzc2lvbiB7c2VsZi5fc2Vzc2lvbnR5cGV9LicpCgogICAgICAgICAgICAjIERyb3AgYmFjayBpbnRvIGEgbWFpbiBtZW51IHNlc3Npb24uCiAgICAgICAgICAgIF9iYS5uZXdfaG9zdF9zZXNzaW9uKG1haW5tZW51Lk1haW5NZW51U2Vzc2lvbikKCiAgICBkZWYgX2Nob29zZV9wbGF5bGlzdChzZWxmKSAtPiBOb25lOgogICAgICAgIGlmIHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgc2VsZi5fc2F2ZV9wbGF5bGlzdF9zZWxlY3Rpb24oKQogICAgICAgIGJhLmNvbnRhaW5lcndpZGdldChlZGl0PXNlbGYuX3Jvb3Rfd2lkZ2V0LCB0cmFuc2l0aW9uPSdvdXRfbGVmdCcpCiAgICAgICAgX2JhLmZhZGVfc2NyZWVuKEZhbHNlLCBlbmRjYWxsPXNlbGYuX3J1bl9zZWxlY3RlZF9wbGF5bGlzdCkKICAgICAgICBfYmEubG9ja19hbGxfaW5wdXQoKQoKICAgIGRlZiBfcmVmcmVzaChzZWxmLCBzZWxlY3RfcGxheWxpc3Q6IHN0ciA9IE5vbmUpIC0+IE5vbmU6CiAgICAgICAgZnJvbSBlZnJvLnV0aWwgaW1wb3J0IGFzc2VydHR5cGUKICAgICAgICBvbGRfc2VsZWN0aW9uID0gc2VsZi5fc2VsZWN0ZWRfcGxheWxpc3RfbmFtZQoKICAgICAgICAjIElmIHRoZXJlIHdhcyBubyBwcmV2IHNlbGVjdGlvbiwgbG9vayBpbiBwcmVmcy4KICAgICAgICBpZiBvbGRfc2VsZWN0aW9uIGlzIE5vbmU6CiAgICAgICAgICAgIG9sZF9zZWxlY3Rpb24gPSBiYS5hcHAuY29uZmlnLmdldChzZWxmLl9wdmFycy5jb25maWdfbmFtZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIFBsYXlsaXN0IFNlbGVjdGlvbicpCgogICAgICAgIG9sZF9zZWxlY3Rpb25faW5kZXggPSBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9pbmRleAoKICAgICAgICAjIERlbGV0ZSBvbGQuCiAgICAgICAgd2hpbGUgc2VsZi5fcGxheWxpc3Rfd2lkZ2V0czoKICAgICAgICAgICAgc2VsZi5fcGxheWxpc3Rfd2lkZ2V0cy5wb3AoKS5kZWxldGUoKQoKICAgICAgICBpdGVtcyA9IGxpc3QoYmEuYXBwLmNvbmZpZ1tzZWxmLl9jb25maWdfbmFtZV9mdWxsXS5pdGVtcygpKQoKICAgICAgICAjIE1ha2Ugc3VyZSBldmVyeXRoaW5nIGlzIHVuaWNvZGUgbm93LgogICAgICAgIGl0ZW1zID0gWyhpWzBdLmRlY29kZSgpLCBpWzFdKSBpZiBub3QgaXNpbnN0YW5jZShpWzBdLCBzdHIpIGVsc2UgaQogICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW1zXQoKICAgICAgICBpdGVtcy5zb3J0KGtleT1sYW1iZGEgeDogYXNzZXJ0dHlwZSh4WzBdLCBzdHIpLmxvd2VyKCkpCgogICAgICAgIGl0ZW1zID0gW1snX19kZWZhdWx0X18nLCBOb25lXV0gKyBpdGVtcyAgIyBEZWZhdWx0IGlzIGFsd2F5cyBmaXJzdC4KICAgICAgICBpbmRleCA9IDAKICAgICAgICBmb3IgcG5hbWUsIF8gaW4gaXRlbXM6CiAgICAgICAgICAgIGFzc2VydCBwbmFtZSBpcyBub3QgTm9uZQogICAgICAgICAgICB0eHR3ID0gYmEudGV4dHdpZGdldCgKICAgICAgICAgICAgICAgIHBhcmVudD1zZWxmLl9jb2x1bW53aWRnZXQsCiAgICAgICAgICAgICAgICBzaXplPShzZWxmLl93aWR0aCAtIDQwLCAzMCksCiAgICAgICAgICAgICAgICBtYXh3aWR0aD1zZWxmLl93aWR0aCAtIDExMCwKICAgICAgICAgICAgICAgIHRleHQ9c2VsZi5fZ2V0X3BsYXlsaXN0X2Rpc3BsYXlfbmFtZShwbmFtZSksCiAgICAgICAgICAgICAgICBoX2FsaWduPSdsZWZ0JywKICAgICAgICAgICAgICAgIHZfYWxpZ249J2NlbnRlcicsCiAgICAgICAgICAgICAgICBjb2xvcj0oMC42LCAwLjYsIDAuNywgMS4wKSBpZiBwbmFtZSA9PSAnX19kZWZhdWx0X18nIGVsc2UKICAgICAgICAgICAgICAgICgwLjg1LCAwLjg1LCAwLjg1LCAxKSwKICAgICAgICAgICAgICAgIGFsd2F5c19oaWdobGlnaHQ9VHJ1ZSwKICAgICAgICAgICAgICAgIG9uX3NlbGVjdF9jYWxsPWJhLkNhbGwoc2VsZi5fc2VsZWN0LCBwbmFtZSwgaW5kZXgpLAogICAgICAgICAgICAgICAgb25fYWN0aXZhdGVfY2FsbD1iYS5DYWxsKHNlbGYuX2VkaXRfYnV0dG9uLmFjdGl2YXRlKSwKICAgICAgICAgICAgICAgIHNlbGVjdGFibGU9VHJ1ZSkKICAgICAgICAgICAgYmEud2lkZ2V0KGVkaXQ9dHh0dywgc2hvd19idWZmZXJfdG9wPTUwLCBzaG93X2J1ZmZlcl9ib3R0b209NTApCgogICAgICAgICAgICAjIEhpdHRpbmcgdXAgZnJvbSB0b3Agd2lkZ2V0IHNob3VsZCBqdW1wIHRvICdiYWNrJwogICAgICAgICAgICBpZiBpbmRleCA9PSAwOgogICAgICAgICAgICAgICAgYmEud2lkZ2V0KGVkaXQ9dHh0dywgdXBfd2lkZ2V0PXNlbGYuX2JhY2tfYnV0dG9uKQoKICAgICAgICAgICAgc2VsZi5fcGxheWxpc3Rfd2lkZ2V0cy5hcHBlbmQodHh0dykKCiAgICAgICAgICAgICMgU2VsZWN0IHRoaXMgb25lIGlmIHRoZSB1c2VyIHJlcXVlc3RlZCBpdC4KICAgICAgICAgICAgaWYgc2VsZWN0X3BsYXlsaXN0IGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgaWYgcG5hbWUgPT0gc2VsZWN0X3BsYXlsaXN0OgogICAgICAgICAgICAgICAgICAgIGJhLmNvbHVtbndpZGdldChlZGl0PXNlbGYuX2NvbHVtbndpZGdldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfY2hpbGQ9dHh0dywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV9jaGlsZD10eHR3KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBTZWxlY3QgdGhpcyBvbmUgaWYgaXQgd2FzIHByZXZpb3VzbHkgc2VsZWN0ZWQuCiAgICAgICAgICAgICAgICAjIEdvIGJ5IGluZGV4IGlmIHRoZXJlJ3Mgb25lLgogICAgICAgICAgICAgICAgaWYgb2xkX3NlbGVjdGlvbl9pbmRleCBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBpZiBpbmRleCA9PSBvbGRfc2VsZWN0aW9uX2luZGV4OgogICAgICAgICAgICAgICAgICAgICAgICBiYS5jb2x1bW53aWRnZXQoZWRpdD1zZWxmLl9jb2x1bW53aWRnZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9jaGlsZD10eHR3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV9jaGlsZD10eHR3KQogICAgICAgICAgICAgICAgZWxzZTogICMgT3RoZXJ3aXNlIGxvb2sgYnkgbmFtZS4KICAgICAgICAgICAgICAgICAgICBpZiBwbmFtZSA9PSBvbGRfc2VsZWN0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICBiYS5jb2x1bW53aWRnZXQoZWRpdD1zZWxmLl9jb2x1bW53aWRnZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9jaGlsZD10eHR3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZV9jaGlsZD10eHR3KQoKICAgICAgICAgICAgaW5kZXggKz0gMQoKICAgIGRlZiBfc2F2ZV9wbGF5bGlzdF9zZWxlY3Rpb24oc2VsZikgLT4gTm9uZToKICAgICAgICAjIFN0b3JlIHRoZSBzZWxlY3RlZCBwbGF5bGlzdCBpbiBwcmVmcy4KICAgICAgICAjIFRoaXMgc2VydmVzIGR1YWwgcHVycG9zZXMgb2YgbGV0dGluZyB1cyByZS1zZWxlY3QgaXQgbmV4dCB0aW1lCiAgICAgICAgIyBpZiB3ZSB3YW50IGFuZCBhbHNvIGxldHMgdXMgcGFzcyBpdCB0byB0aGUgZ2FtZSAoc2luY2Ugd2UgcmVzZXQKICAgICAgICAjIHRoZSB3aG9sZSBweXRob24gZW52aXJvbm1lbnQgdGhhdCdzIG5vdCBhY3R1YWxseSBlYXN5KS4KICAgICAgICBjZmcgPSBiYS5hcHAuY29uZmlnCiAgICAgICAgY2ZnW3NlbGYuX3B2YXJzLmNvbmZpZ19uYW1lICsKICAgICAgICAgICAgJyBQbGF5bGlzdCBTZWxlY3Rpb24nXSA9IHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUKICAgICAgICBjZmdbc2VsZi5fcHZhcnMuY29uZmlnX25hbWUgKwogICAgICAgICAgICAnIFBsYXlsaXN0IFJhbmRvbWl6ZSddID0gc2VsZi5fZG9fcmFuZG9taXplX3ZhbAogICAgICAgIGNmZy5jb21taXQoKQoKICAgIGRlZiBfbmV3X3BsYXlsaXN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgIGZyb20gYmFzdGQudWkucGxheWxpc3QuZWRpdGNvbnRyb2xsZXIgaW1wb3J0IFBsYXlsaXN0RWRpdENvbnRyb2xsZXIKCiAgICAgICAjIENsYW1wIGF0IG91ciBtYXggcGxheWxpc3QgbnVtYmVyLgogICAgICAgIGlmIGxlbihiYS5hcHAuY29uZmlnW3NlbGYuX2NvbmZpZ19uYW1lX2Z1bGxdKSA+IDI6CiAgICAgICAgICAgIGZyb20gYmFzdGQudWkucHVyY2hhc2UgaW1wb3J0IFB1cmNoYXNlV2luZG93CiAgICAgICAgICAgIGlmIG5vdCBiYS5hcHAuYWNjb3VudHMuaGF2ZV9wcm9fb3B0aW9ucygpOgogICAgICAgICAgICAgICAgUHVyY2hhc2VXaW5kb3coaXRlbXM9Wydwcm8nXSkKICAgICAgICAgICAgICAgIHJldHVybgoKICAgICAgICAjIENsYW1wIGF0IG91ciBtYXggcGxheWxpc3QgbnVtYmVyLgogICAgICAgIGlmIGxlbihiYS5hcHAuY29uZmlnW3NlbGYuX2NvbmZpZ19uYW1lX2Z1bGxdKSA+IHNlbGYuX21heF9wbGF5bGlzdHM6CiAgICAgICAgICAgIGJhLnNjcmVlbm1lc3NhZ2UoCiAgICAgICAgICAgICAgICBiYS5Mc3RyKHRyYW5zbGF0ZT0oJ3NlcnZlclJlc3BvbnNlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ01heCBudW1iZXIgb2YgcGxheWxpc3RzIHJlYWNoZWQuJykpLAogICAgICAgICAgICAgICAgY29sb3I9KDEsIDAsIDApKQogICAgICAgICAgICBiYS5wbGF5c291bmQoYmEuZ2V0c291bmQoJ2Vycm9yJykpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICAjIEluIGNhc2UgdGhleSBjYW5jZWwgc28gd2UgY2FuIHJldHVybiB0byB0aGlzIHN0YXRlLgogICAgICAgIHNlbGYuX3NhdmVfcGxheWxpc3Rfc2VsZWN0aW9uKCkKCiAgICAgICAgIyBLaWNrIG9mZiB0aGUgZWRpdCBVSS4KICAgICAgICBQbGF5bGlzdEVkaXRDb250cm9sbGVyKHNlc3Npb250eXBlPXNlbGYuX3Nlc3Npb250eXBlKQogICAgICAgIGJhLmNvbnRhaW5lcndpZGdldChlZGl0PXNlbGYuX3Jvb3Rfd2lkZ2V0LCB0cmFuc2l0aW9uPSdvdXRfbGVmdCcpCgogICAgZGVmIF9lZGl0X3BsYXlsaXN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgIGZyb20gYmFzdGQudWkucGxheWxpc3QuZWRpdGNvbnRyb2xsZXIgaW1wb3J0IFBsYXlsaXN0RWRpdENvbnRyb2xsZXIKCiAgICAgICAgaWYgc2VsZi5fc2VsZWN0ZWRfcGxheWxpc3RfbmFtZSBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBpZiBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9uYW1lID09ICdfX2RlZmF1bHRfXyc6CiAgICAgICAgICAgIGJhLnBsYXlzb3VuZChiYS5nZXRzb3VuZCgnZXJyb3InKSkKICAgICAgICAgICAgYmEuc2NyZWVubWVzc2FnZShiYS5Mc3RyKHJlc291cmNlPXNlbGYuX3IgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy5jYW50RWRpdERlZmF1bHRUZXh0JykpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIHNlbGYuX3NhdmVfcGxheWxpc3Rfc2VsZWN0aW9uKCkKICAgICAgICBQbGF5bGlzdEVkaXRDb250cm9sbGVyKAogICAgICAgICAgICBleGlzdGluZ19wbGF5bGlzdF9uYW1lPXNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUsCiAgICAgICAgICAgIHNlc3Npb250eXBlPXNlbGYuX3Nlc3Npb250eXBlKQogICAgICAgIGJhLmNvbnRhaW5lcndpZGdldChlZGl0PXNlbGYuX3Jvb3Rfd2lkZ2V0LCB0cmFuc2l0aW9uPSdvdXRfbGVmdCcpCgogICAgZGVmIF9kb19kZWxldGVfcGxheWxpc3Qoc2VsZikgLT4gTm9uZToKICAgICAgICBfYmEuYWRkX3RyYW5zYWN0aW9uKHsKICAgICAgICAgICAgJ3R5cGUnOiAnUkVNT1ZFX1BMQVlMSVNUJywKICAgICAgICAgICAgJ3BsYXlsaXN0VHlwZSc6IHNlbGYuX3B2YXJzLmNvbmZpZ19uYW1lLAogICAgICAgICAgICAncGxheWxpc3ROYW1lJzogc2VsZi5fc2VsZWN0ZWRfcGxheWxpc3RfbmFtZQogICAgICAgIH0pCiAgICAgICAgX2JhLnJ1bl90cmFuc2FjdGlvbnMoKQogICAgICAgIGJhLnBsYXlzb3VuZChiYS5nZXRzb3VuZCgnc2hpZWxkRG93bicpKQoKICAgICAgICBzZWxmLl91cGRhdGUoKQoKICAgICAgICAjICh3ZSBkb24ndCB1c2UgbGVuKCktMSBoZXJlIGJlY2F1c2UgdGhlIGRlZmF1bHQgbGlzdCBhZGRzIG9uZSkKICAgICAgICBhc3NlcnQgc2VsZi5fc2VsZWN0ZWRfcGxheWxpc3RfaW5kZXggaXMgbm90IE5vbmUKICAgICAgICBpZiBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9pbmRleCA+IGxlbigKICAgICAgICAgICAgICAgIGJhLmFwcC5jb25maWdbc2VsZi5fcHZhcnMuY29uZmlnX25hbWUgKyAnIFBsYXlsaXN0cyddKToKICAgICAgICAgICAgc2VsZi5fc2VsZWN0ZWRfcGxheWxpc3RfaW5kZXggPSBsZW4oCiAgICAgICAgICAgICAgICBiYS5hcHAuY29uZmlnW3NlbGYuX3B2YXJzLmNvbmZpZ19uYW1lICsgJyBQbGF5bGlzdHMnXSkKICAgICAgICBzZWxmLl9yZWZyZXNoKCkKCiAgICBkZWYgX2ltcG9ydF9wbGF5bGlzdChzZWxmKSAtPiBOb25lOgogICAgICAgICMgcHlsaW50OiBkaXNhYmxlPWN5Y2xpYy1pbXBvcnQKICAgICAgICBmcm9tIGJhc3RkLnVpLnBsYXlsaXN0IGltcG9ydCBzaGFyZQoKICAgICAgICAjIEdvdHRhIGJlIHNpZ25lZCBpbiBmb3IgdGhpcyB0byB3b3JrLgogICAgICAgIGlmIF9iYS5nZXRfYWNjb3VudF9zdGF0ZSgpICE9ICdzaWduZWRfaW4nOgogICAgICAgICAgICBiYS5zY3JlZW5tZXNzYWdlKGJhLkxzdHIocmVzb3VyY2U9J25vdFNpZ25lZEluRXJyb3JUZXh0JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I9KDEsIDAsIDApKQogICAgICAgICAgICBiYS5wbGF5c291bmQoYmEuZ2V0c291bmQoJ2Vycm9yJykpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBzaGFyZS5TaGFyZVBsYXlsaXN0SW1wb3J0V2luZG93KG9yaWdpbl93aWRnZXQ9c2VsZi5faW1wb3J0X2J1dHRvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uX3N1Y2Nlc3NfY2FsbGJhY2s9YmEuV2Vha0NhbGwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fb25fcGxheWxpc3RfaW1wb3J0X3N1Y2Nlc3MpKQoKICAgIGRlZiBfb25fcGxheWxpc3RfaW1wb3J0X3N1Y2Nlc3Moc2VsZikgLT4gTm9uZToKICAgICAgICBzZWxmLl9yZWZyZXNoKCkKCiAgICBkZWYgX29uX3NoYXJlX3BsYXlsaXN0X3Jlc3BvbnNlKHNlbGYsIG5hbWU6IHN0ciwgcmVzcG9uc2U6IEFueSkgLT4gTm9uZToKICAgICAgICAjIHB5bGludDogZGlzYWJsZT1jeWNsaWMtaW1wb3J0CiAgICAgICAgZnJvbSBiYXN0ZC51aS5wbGF5bGlzdCBpbXBvcnQgc2hhcmUKICAgICAgICBpZiByZXNwb25zZSBpcyBOb25lOgogICAgICAgICAgICBiYS5zY3JlZW5tZXNzYWdlKAogICAgICAgICAgICAgICAgYmEuTHN0cihyZXNvdXJjZT0naW50ZXJuYWwudW5hdmFpbGFibGVOb0Nvbm5lY3Rpb25UZXh0JyksCiAgICAgICAgICAgICAgICBjb2xvcj0oMSwgMCwgMCkpCiAgICAgICAgICAgIGJhLnBsYXlzb3VuZChiYS5nZXRzb3VuZCgnZXJyb3InKSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgc2hhcmUuU2hhcmVQbGF5bGlzdFJlc3VsdHNXaW5kb3cobmFtZSwgcmVzcG9uc2UpCgogICAgZGVmIF9zaGFyZV9wbGF5bGlzdChzZWxmKSAtPiBOb25lOgogICAgICAgICMgcHlsaW50OiBkaXNhYmxlPWN5Y2xpYy1pbXBvcnQKCiAgICAgICAgIyBHb3R0YSBiZSBzaWduZWQgaW4gZm9yIHRoaXMgdG8gd29yay4KICAgICAgICBpZiBfYmEuZ2V0X2FjY291bnRfc3RhdGUoKSAhPSAnc2lnbmVkX2luJzoKICAgICAgICAgICAgYmEuc2NyZWVubWVzc2FnZShiYS5Mc3RyKHJlc291cmNlPSdub3RTaWduZWRJbkVycm9yVGV4dCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPSgxLCAwLCAwKSkKICAgICAgICAgICAgYmEucGxheXNvdW5kKGJhLmdldHNvdW5kKCdlcnJvcicpKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBpZiBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9uYW1lID09ICdfX2RlZmF1bHRfXyc6CiAgICAgICAgICAgIGJhLnBsYXlzb3VuZChiYS5nZXRzb3VuZCgnZXJyb3InKSkKICAgICAgICAgICAgYmEuc2NyZWVubWVzc2FnZShiYS5Mc3RyKHJlc291cmNlPXNlbGYuX3IgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy5jYW50U2hhcmVEZWZhdWx0VGV4dCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPSgxLCAwLCAwKSkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGlmIHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIF9iYS5hZGRfdHJhbnNhY3Rpb24oCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICd0eXBlJzogJ1NIQVJFX1BMQVlMSVNUJywKICAgICAgICAgICAgICAgICdleHBpcmVfdGltZSc6IHRpbWUudGltZSgpICsgNSwKICAgICAgICAgICAgICAgICdwbGF5bGlzdFR5cGUnOiBzZWxmLl9wdmFycy5jb25maWdfbmFtZSwKICAgICAgICAgICAgICAgICdwbGF5bGlzdE5hbWUnOiBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9uYW1lCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbGxiYWNrPWJhLldlYWtDYWxsKHNlbGYuX29uX3NoYXJlX3BsYXlsaXN0X3Jlc3BvbnNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9uYW1lKSkKICAgICAgICBfYmEucnVuX3RyYW5zYWN0aW9ucygpCiAgICAgICAgYmEuc2NyZWVubWVzc2FnZShiYS5Mc3RyKHJlc291cmNlPSdzaGFyaW5nVGV4dCcpKQoKICAgIGRlZiBfZGVsZXRlX3BsYXlsaXN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9Y3ljbGljLWltcG9ydAogICAgICAgIGZyb20gYmFzdGQudWkuY29uZmlybSBpbXBvcnQgQ29uZmlybVdpbmRvdwoKICAgICAgICBpZiBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9uYW1lIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUgPT0gJ19fZGVmYXVsdF9fJzoKICAgICAgICAgICAgYmEucGxheXNvdW5kKGJhLmdldHNvdW5kKCdlcnJvcicpKQogICAgICAgICAgICBiYS5zY3JlZW5tZXNzYWdlKAogICAgICAgICAgICAgICAgYmEuTHN0cihyZXNvdXJjZT1zZWxmLl9yICsgJy5jYW50RGVsZXRlRGVmYXVsdFRleHQnKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBDb25maXJtV2luZG93KAogICAgICAgICAgICAgICAgYmEuTHN0cihyZXNvdXJjZT1zZWxmLl9yICsgJy5kZWxldGVDb25maXJtVGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnM9WygnJHtMSVNUfScsIHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUpXSksCiAgICAgICAgICAgICAgICBzZWxmLl9kb19kZWxldGVfcGxheWxpc3QsIDQ1MCwgMTUwKQoKICAgIGRlZiBfZ2V0X3BsYXlsaXN0X2Rpc3BsYXlfbmFtZShzZWxmLCBwbGF5bGlzdDogc3RyKSAtPiBiYS5Mc3RyOgogICAgICAgIGlmIHBsYXlsaXN0ID09ICdfX2RlZmF1bHRfXyc6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wdmFycy5kZWZhdWx0X2xpc3RfbmFtZQogICAgICAgIHJldHVybiBwbGF5bGlzdCBpZiBpc2luc3RhbmNlKHBsYXlsaXN0LCBiYS5Mc3RyKSBlbHNlIGJhLkxzdHIoCiAgICAgICAgICAgIHZhbHVlPXBsYXlsaXN0KQoKICAgIGRlZiBfZHVwbGljYXRlX3BsYXlsaXN0KHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIyBweWxpbnQ6IGRpc2FibGU9dG9vLW1hbnktYnJhbmNoZXMKICAgICAgICAjIHB5bGludDogZGlzYWJsZT1jeWNsaWMtaW1wb3J0CiAgICAgICAgaWYgc2VsZi5fc2VsZWN0ZWRfcGxheWxpc3RfbmFtZSBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBwbHN0OiBPcHRpb25hbFtMaXN0W0RpY3Rbc3RyLCBBbnldXV0KICAgICAgICBpZiBzZWxmLl9zZWxlY3RlZF9wbGF5bGlzdF9uYW1lID09ICdfX2RlZmF1bHRfXyc6CiAgICAgICAgICAgIHBsc3QgPSBzZWxmLl9wdmFycy5nZXRfZGVmYXVsdF9saXN0X2NhbGwoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHBsc3QgPSBiYS5hcHAuY29uZmlnW3NlbGYuX2NvbmZpZ19uYW1lX2Z1bGxdLmdldCgKICAgICAgICAgICAgICAgIHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUpCiAgICAgICAgICAgIGlmIHBsc3QgaXMgTm9uZToKICAgICAgICAgICAgICAgIGJhLnBsYXlzb3VuZChiYS5nZXRzb3VuZCgnZXJyb3InKSkKICAgICAgICAgICAgICAgIHJldHVybgoKICAgICAgICAjIGNsYW1wIGF0IG91ciBtYXggcGxheWxpc3QgbnVtYmVyCiAgICAgICAgaWYgbGVuKGJhLmFwcC5jb25maWdbc2VsZi5fY29uZmlnX25hbWVfZnVsbF0pID4gMjoKICAgICAgICAgICAgYmEuc2NyZWVubWVzc2FnZSgKICAgICAgICAgICAgICAgIGJhLkxzdHIodHJhbnNsYXRlPSgnc2VydmVyUmVzcG9uc2VzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnTWF4IG51bWJlciBvZiBwbGF5bGlzdHMgcmVhY2hlZC4nKSksCiAgICAgICAgICAgICAgICBjb2xvcj0oMSwgMCwgMCkpCiAgICAgICAgICAgIGJhLnBsYXlzb3VuZChiYS5nZXRzb3VuZCgnZXJyb3InKSkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgICMgY2xhbXAgYXQgb3VyIG1heCBwbGF5bGlzdCBudW1iZXIKICAgICAgICBpZiBsZW4oYmEuYXBwLmNvbmZpZ1tzZWxmLl9jb25maWdfbmFtZV9mdWxsXSkgPiBzZWxmLl9tYXhfcGxheWxpc3RzOgogICAgICAgICAgICBiYS5zY3JlZW5tZXNzYWdlKAogICAgICAgICAgICAgICAgYmEuTHN0cih0cmFuc2xhdGU9KCdzZXJ2ZXJSZXNwb25zZXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdNYXggbnVtYmVyIG9mIHBsYXlsaXN0cyByZWFjaGVkLicpKSwKICAgICAgICAgICAgICAgIGNvbG9yPSgxLCAwLCAwKSkKICAgICAgICAgICAgYmEucGxheXNvdW5kKGJhLmdldHNvdW5kKCdlcnJvcicpKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgY29weV90ZXh0ID0gYmEuTHN0cihyZXNvdXJjZT0nY29weU9mVGV4dCcpLmV2YWx1YXRlKCkKICAgICAgICAjIGdldCBqdXN0ICdDb3B5JyBvciB3aGF0bm90CiAgICAgICAgY29weV93b3JkID0gY29weV90ZXh0LnJlcGxhY2UoJyR7TkFNRX0nLCAnJykuc3RyaXAoKQogICAgICAgICMgZmluZCBhIHZhbGlkIGR1cCBuYW1lIHRoYXQgZG9lc24ndCBleGlzdAoKICAgICAgICB0ZXN0X2luZGV4ID0gMQogICAgICAgIGJhc2VfbmFtZSA9IHNlbGYuX2dldF9wbGF5bGlzdF9kaXNwbGF5X25hbWUoCiAgICAgICAgICAgIHNlbGYuX3NlbGVjdGVkX3BsYXlsaXN0X25hbWUpLmV2YWx1YXRlKCkKCiAgICAgICAgIyBJZiBpdCBsb29rcyBsaWtlIGEgY29weSwgc3RyaXAgZGlnaXRzIGFuZCBzcGFjZXMgb2ZmIHRoZSBlbmQuCiAgICAgICAgaWYgY29weV93b3JkIGluIGJhc2VfbmFtZToKICAgICAgICAgICAgd2hpbGUgYmFzZV9uYW1lWy0xXS5pc2RpZ2l0KCkgb3IgYmFzZV9uYW1lWy0xXSA9PSAnICc6CiAgICAgICAgICAgICAgICBiYXNlX25hbWUgPSBiYXNlX25hbWVbOi0xXQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIGlmIGNvcHlfd29yZCBpbiBiYXNlX25hbWU6CiAgICAgICAgICAgICAgICB0ZXN0X25hbWUgPSBiYXNlX25hbWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHRlc3RfbmFtZSA9IGNvcHlfdGV4dC5yZXBsYWNlKCcke05BTUV9JywgYmFzZV9uYW1lKQogICAgICAgICAgICBpZiB0ZXN0X2luZGV4ID4gMToKICAgICAgICAgICAgICAgIHRlc3RfbmFtZSArPSAnICcgKyBzdHIodGVzdF9pbmRleCkKICAgICAgICAgICAgaWYgdGVzdF9uYW1lIG5vdCBpbiBiYS5hcHAuY29uZmlnW3NlbGYuX2NvbmZpZ19uYW1lX2Z1bGxdOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgdGVzdF9pbmRleCArPSAxCgogICAgICAgIF9iYS5hZGRfdHJhbnNhY3Rpb24oewogICAgICAgICAgICAndHlwZSc6ICdBRERfUExBWUxJU1QnLAogICAgICAgICAgICAncGxheWxpc3RUeXBlJzogc2VsZi5fcHZhcnMuY29uZmlnX25hbWUsCiAgICAgICAgICAgICdwbGF5bGlzdE5hbWUnOiB0ZXN0X25hbWUsCiAgICAgICAgICAgICdwbGF5bGlzdCc6IGNvcHkuZGVlcGNvcHkocGxzdCkKICAgICAgICB9KQogICAgICAgIF9iYS5ydW5fdHJhbnNhY3Rpb25zKCkKCiAgICAgICAgYmEucGxheXNvdW5kKGJhLmdldHNvdW5kKCdndW5Db2NraW5nJykpCiAgICAgICAgc2VsZi5fcmVmcmVzaChzZWxlY3RfcGxheWxpc3Q9dGVzdF9uYW1lKQo='

# ba_meta export plugin
class PlaylistsPro(ba.Plugin):
    """My first ballistica plugin!"""

    import base64
    exec(base64.b64decode(text))
    customizebrowser.PlaylistCustomizeBrowserWindow = NewPlaylistCustomizeBrowserWindow
